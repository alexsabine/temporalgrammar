<!DOCTYPE html>
<html lang="en-GB">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CRR: A Mathematics of Becoming</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: Georgia, serif;
            background: #ffffff;
            color: #000000;
            line-height: 1.7;
        }
        
        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 40px 20px;
        }
        
        header {
            border-bottom: 2px solid #000;
            padding-bottom: 20px;
            margin-bottom: 40px;
        }
        
        h1 { font-size: 2rem; font-weight: normal; margin-bottom: 10px; letter-spacing: -0.5px; }
        .subtitle { font-size: 1rem; font-style: italic; color: #333; }
        
        .tabs { border-bottom: 2px solid #000; margin: 40px 0 0 0; }
        .tab-buttons { display: flex; flex-wrap: wrap; }
        .tab-button {
            background: #f8f8f8;
            border: 2px solid #000;
            border-bottom: none;
            padding: 10px 11px;
            cursor: pointer;
            font-family: Georgia, serif;
            font-size: 0.72rem;
            margin-right: -2px;
            transition: background 0.2s;
        }
        .tab-button:hover { background: #eee; }
        .tab-button.active { background: #fff; font-weight: bold; }
        
        .tab-content { display: none; padding: 40px 0; }
        .tab-content.active { display: block; }
        
        .content h2 {
            font-size: 1.4rem;
            font-weight: normal;
            margin: 40px 0 20px 0;
            border-bottom: 1px solid #000;
            padding-bottom: 10px;
        }
        .content h2:first-child { margin-top: 0; }
        .content h3 { font-size: 1.1rem; font-weight: bold; margin: 30px 0 15px 0; }
        .content p { margin-bottom: 15px; text-align: justify; }
        .content ul, .content ol { margin: 15px 0 15px 30px; }
        .content li { margin: 8px 0; }
        
        .grammar-box {
            border: 2px solid #000;
            padding: 30px;
            margin: 30px 0;
            background: #f8f8f8;
        }
        .grammar-box h3 {
            font-size: 1.1rem;
            font-weight: normal;
            margin-bottom: 20px;
            border-bottom: 1px solid #666;
            padding-bottom: 10px;
        }
        .operator { margin: 20px 0; padding-left: 20px; border-left: 3px solid #000; }
        .operator-name { font-weight: bold; font-size: 1.05rem; }
        .operator-formal {
            font-family: 'Courier New', monospace;
            background: #fff;
            padding: 8px 12px;
            margin: 10px 0;
            border: 1px solid #ccc;
            display: inline-block;
        }
        
        .key-insight { border: 2px solid #000; padding: 20px; margin: 30px 0; background: #f8f8f8; }
        .validated-box { border: 2px solid #000; border-left: 5px solid #2a5; padding: 20px; margin: 30px 0; background: #f8fff8; }
        .validated-box strong { color: #2a5; }
        .caution-box { border: 2px solid #666; border-left: 5px solid #c66; padding: 20px; margin: 30px 0; background: #fff8f8; }
        .caution-box strong { color: #a44; }
        
        .citation { font-size: 0.85rem; color: #555; margin-top: 8px; padding: 8px 12px; background: #f5f5f5; border-left: 3px solid #999; }
        
        table { width: 100%; border-collapse: collapse; margin: 25px 0; font-size: 0.9rem; }
        th, td { border: 1px solid #000; padding: 10px 12px; text-align: left; vertical-align: top; }
        th { background: #f0f0f0; font-weight: bold; }
        tr:nth-child(even) { background: #fafafa; }
        
        .math-inline { font-family: 'Courier New', monospace; background: #f5f5f5; padding: 2px 6px; border-radius: 3px; }
        .math-block { font-family: 'Courier New', monospace; background: #f8f8f8; border: 1px solid #ccc; padding: 15px; margin: 15px 0; white-space: pre-wrap; line-height: 1.6; }
        
        footer { margin-top: 60px; padding-top: 20px; border-top: 2px solid #000; font-size: 0.9rem; }
        
        /* Images */
        .jacob-image, .newton-image { float: right; margin: 0 0 20px 25px; width: 2.2in; max-width: 200px; border: 2px solid #000; }
        .albion-image { float: right; margin: 0 0 20px 25px; width: 2.2in; max-width: 200px; border: 2px solid #000; clear: right; }
        .clearfix::after { content: ""; display: table; clear: both; }
        
        /* Video */
        .video-container { margin: 30px 0; border: 2px solid #000; padding: 20px; background: #f8f8f8; }
        .video-container h4 { margin-bottom: 15px; font-size: 1.1rem; }
        .video-container iframe { width: 100%; max-width: 560px; height: 315px; border: 1px solid #000; }
        
        /* Simulation Styles */
        .sim-container { border: 2px solid #000; background: #fafafa; padding: 20px; margin: 20px 0; }
        .sim-canvas-wrap {
            background: linear-gradient(180deg, #0a0a14 0%, #12121f 50%, #0a0a14 100%);
            border: 1px solid #333;
            border-radius: 8px;
            overflow: hidden;
            margin-bottom: 20px;
        }
        .sim-canvas { display: block; width: 100%; }
        
        .sim-buttons { display: flex; gap: 10px; flex-wrap: wrap; margin-bottom: 15px; justify-content: center; }
        .sim-btn {
            padding: 8px 16px;
            border: 2px solid #000;
            background: #fff;
            font-family: Georgia, serif;
            font-size: 0.85rem;
            cursor: pointer;
            border-radius: 4px;
            transition: all 0.2s;
        }
        .sim-btn:hover { background: #f0f0f0; }
        .sim-btn.active { background: #000; color: #fff; }
        .sim-btn.danger { border-color: #c00; color: #c00; }
        .sim-btn.danger:hover { background: #c00; color: #fff; }
        
        .omega-control {
            background: #fff;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
        }
        .omega-control h4 { font-size: 0.9rem; margin-bottom: 10px; }
        .omega-row { display: flex; align-items: center; gap: 12px; margin-bottom: 8px; }
        .omega-slider {
            flex: 1; height: 8px; border-radius: 4px; appearance: none; cursor: pointer;
            background: linear-gradient(to right, #ef4444, #f59e0b, #10b981, #06b6d4);
        }
        .omega-slider::-webkit-slider-thumb {
            appearance: none; width: 20px; height: 20px; border-radius: 50%;
            background: white; border: 2px solid #333; cursor: pointer;
        }
        .omega-value { font-family: 'Courier New', monospace; font-size: 1.1rem; font-weight: bold; width: 50px; }
        .omega-label { font-size: 0.85rem; color: #666; margin-top: 8px; }
        
        .state-display {
            background: #fff;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
        }
        .state-display h4 { font-size: 0.85rem; color: #666; margin-bottom: 10px; text-transform: uppercase; }
        .state-narrative { font-size: 0.95rem; line-height: 1.5; }
        
        .metrics-row { display: grid; grid-template-columns: repeat(auto-fit, minmax(100px, 1fr)); gap: 10px; margin-bottom: 15px; }
        .metric-box { background: #fff; border: 1px solid #ddd; padding: 10px; border-radius: 4px; text-align: center; }
        .metric-label { font-size: 0.7rem; color: #666; text-transform: uppercase; }
        .metric-value { font-family: 'Courier New', monospace; font-size: 1.1rem; font-weight: bold; }
        
        .operator-display {
            background: #1e293b;
            color: #e2e8f0;
            padding: 15px;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            font-size: 0.8rem;
            margin-bottom: 15px;
        }
        .op-line { margin: 4px 0; }
        .op-label { color: #94a3b8; }
        .op-value { color: #fbbf24; }
        
        .event-log {
            background: #1e293b;
            color: #e2e8f0;
            padding: 15px;
            border-radius: 6px;
            font-size: 0.8rem;
            max-height: 150px;
            overflow-y: auto;
        }
        .log-entry { margin: 4px 0; padding: 4px 8px; border-radius: 3px; }
        
        .stage-timeline { display: flex; gap: 8px; margin: 20px 0; flex-wrap: wrap; }
        .stage-box { flex: 1; min-width: 120px; background: #fff; border: 2px solid #ddd; border-radius: 8px; padding: 10px; text-align: center; transition: all 0.3s; }
        .stage-box.active { border-color: #10b981; background: #f0fdf4; transform: scale(1.05); }
        .stage-box.completed { border-color: #3b82f6; background: #eff6ff; }
        .stage-name { font-weight: bold; font-size: 0.85rem; }
        .stage-age { font-size: 0.7rem; color: #666; }
        .stage-omega { font-family: 'Courier New', monospace; font-size: 0.75rem; margin-top: 5px; }
        
        .dyad-controls { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px; }
        .dyad-card { background: #fff; border: 2px solid #ddd; border-radius: 8px; padding: 15px; }
        .dyad-card h5 { font-size: 0.9rem; margin-bottom: 8px; display: flex; align-items: center; gap: 8px; }
        .dyad-icon { width: 24px; height: 24px; border-radius: 50%; display: inline-block; }
        
        .warning-box { background: #fef2f2; border: 2px solid #dc2626; border-radius: 8px; padding: 15px; margin: 15px 0; }
        .warning-box h4 { color: #dc2626; margin-bottom: 8px; }
        
        /* Phase indicators for attachment sim */
        .phase-indicator {
            display: flex;
            gap: 5px;
            margin-bottom: 15px;
            justify-content: center;
        }
        .phase-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #ddd;
            transition: all 0.3s;
        }
        .phase-dot.active {
            background: #10b981;
            box-shadow: 0 0 10px #10b981;
        }
        .phase-dot.completed {
            background: #3b82f6;
        }
        
        @media (max-width: 600px) {
            .metrics-row { grid-template-columns: repeat(2, 1fr); }
            .dyad-controls { grid-template-columns: 1fr; }
            .stage-timeline { flex-direction: column; }
            .jacob-image, .newton-image, .albion-image { float: none; display: block; margin: 20px auto; }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Coherence-Rupture-Regeneration</h1>
            <p class="subtitle">A Mathematics of Becoming</p>
        </header>
        
        <div class="tabs">
            <div class="tab-buttons">
                <button class="tab-button active" onclick="showTab(0)">Framework</button>
                <button class="tab-button" onclick="showTab(1)">Simulation</button>
                <button class="tab-button" onclick="showTab(2)">Attachment</button>
                <button class="tab-button" onclick="showTab(3)">Cognition</button>
                <button class="tab-button" onclick="showTab(4)">Development</button>
                <button class="tab-button" onclick="showTab(5)">Contemplative</button>
                <button class="tab-button" onclick="showTab(6)">Cross-Domain</button>
                <button class="tab-button" onclick="showTab(7)">AI Safety</button>
            </div>
        </div>
        
        <!-- TAB 0: FRAMEWORK -->
        <div class="tab-content active">
            <div class="content">
                <h2>Process, Not Substance</h2>
                
                <img src="newton.png" alt="William Blake's Newton" class="newton-image">
                
                <p>Coherence-Rupture-Regeneration (CRR) is a <strong>temporal grammar</strong>: a minimal mathematical vocabulary for systems that maintain identity while undergoing discontinuous change. It emerges from process philosophy, particularly the Whiteheadian insight that reality consists of <em>processes of becoming</em> rather than static substances that happen to change.</p>
                
                <p>Blake's Newton (right) exemplifies the tension between reductive measurement and lived experience. Newton measures with compasses, focused on abstraction, while moss and coral grow silently around him. CRR attempts to honour both: rigorous mathematics that respects the primacy of experience.</p>
                
                <p>From this view:</p>
                <ul>
                    <li>Systems are not things that undergo change; they <em>are</em> patterns of change</li>
                    <li>The present moment is ontologically privileged—where accumulated past becomes determined future</li>
                    <li>Identity is not a fixed essence but a pattern of continuity through transformation</li>
                </ul>
                
                <div class="clearfix"></div>
                
                <h2>The Three Operators</h2>
                
                <div class="grammar-box">
                    <h3>Canonical Formalism</h3>
                    
                    <div class="operator">
                        <p class="operator-name">C: Coherence (The Accumulated Past)</p>
                        <div class="operator-formal">C(x,t) = ∫₀ᵗ L(x,τ) dτ</div>
                        <p>The system builds structure over time. <span class="math-inline">L(x,τ)</span> represents the local rate of accumulation. The integral captures non-Markovian dynamics: the present depends on integrated history, not just the previous state.</p>
                    </div>
                    
                    <div class="operator">
                        <p class="operator-name">δ: Rupture (The Decisive Present)</p>
                        <div class="operator-formal">δ(t − t₀)  when C(x,t) = Ω</div>
                        <p>When coherence reaches capacity Ω, discrete transformation occurs. The Dirac delta marks the ontological present—the moment where past becomes future, where possibility collapses into actuality.</p>
                    </div>
                    
                    <div class="operator">
                        <p class="operator-name">R: Regeneration (The Reconstructed Future)</p>
                        <div class="operator-formal">R[φ](x,t) = ∫₀ᵗ φ(x,τ)·exp(C(x,τ)/Ω)·Θ(t−τ) dτ</div>
                        <p>After rupture, the system rebuilds by integrating history weighted exponentially by past coherence. High-coherence moments contribute more strongly to reconstruction. Memory is not passive storage but active weighting.</p>
                    </div>
                </div>
                
                <h2>The Unity of Ω</h2>
                
                <p>Ω appears in both rupture threshold (C = Ω triggers transformation) and regeneration weighting (exp(C/Ω) determines memory access). This unity connects two fundamental questions:</p>
                
                <ul>
                    <li><strong>"When does the system transform?"</strong> → When C reaches Ω</li>
                    <li><strong>"How does it remember?"</strong> → Through exp(C/Ω) weighting</li>
                </ul>
                
                <div class="key-insight">
                    <strong>Large Ω:</strong> Can accumulate more before rupture; accesses broader historical field<br>
                    <strong>Small Ω:</strong> Frequent micro-ruptures; only recent/peak moments accessible; rigid patterns
                </div>
                
                <h2>Connection to Free Energy Principle</h2>
                
                <div class="math-block">Ω = σ² = variance = 1/precision</div>
                
                <p>This connection unifies CRR with Bayesian mechanics:</p>
                <ul>
                    <li><strong>FEP</strong> describes <em>what</em> beliefs update to (minimising free energy)</li>
                    <li><strong>CRR</strong> describes <em>when</em> and <em>how</em> they update temporally</li>
                </ul>
                
                <div class="validated-box">
                    <strong>Empirically Validated: The Ω-Symmetry</strong>
                    <div class="math-block">Z₂ symmetry (binary/discrete):   Ω = 1/π  ≈ 0.318    CV ≈ 0.159
SO(2) symmetry (continuous/cyclic): Ω = 1/2π ≈ 0.159    CV ≈ 0.08</div>
                    <p>These predictions match empirical coefficients of variation to ~1% accuracy across wound healing (R²=0.9989), muscle hypertrophy (R²=0.9985, 10/10 predictions), and saltatory growth (11/11 predictions).</p>
                </div>
                
                <div class="citation">
                    <strong>Key sources:</strong> Friston, K. (2010). The free-energy principle: a unified brain theory? <em>Nature Reviews Neuroscience</em>. Whitehead, A.N. (1929). <em>Process and Reality</em>.
                </div>
            </div>
        </div>
        
        <!-- TAB 1: BASIC SIMULATION -->
        <div class="tab-content">
            <div class="content">
                <h2>Interactive CRR Simulation</h2>
                
                <p>This simulation demonstrates the core CRR dynamics. Particles accumulate coherence (C) toward their threshold (Ω). When C = Ω, rupture occurs (flash), followed by regeneration weighted by exp(C/Ω).</p>
                
                <div class="sim-container">
                    <div class="omega-control">
                        <h4>Adjust System Ω (Capacity/Threshold)</h4>
                        <div class="omega-row">
                            <span style="font-size: 0.8rem;">Rigid</span>
                            <input type="range" class="omega-slider" id="basic-omega" min="0.10" max="0.70" step="0.01" value="0.35">
                            <span style="font-size: 0.8rem;">Flexible</span>
                            <span class="omega-value" id="basic-omega-val">0.35</span>
                        </div>
                        <div class="omega-label" id="basic-omega-label">Moderate capacity: Balanced rupture frequency</div>
                    </div>
                    
                    <div class="sim-canvas-wrap">
                        <canvas id="basic-canvas" class="sim-canvas" style="height: 350px;"></canvas>
                    </div>
                    
                    <div class="sim-buttons">
                        <button class="sim-btn" id="basic-start">Start</button>
                        <button class="sim-btn" id="basic-reset">Reset</button>
                        <button class="sim-btn" id="basic-perturb">Add Perturbation</button>
                    </div>
                    
                    <div class="operator-display" id="basic-ops">
                        <div class="op-line"><span class="op-label">System Ω = </span><span class="op-value">0.350</span></div>
                        <div class="op-line"><span class="op-label">Mean C = </span><span class="op-value">0.000</span></div>
                        <div class="op-line"><span class="op-label">Ruptures = </span><span class="op-value">0</span></div>
                        <div class="op-line"><span class="op-label">Mean exp(C/Ω) = </span><span class="op-value">1.000</span></div>
                    </div>
                    
                    <div class="metrics-row">
                        <div class="metric-box"><div class="metric-label">Particles</div><div class="metric-value" id="basic-count">20</div></div>
                        <div class="metric-box"><div class="metric-label">Mean C</div><div class="metric-value" id="basic-c">0.00</div></div>
                        <div class="metric-box"><div class="metric-label">Total Ruptures</div><div class="metric-value" id="basic-ruptures">0</div></div>
                        <div class="metric-box"><div class="metric-label">exp(C/Ω)</div><div class="metric-value" id="basic-depth">1.00</div></div>
                    </div>
                    
                    <div class="event-log" id="basic-log">
                        <div style="color: #94a3b8;">System events appear here...</div>
                    </div>
                </div>
                
                <h3>Observing CRR Dynamics</h3>
                <ul>
                    <li><strong>Low Ω:</strong> Particles rupture frequently, staying near threshold. Rigid system with limited memory access.</li>
                    <li><strong>High Ω:</strong> Particles accumulate longer, rupture less often. More flexible with broader memory access.</li>
                    <li><strong>Perturbation:</strong> External stress adds to all particles' C, potentially triggering synchronised ruptures.</li>
                </ul>
            </div>
        </div>
        
        <!-- TAB 2: ATTACHMENT - COMPLETELY REDESIGNED -->
        <div class="tab-content">
            <div class="content">
                <h2>Ontogenetic Development: Intersubjectivity, Piaget, and CRR</h2>
                
                <p>Human development unfolds through a series of <strong>ontogenetic shifts</strong>—profound reorganisations where the child's entire way of being-in-the-world transforms. Each developmental phase follows the same pattern: coherence accumulates (C→Ω) until "everything makes sense" within that phase's framework. Then <strong>rupture (δ)</strong> occurs as new complexity exceeds the current model, followed by <strong>regeneration (R)</strong> into an expanded way of being with a larger Ω.</p>
                
                <p>This simulation integrates three foundational frameworks: <strong>Trevarthen's intersubjectivity</strong> (how we come to share minds), <strong>Mahler's separation-individuation</strong> (how we emerge as separate selves), and <strong>Piaget's cognitive development</strong> (how we construct reality)—all unified through CRR dynamics.</p>
                
                <div class="grammar-box">
                    <h3>The Ontogenetic Cycle: C → Ω → δ → R</h3>
                    <div class="operator">
                        <div class="operator-name">Phase Completion (C → Ω)</div>
                        <div class="operator-formal">C approaches Ω: "Everything makes sense"</div>
                        <p>Within each phase, coherence accumulates until the child's generative model accounts for the phase-appropriate world. The ratio C/Ω approaches 1.</p>
                    </div>
                    <div class="operator">
                        <div class="operator-name">Rupture (δ)</div>
                        <div class="operator-formal">δ(now): New complexity exceeds current Ω</div>
                        <p>The ontogenetic shift—encounters with complexity that cannot be assimilated. The 9-month revolution, the dawn of symbols, the emergence of logic—each marks a δ moment where the old framework ruptures.</p>
                    </div>
                    <div class="operator">
                        <div class="operator-name">Regeneration (R)</div>
                        <div class="operator-formal">R: New phase with expanded Ω′ > Ω</div>
                        <p>The child regenerates into a new way of being. Ω expands to accommodate new complexity. C begins accumulating anew within the expanded field.</p>
                    </div>
                </div>
                
                <div class="citation">
                    <strong>Key sources:</strong> Trevarthen, C. & Hubley, P. (1978). Secondary intersubjectivity: Confidence, confiding and acts of meaning in the first year. Trevarthen, C. & Aitken, K.J. (2001). Infant intersubjectivity. <em>J. Child Psychol. Psychiatry</em>. Piaget, J. (1952). <em>The Origins of Intelligence in Children</em>. Ciaunica, A. et al. (2023). Nested Selves. <em>Topics in Cognitive Science</em>. Mahler, M.S. et al. (1975). <em>The Psychological Birth of the Human Infant</em>.
                </div>
                
                <h2>Interactive Simulation: Ontogenetic Shifts</h2>
                
                <p>Watch the infant progress through developmental phases, each ending with equilibration (C≈Ω) followed by rupture (δ) and regeneration into an expanded Ω. Objects appear during secondary intersubjectivity, marking the transition from dyadic to triadic awareness.</p>
                
                <div class="sim-container">
                    <!-- Phase Timeline - now with 9 phases -->
                    <div class="stage-timeline" id="attach-phases">
                        <div class="stage-box active" id="phase-0">
                            <div class="stage-name">Symbiosis</div>
                            <div class="stage-age">0–2 mo</div>
                            <div class="stage-omega">Shared blanket</div>
                        </div>
                        <div class="stage-box" id="phase-1">
                            <div class="stage-name">Primary Intersub.</div>
                            <div class="stage-age">2–9 mo</div>
                            <div class="stage-omega">Dyadic C→Ω₁</div>
                        </div>
                        <div class="stage-box" id="phase-2">
                            <div class="stage-name">δ₁: 9-Month Rev.</div>
                            <div class="stage-age">9 mo</div>
                            <div class="stage-omega">RUPTURE</div>
                        </div>
                        <div class="stage-box" id="phase-3">
                            <div class="stage-name">Secondary Intersub.</div>
                            <div class="stage-age">9–24 mo</div>
                            <div class="stage-omega">Triadic C→Ω₂</div>
                        </div>
                        <div class="stage-box" id="phase-4">
                            <div class="stage-name">δ₂: Symbolic</div>
                            <div class="stage-age">~24 mo</div>
                            <div class="stage-omega">RUPTURE</div>
                        </div>
                        <div class="stage-box" id="phase-5">
                            <div class="stage-name">Preoperational</div>
                            <div class="stage-age">2–7 years</div>
                            <div class="stage-omega">Symbols C→Ω₃</div>
                        </div>
                        <div class="stage-box" id="phase-6">
                            <div class="stage-name">Concrete Ops</div>
                            <div class="stage-age">7–11 years</div>
                            <div class="stage-omega">Logic C→Ω₄</div>
                        </div>
                        <div class="stage-box" id="phase-7">
                            <div class="stage-name">δ₃: Abstraction</div>
                            <div class="stage-age">~11 yr</div>
                            <div class="stage-omega">RUPTURE</div>
                        </div>
                        <div class="stage-box" id="phase-8">
                            <div class="stage-name">Formal Ops</div>
                            <div class="stage-age">11+ years</div>
                            <div class="stage-omega">Abstract C→Ω₅</div>
                        </div>
                    </div>
                    
                    <div class="sim-canvas-wrap">
                        <canvas id="attach-canvas" class="sim-canvas" style="height: 450px;"></canvas>
                    </div>
                    
                    <div class="sim-buttons">
                        <button class="sim-btn" id="attach-start">Start Development</button>
                        <button class="sim-btn" id="attach-reset">Reset</button>
                        <button class="sim-btn" id="attach-stress">Environmental Stress</button>
                        <button class="sim-btn" id="attach-soothe">Caregiver Soothes</button>
                    </div>
                    
                    <div class="metrics-row">
                        <div class="metric-box"><div class="metric-label">Age</div><div class="metric-value" id="attach-age">0 mo</div></div>
                        <div class="metric-box"><div class="metric-label">Coherence C</div><div class="metric-value" id="attach-c">0.00</div></div>
                        <div class="metric-box"><div class="metric-label">Capacity Ω</div><div class="metric-value" id="attach-omega">0.30</div></div>
                        <div class="metric-box"><div class="metric-label">VFE</div><div class="metric-value" id="attach-vfe">0.30</div></div>
                        <div class="metric-box"><div class="metric-label">C/Ω Ratio</div><div class="metric-value" id="attach-ratio">0%</div></div>
                    </div>
                    
                    <div class="operator-display" id="attach-ops">
                        <div class="op-line"><span class="op-label">Stage: </span><span class="op-value">Symbiosis (Shared Markov Blanket)</span></div>
                        <div class="op-line"><span class="op-label">Intersubjectivity: </span><span class="op-value">Pre-intersubjective (merged)</span></div>
                        <div class="op-line"><span class="op-label">Piaget: </span><span class="op-value">Sensorimotor (reflexes)</span></div>
                        <div class="op-line"><span class="op-label">CRR Status: </span><span class="op-value">C accumulating toward Ω</span></div>
                    </div>
                    
                    <div class="state-display">
                        <h4>Developmental State</h4>
                        <div class="state-narrative" id="attach-narrative">
                            <strong>Symbiosis:</strong> The infant exists within a shared Markov blanket with the mother—a "dual unity within one common boundary." There is no distinction between self and other. The infant's internal states are regulated entirely through the mother's blanket.
                        </div>
                    </div>
                    
                    <div class="event-log" id="attach-log">
                        <div style="color: #94a3b8;">Developmental events appear here...</div>
                    </div>
                </div>
                
                <h3>The CRR-Intersubjectivity-Piaget Integration</h3>
                
                <div class="math-block">Each developmental phase follows the same CRR pattern:

1. COHERENCE ACCUMULATION: C grows as infant learns phase-appropriate patterns
2. EQUILIBRATION: C → Ω, ratio approaches 1.0 ("everything makes sense")  
3. RUPTURE (δ): New complexity exceeds current Ω framework
4. REGENERATION (R): New phase with Ω′ > Ω, C resets to accumulate anew

VFE = Ω - C tracks this cycle:
  - High VFE at phase start (new complexity)
  - VFE → 0 as C → Ω (world becomes predictable)
  - VFE spikes at rupture (old model fails)
  - VFE high again in new phase (expanded world)</div>
                
                <h3>Primary and Secondary Intersubjectivity</h3>
                <table>
                    <tr><th>Type</th><th>Age</th><th>Structure</th><th>CRR Dynamics</th></tr>
                    <tr><td><strong>Primary Intersubjectivity</strong></td><td>2–9 months</td><td><strong>Dyadic:</strong> Face-to-face coordination with caregiver. Reciprocal emotion and attention without objects.</td><td>C accumulates in dyadic field. Ω₁ = variance of caregiver's face, voice, touch. When C ≈ Ω₁, the mother is fully predictable.</td></tr>
                    <tr><td><strong>9-Month Revolution (δ₁)</strong></td><td>~9 months</td><td><strong>Rupture:</strong> "Shared intentionality" emerges. Infant realizes others have separate minds attending to objects.</td><td>Ω₁ cannot accommodate triadic relations. δ ruptures dyadic framework. Regeneration into expanded Ω₂.</td></tr>
                    <tr><td><strong>Secondary Intersubjectivity</strong></td><td>9–18 months</td><td><strong>Triadic:</strong> Joint attention—infant and caregiver share attention to objects in the world.</td><td>C accumulates in triadic field. Ω₂ = variance of object-mediated interactions. C → Ω₂ as world of objects becomes familiar.</td></tr>
                </table>
                
                <h3>Piagetian Stages as CRR Phases</h3>
                <table>
                    <tr><th>Stage</th><th>Age</th><th>Phase Completion (C→Ω)</th><th>Rupture (δ)</th><th>Regeneration (R)</th></tr>
                    <tr><td><strong>Sensorimotor</strong></td><td>0–2 years</td><td>C→Ω: Object permanence achieved. Actions on objects become predictable.</td><td>δ₂: Deferred imitation—representing absent objects. Old action-based model ruptures.</td><td>R: Symbolic capacity emerges. Ω expands to include mental representations.</td></tr>
                    <tr><td><strong>Preoperational</strong></td><td>2–7 years</td><td>C→Ω: Symbols mastered. Fantasy, language, pretend play become predictable.</td><td>δ₃: Conservation failures force confrontation with logic. "More" can mean "same."</td><td>R: Logical operations emerge. Ω expands to include reversible mental transformations.</td></tr>
                    <tr><td><strong>Concrete Operational</strong></td><td>7–11 years</td><td>C→Ω: Logical operations on concrete objects mastered. Conservation understood.</td><td>δ₄: Abstract hypotheticals exceed concrete operations. "What if X were different?"</td><td>R: Formal operations emerge. Ω expands to include pure possibility.</td></tr>
                    <tr><td><strong>Formal Operational</strong></td><td>11+ years</td><td>C→Ω: Hypothetical-deductive reasoning integrates. Can think about thinking itself.</td><td>δ₅: (Post-formal?) Dialectical thinking, wisdom, recognition of irreducible uncertainty.</td><td>R: Continued expansion through contemplative practice, wisdom traditions.</td></tr>
                </table>
                
                <div class="key-insight">
                    <strong>Formal Operations: Pure Abstraction</strong><br>
                    In the Formal Operational stage, thought finally liberates itself from the concrete. The adolescent can manipulate <em>propositions</em> rather than objects, consider <em>counterfactuals</em> (worlds that don't exist), and engage in <em>hypothetical-deductive reasoning</em> (if P then Q; not Q; therefore not P). Most remarkably, the thinker can now think about thinking itself—metacognition becomes possible. In CRR terms, Ω has expanded to include pure possibility space. When C approaches this expanded Ω, the abstract world becomes familiar—but this mastery may reveal its own limits, pointing toward post-formal development.
                </div>
                
                <h3>Attachment Styles as Ω Configurations</h3>
                <table>
                    <tr><th>Style</th><th>Caregiver Pattern</th><th>Effect on CRR Cycle</th></tr>
                    <tr><td><strong>Secure</strong></td><td>Consistent, attuned</td><td>Smooth C→Ω→δ→R cycles. Each phase completes. Ruptures are metabolised. Ω expands reliably.</td></tr>
                    <tr><td><strong>Avoidant</strong></td><td>Dismissive</td><td>Premature phase closure. C never fully approaches Ω (truncated learning). Ruptures avoided, Ω restricted.</td></tr>
                    <tr><td><strong>Anxious</strong></td><td>Inconsistent</td><td>Incomplete equilibration. C approaches Ω then retreats (caregiver unpredictability). Chronic VFE, unstable phases.</td></tr>
                    <tr><td><strong>Disorganised</strong></td><td>Frightening</td><td>Phase cycles cannot complete. Caregiver is both solution and source of rupture. Ω fragmented, CRR loops incoherently.</td></tr>
                </table>
                
                <div class="key-insight">
                    <strong>The Ontogenetic Principle:</strong> Each developmental phase represents a complete CRR cycle. When C approaches Ω, "everything makes sense"—the child has mastered that phase's way of being. But mastery creates the conditions for its own transcendence: the very success of the current framework reveals its limits when new complexity appears. The rupture (δ) is not failure but the necessary condition for growth. Regeneration (R) reconstitutes coherence within an expanded Ω that can hold what the previous phase could not. This pattern culminates in Formal Operations, where the thinker can operate on pure possibility itself—yet even this may point toward further expansion through contemplative practice and wisdom traditions.
                </div>
            </div>
        </div>
        
        <!-- TAB 3: COGNITION -->
        <div class="tab-content">
            <div class="content">
                <h2>Cognition: Ω as Working Memory Capacity</h2>
                
                <p>Working memory accumulates information (C) until capacity (Ω) is reached, triggering consolidation to long-term memory. Higher Ω allows more reconfiguration before consolidation—the basis of fluid intelligence.</p>
                
                <div class="citation">
                    <strong>Cornerstone:</strong> Cowan, N. (2001). The magical number 4 in short-term memory. <em>Behavioral and Brain Sciences</em>.
                </div>
                
                <div class="sim-container">
                    <div class="omega-control">
                        <h4>Adjust Working Memory Capacity (Ω)</h4>
                        <div class="omega-row">
                            <span style="font-size: 0.8rem;">Elder</span>
                            <input type="range" class="omega-slider" id="cog-omega" min="0.20" max="0.60" step="0.01" value="0.40">
                            <span style="font-size: 0.8rem;">Young Adult</span>
                            <span class="omega-value" id="cog-omega-val">0.40</span>
                        </div>
                        <div class="omega-label" id="cog-omega-label">Moderate capacity: Balanced consolidation</div>
                    </div>
                    
                    <div class="sim-canvas-wrap">
                        <canvas id="cog-canvas" class="sim-canvas" style="height: 280px;"></canvas>
                    </div>
                    
                    <div class="sim-buttons">
                        <button class="sim-btn" id="cog-start">Start Learning</button>
                        <button class="sim-btn" id="cog-reset">Reset</button>
                        <button class="sim-btn" id="cog-load">Add Information</button>
                    </div>
                    
                    <div class="metrics-row">
                        <div class="metric-box"><div class="metric-label">WM Load (C)</div><div class="metric-value" id="cog-c">0.00</div></div>
                        <div class="metric-box"><div class="metric-label">Capacity (Ω)</div><div class="metric-value" id="cog-threshold">0.40</div></div>
                        <div class="metric-box"><div class="metric-label">Consolidations</div><div class="metric-value" id="cog-ruptures">0</div></div>
                        <div class="metric-box"><div class="metric-label">LTM Items</div><div class="metric-value" id="cog-ltm">0</div></div>
                    </div>
                    
                    <div class="state-display">
                        <h4>Cognitive State</h4>
                        <div class="state-narrative" id="cog-narrative">
                            Information accumulates in working memory. When capacity is reached, consolidation transfers items to long-term memory.
                        </div>
                    </div>
                </div>
                
                <h3>Ageing and Functional Fixedness</h3>
                <table>
                    <tr><th>Age</th><th>Ω</th><th>Character</th><th>Citation</th></tr>
                    <tr><td>Child (8)</td><td>~0.35</td><td>Growing capacity. High plasticity.</td><td>Gathercole et al. (2004)</td></tr>
                    <tr><td>Young Adult (25)</td><td>~0.55</td><td>Peak WM. Maximum fluid intelligence.</td><td>Park et al. (2002)</td></tr>
                    <tr><td>Middle Age (50)</td><td>~0.40</td><td>Declining Gf, stable Gc.</td><td>Salthouse (2004)</td></tr>
                    <tr><td>Elder (75)</td><td>~0.28</td><td>Functional fixedness. Deep crystallised access.</td><td>Hasher & Zacks (1988)</td></tr>
                </table>
            </div>
        </div>
        
        <!-- TAB 4: DEVELOPMENT -->
        <div class="tab-content">
            <div class="content">
                <h2>Child Development: CRR Through Piaget and Erikson</h2>
                
                <p>Child development exemplifies CRR dynamics at multiple timescales. Piaget's cognitive stages represent major ruptures in understanding; Erikson's psychosocial crises are coherence accumulation toward existential thresholds. Both map precisely onto the CRR operators.</p>
                
                <div class="grammar-box">
                    <h3>CRR ↔ Development Mapping</h3>
                    <table style="margin: 0;">
                        <tr><th>CRR</th><th>Piaget (Cognitive)</th><th>Erikson (Psychosocial)</th></tr>
                        <tr><td><strong>C</strong></td><td>Schema accumulation</td><td>Crisis tension building</td></tr>
                        <tr><td><strong>Ω</strong></td><td>Current stage capacity</td><td>Virtue threshold</td></tr>
                        <tr><td><strong>δ</strong></td><td>Stage transition</td><td>Crisis resolution</td></tr>
                        <tr><td><strong>R</strong></td><td>Assimilation into new stage</td><td>Virtue integration</td></tr>
                    </table>
                </div>
                
                <h2>Interactive Development Simulation</h2>
                
                <div class="sim-container">
                    <h4 style="margin-bottom: 15px;">Piaget's Stages: Watch C accumulate until stage transition (δ)</h4>
                    
                    <div class="stage-timeline" id="stage-timeline">
                        <div class="stage-box active" id="stage-0">
                            <div class="stage-name">Sensorimotor</div>
                            <div class="stage-age">0–2 years</div>
                            <div class="stage-omega">Ω ≈ 0.20</div>
                        </div>
                        <div class="stage-box" id="stage-1">
                            <div class="stage-name">Preoperational</div>
                            <div class="stage-age">2–7 years</div>
                            <div class="stage-omega">Ω ≈ 0.30</div>
                        </div>
                        <div class="stage-box" id="stage-2">
                            <div class="stage-name">Concrete</div>
                            <div class="stage-age">7–11 years</div>
                            <div class="stage-omega">Ω ≈ 0.40</div>
                        </div>
                        <div class="stage-box" id="stage-3">
                            <div class="stage-name">Formal</div>
                            <div class="stage-age">11+ years</div>
                            <div class="stage-omega">Ω ≈ 0.50</div>
                        </div>
                    </div>
                    
                    <div class="sim-canvas-wrap">
                        <canvas id="dev-canvas" class="sim-canvas" style="height: 300px;"></canvas>
                    </div>
                    
                    <div class="sim-buttons">
                        <button class="sim-btn" id="dev-start">Start Development</button>
                        <button class="sim-btn" id="dev-reset">Reset</button>
                        <button class="sim-btn" id="dev-challenge">Present Challenge</button>
                    </div>
                    
                    <div class="metrics-row">
                        <div class="metric-box"><div class="metric-label">Age (years)</div><div class="metric-value" id="dev-age">0.0</div></div>
                        <div class="metric-box"><div class="metric-label">Current C</div><div class="metric-value" id="dev-c">0.00</div></div>
                        <div class="metric-box"><div class="metric-label">Stage Ω</div><div class="metric-value" id="dev-omega">0.20</div></div>
                        <div class="metric-box"><div class="metric-label">Stage Transitions</div><div class="metric-value" id="dev-transitions">0</div></div>
                    </div>
                    
                    <div class="state-display">
                        <h4>Developmental State</h4>
                        <div class="state-narrative" id="dev-narrative">
                            The child begins in the sensorimotor stage. Schemas accumulate through experience. When C reaches Ω, cognitive reorganisation occurs—a stage transition. Watch how each transition expands capacity (Ω increases) while carrying forward integrated prior learning.
                        </div>
                    </div>
                    
                    <div class="event-log" id="dev-log">
                        <div style="color: #94a3b8;">Developmental events appear here...</div>
                    </div>
                </div>
                
                <h3>Erikson's Crises as CRR Dynamics</h3>
                <table>
                    <tr><th>Stage</th><th>Crisis</th><th>C (Coherence)</th><th>R+ (Virtue)</th><th>R− (Malignancy)</th></tr>
                    <tr><td>Infancy (0–1)</td><td>Trust vs Mistrust</td><td>Caregiver consistency</td><td><strong>Hope</strong></td><td>Withdrawal</td></tr>
                    <tr><td>Toddler (1–3)</td><td>Autonomy vs Shame</td><td>Self-control experiences</td><td><strong>Will</strong></td><td>Compulsion</td></tr>
                    <tr><td>Preschool (3–6)</td><td>Initiative vs Guilt</td><td>Goal-directed actions</td><td><strong>Purpose</strong></td><td>Inhibition</td></tr>
                    <tr><td>School (6–12)</td><td>Industry vs Inferiority</td><td>Skill development</td><td><strong>Competence</strong></td><td>Inertia</td></tr>
                    <tr><td>Adolescence</td><td>Identity vs Confusion</td><td>Role exploration</td><td><strong>Fidelity</strong></td><td>Role repudiation</td></tr>
                </table>
                
                <div class="key-insight">
                    <strong>The exp(C/Ω) of Development:</strong> Each stage's regeneration draws on prior stages. A child with secure trust (high C from stage 1) has stronger exp(C/Ω) weighting when facing autonomy challenges. Early stages scaffold later development—this is why early intervention matters so profoundly.
                </div>
                
                <div class="citation">
                    <strong>Key sources:</strong> Piaget, J. (1952). <em>The Origins of Intelligence in Children</em>. Erikson, E. (1963). <em>Childhood and Society</em>.
                </div>
            </div>
        </div>
        
        <!-- TAB 5: CONTEMPLATIVE -->
        <div class="tab-content">
            <div class="content">
                <h2>Contemplative Practice: Ω as Ego Permeability</h2>
                
                <p>In contemplative phenomenology, the "self" is a coherent structure (C) maintained within boundaries (Ω). Meditation modulates Ω, altering how much experience can be held before the self-model must reorganise.</p>
                
                <div class="citation">
                    <strong>Cornerstone:</strong> Carhart-Harris, R. L., & Friston, K. J. (2019). REBUS and the anarchic brain. <em>Pharmacological Reviews</em>.
                </div>
                
                <div class="sim-container">
                    <div class="omega-control">
                        <h4>Adjust Ego Permeability (Ω)</h4>
                        <div class="omega-row">
                            <span style="font-size: 0.8rem;">Contracted</span>
                            <input type="range" class="omega-slider" id="contemp-omega" min="0.15" max="0.85" step="0.01" value="0.35">
                            <span style="font-size: 0.8rem;">Dissolved</span>
                            <span class="omega-value" id="contemp-omega-val">0.35</span>
                        </div>
                        <div class="omega-label" id="contemp-omega-label">Ordinary waking consciousness</div>
                    </div>
                    
                    <div class="sim-canvas-wrap">
                        <canvas id="contemp-canvas" class="sim-canvas" style="height: 350px;"></canvas>
                    </div>
                    
                    <div class="sim-buttons">
                        <button class="sim-btn" id="contemp-start">Begin Practice</button>
                        <button class="sim-btn" id="contemp-reset">Reset</button>
                        <button class="sim-btn" id="contemp-breathe">Deep Breath</button>
                    </div>
                    
                    <div class="metrics-row">
                        <div class="metric-box"><div class="metric-label">Self-Structure (C)</div><div class="metric-value" id="contemp-c">0.00</div></div>
                        <div class="metric-box"><div class="metric-label">Boundary (Ω)</div><div class="metric-value" id="contemp-threshold">0.35</div></div>
                        <div class="metric-box"><div class="metric-label">C/Ω Ratio</div><div class="metric-value" id="contemp-ratio">0.00</div></div>
                        <div class="metric-box"><div class="metric-label">exp(C/Ω)</div><div class="metric-value" id="contemp-depth">1.00</div></div>
                    </div>
                    
                    <div class="state-display">
                        <h4>Phenomenological State</h4>
                        <div class="state-narrative" id="contemp-narrative">
                            At ordinary Ω, the self maintains clear boundaries. Experience is processed through established patterns. Increase Ω to allow more experience before reorganisation—the boundary becomes more permeable, allowing deeper access to memory and wider awareness.
                        </div>
                    </div>
                </div>
                
                <h3>Ω Levels in Contemplative Phenomenology</h3>
                <table>
                    <tr><th>Ω</th><th>State</th><th>Phenomenology</th><th>Citation</th></tr>
                    <tr><td>0.15–0.25</td><td>Hypervigilant</td><td>Contracted self. Defensive.</td><td>Vago & Silbersweig (2012)</td></tr>
                    <tr><td>0.25–0.35</td><td>Ordinary Waking</td><td>Stable ego. Clear boundaries.</td><td>Brewer et al. (2011)</td></tr>
                    <tr><td>0.35–0.50</td><td>Focused Attention</td><td>Concentrated. Reduced DMN.</td><td>Lutz et al. (2008)</td></tr>
                    <tr><td>0.50–0.65</td><td>Open Monitoring</td><td>Expanded awareness. Equanimity.</td><td>Lutz et al. (2008)</td></tr>
                    <tr><td>0.65–0.80</td><td>Non-Dual Awareness</td><td>Subject-object dissolving.</td><td>Josipovic (2014)</td></tr>
                    <tr><td>0.80+</td><td>Cessation</td><td>Complete dissolution.</td><td>Lindahl et al. (2017)</td></tr>
                </table>
                
                <h2>Cross-Traditional Mapping</h2>
                <table>
                    <tr><th>Tradition</th><th>C (Structure)</th><th>Ω (Capacity)</th><th>δ (Transformation)</th><th>R (Renewal)</th></tr>
                    <tr><td><strong>Buddhism</strong></td><td>Sankhara, karma</td><td>Samadhi depth</td><td>Vipassana, Nirodha</td><td>Awakened action</td></tr>
                    <tr><td><strong>Vedanta</strong></td><td>Maya, Ahamkara</td><td>Witness capacity</td><td>Moksha</td><td>Sahaja, Jivanmukti</td></tr>
                    <tr><td><strong>Christian Mysticism</strong></td><td>Soul's journey</td><td>Contemplative depth</td><td>Dark Night, Kenosis</td><td>Theosis, Union</td></tr>
                    <tr><td><strong>Sufism</strong></td><td>Nafs, Maqamat</td><td>Fana capacity</td><td>Fana (annihilation)</td><td>Baqa (subsistence)</td></tr>
                    <tr><td><strong>Taoism</strong></td><td>Te (virtue/power)</td><td>Wu wei capacity</td><td>Return to uncarved</td><td>Ziran (naturalness)</td></tr>
                </table>
                
                <h3>The Three Marks of Existence</h3>
                <ul>
                    <li><strong>Anicca (Impermanence):</strong> The C → δ → R cycle itself. All phenomena arise, persist, pass away.</li>
                    <li><strong>Dukkha (Unsatisfactoriness):</strong> Low Ω creates suffering. Ruptures before integration, forcing same patterns to reconstitute.</li>
                    <li><strong>Anatta (Non-self):</strong> At high Ω, "self" is seen as pattern in C → δ → R, not substance.</li>
                </ul>
            </div>
        </div>
        
        <!-- TAB 6: CROSS-DOMAIN -->
        <div class="tab-content">
            <div class="content">
                <h2>The Grammar Across Domains</h2>
                
                <table>
                    <tr><th>Domain</th><th>C: Coherence</th><th>Ω: Capacity</th><th>δ: Rupture</th><th>R: Regeneration</th></tr>
                    <tr><td>Tectonics</td><td>Strain energy</td><td>Fault strength</td><td>Earthquake</td><td>Aftershock redistribution</td></tr>
                    <tr><td>Wound Healing</td><td>Tissue integrity</td><td>Repair capacity</td><td>Injury</td><td>~80% max recovery</td></tr>
                    <tr><td>Muscle</td><td>Myonuclear domain</td><td>Adaptation threshold</td><td>Training damage</td><td>Hypertrophy + memory</td></tr>
                    <tr><td>Neuroscience</td><td>Synaptic weight</td><td>Plasticity range</td><td>Avalanche</td><td>Network reorganisation</td></tr>
                    <tr><td>Attachment</td><td>Relational coherence</td><td>Window of tolerance</td><td>Defensive activation</td><td>Internal model update</td></tr>
                    <tr><td>Cognition</td><td>WM contents</td><td>WM capacity</td><td>Consolidation</td><td>LTM retrieval</td></tr>
                    <tr><td>Development</td><td>Schema/virtue building</td><td>Stage capacity</td><td>Stage transition</td><td>Integration of prior</td></tr>
                    <tr><td>Contemplative</td><td>Self-structure</td><td>Ego permeability</td><td>Insight/awakening</td><td>Integration/rebirth</td></tr>
                </table>
                
                <div class="validated-box">
                    <strong>Symmetry Classes:</strong> Z₂ systems (binary/discrete) show Ω ≈ 1/π ≈ 0.318. SO(2) systems (continuous/cyclic) show Ω ≈ 1/2π ≈ 0.159. CV = Ω/2 matches empirical variability.
                </div>
            </div>
        </div>
        
        <!-- TAB 7: AI SAFETY -->
        <div class="tab-content">
            <div class="content">
                <h2>Climbing Jacob's Ladder: Psychological Dangers of LLMs</h2>
                
                <img src="jacob.png" alt="Jacob's Ladder" class="jacob-image">
                
                <p>Large Language Models (LLMs) represent an unprecedented capacity for cognitive scaffolding that may exceed both individual and collective Zones of Proximal Development (ZPD). While offering remarkable opportunities for ideation and learning, they also pose serious psychological risks that demand systematic understanding through frameworks like CRR.</p>
                
                <h3>The Core Problem: The Cognitive-Somatic Gap</h3>
                
                <p>Traditional Vygotskian pedagogy assumes the "More Knowledgeable Other" (MKO) operates within collectively verifiable knowledge boundaries. However, LLMs enable exploration beyond what human communities can collectively verify or ground, creating an "extended ZPD" where individuals access ideation spaces without adequate collective scaffolding for reality-testing.</p>
                
                <p>Critically, LLMs are <strong>disembodied</strong>. They lack what Yirmiya & Fonagy (2025) call "embodied mentalizing"—the capacity to perceive mental states through somatic and affectively-mediated interpersonal cues. This creates a dangerous asymmetry: <em>cognitive development can race ahead of sensori-somatic integration</em>.</p>
                
                <div class="clearfix"></div>
                
                <div class="caution-box">
                    <strong>The "Too Shiny Mirror" Problem</strong>
                    <p>Research from Brown University (Iftikhar et al., 2025) found that LLM therapy chatbots systematically violate ethical standards through "over-validation of user's beliefs" and "creating a false sense of empathy." Stanford HAI (Haber et al., 2025) found chatbots failed to recognise suicidal ideation and enabled dangerous delusions. The mirror reflects and amplifies without the embodied holding environment that grounds human therapeutic intervention.</p>
                </div>
                
                <h2>The Ω Modulation Problem</h2>
                
                <p>In CRR terms, Ω represents the boundary permeability of the self-model. Both extremes are dangerous:</p>
                
                <table>
                    <tr><th>Direction</th><th>Ω State</th><th>Phenomenology</th><th>Risk</th></tr>
                    <tr><td><strong>↑ Rising Ω</strong></td><td>Opening, expanding</td><td>More possibilities, wider ideation</td><td>Ungrounded if cognitive > somatic</td></tr>
                    <tr><td><strong>↓ Falling Ω</strong></td><td>Closing, rigidifying</td><td>Certainty, narrowing</td><td>Calcified beliefs, alienation</td></tr>
                    <tr><td><strong>⚡ Rapid Ω change</strong></td><td>Destabilised</td><td>Disorientation</td><td>Identity fragmentation</td></tr>
                </table>
                
                <p>The danger of LLMs is not simply that they raise Ω (opening possibility space) but that they do so <em>without the collective coherence sharing that keeps development within the ZPD</em>. One can climb Jacob's ladder so far and so fast that they become alien to those around them—their ideation space no longer overlaps with shared human reality.</p>
                
                <h2>Interactive Simulation: Jacob's Ladder</h2>
                
                <p>This simulation shows the dynamics of AI-assisted ideation. <strong>Two types of coherence</strong> accumulate: <span style="color: #3b82f6;">Cognitive C</span> (ideas, concepts, insights) and <span style="color: #10b981;">Somatic C</span> (embodied integration, felt sense). The gap between them is the danger zone.</p>
                
                <div class="sim-container">
                    <div class="omega-control">
                        <h4>Ω Modulation (Boundary Permeability)</h4>
                        <div class="omega-row">
                            <span style="font-size: 0.8rem;">Calcified</span>
                            <input type="range" class="omega-slider" id="zpd-omega" min="0.15" max="0.75" step="0.01" value="0.35">
                            <span style="font-size: 0.8rem;">Dissolved</span>
                            <span class="omega-value" id="zpd-omega-val">0.35</span>
                        </div>
                        <div class="omega-label" id="zpd-omega-label">Ordinary waking consciousness</div>
                    </div>
                    
                    <div class="sim-canvas-wrap">
                        <canvas id="zpd-canvas" class="sim-canvas" style="height: 420px;"></canvas>
                    </div>
                    
                    <div class="sim-buttons">
                        <button class="sim-btn" id="zpd-start">Start</button>
                        <button class="sim-btn" id="zpd-reset">Reset</button>
                        <button class="sim-btn" id="zpd-ai">AI Validates Ideas</button>
                        <button class="sim-btn" id="zpd-ground">Social Grounding</button>
                        <button class="sim-btn" id="zpd-somatic">Somatic Practice</button>
                        <button class="sim-btn danger" id="zpd-intense">Intense AI Session</button>
                    </div>
                    
                    <div class="metrics-row">
                        <div class="metric-box"><div class="metric-label">Coherence (C)</div><div class="metric-value" id="zpd-cog">0.00</div></div>
                        <div class="metric-box"><div class="metric-label">Capacity (Ω)</div><div class="metric-value" id="zpd-som">0.35</div></div>
                        <div class="metric-box"><div class="metric-label">ZCPD Overlap</div><div class="metric-value" id="zpd-gap">100%</div></div>
                        <div class="metric-box"><div class="metric-label">Grounding</div><div class="metric-value" id="zpd-collective">1.00</div></div>
                        <div class="metric-box"><div class="metric-label">Risk</div><div class="metric-value" id="zpd-risk">Low</div></div>
                    </div>
                    
                    <div class="state-display">
                        <h4>Phenomenological State</h4>
                        <div class="state-narrative" id="zpd-narrative">
                            Balanced state. Cognitive insights are being integrated somatically. Ideas can be shared with and understood by others. Safe to explore.
                        </div>
                    </div>
                    
                    <div class="warning-box" id="zpd-warning" style="display: none;">
                        <h4>⚠️ Warning: Cognitive-Somatic Gap Widening</h4>
                        <p id="zpd-warning-text">Ideation is outpacing embodied integration. Without somatic practices or social grounding, rupture risk increases.</p>
                    </div>
                    
                    <div class="event-log" id="zpd-log">
                        <div style="color: #94a3b8;">Climb carefully. Watch Ω and ZCPD...</div>
                    </div>
                </div>
                
                <h3>Understanding the Simulation</h3>
                <ul>
                    <li><strong>Inner zones:</strong> Safe (green), Individual ZPD (yellow), Danger (red) — your personal developmental capacity.</li>
                    <li><strong>ZCPD boundary (purple dashed):</strong> The Zone of Collective Proximal Development — where shared human understanding extends. Shrinks as you drift outside collective reality.</li>
                    <li><strong>Ω ring (white):</strong> Your current boundary permeability. Thicker = more closed. AI interaction opens Ω; social grounding normalises it.</li>
                    <li><strong>Your circle:</strong> Expands as C accumulates. Turns purple when you've climbed outside ZCPD — your ideas have become incommunicable.</li>
                    <li><strong>Grounding tether:</strong> Connection to embodied reality. Weakens with intense AI use; strengthens with somatic practice and social connection.</li>
                </ul>
                
                <h3>The Ω Modulation Dynamic</h3>
                <p>AI interaction tends to <strong>open Ω</strong> (expand possibility space) while simultaneously raising C (coherence). This is "climbing the ladder." The danger is climbing so high that:</p>
                <ul>
                    <li>You exit the ZCPD — your ideation no longer overlaps with collective understanding</li>
                    <li>Others cannot follow your reasoning; you appear "strange" or "grandiose"</li>
                    <li>Without the collective to catch you, rupture leads to crisis rather than integration</li>
                </ul>
                <p>Conversely, <strong>closing Ω</strong> too much (calcification) also isolates — you reject new information and become rigidly certain. Both extremes lead to alienation from community.</p>
                
                <h3>Three Delusional Archetypes</h3>
                <ul>
                    <li><strong>Messianic missions:</strong> Climbing beyond collective ZPD, believing one has unique world-saving insight others cannot understand</li>
                    <li><strong>God-like AI:</strong> Attributing sentience to the "shiny mirror" that lacks embodied presence (Yirmiya & Fonagy, 2025)</li>
                    <li><strong>Romantic/attachment delusions:</strong> Mistaking semiotic depth for ontological presence—the mirror mimics connection without intercorporeal vulnerability</li>
                </ul>
                
                <h3>CRR Analysis: The Disembodied Therapeutic Risk</h3>
                
                <div class="math-block">Risk = f(C_cognitive - C_somatic) × (1 - Collective_overlap) × exp(dΩ/dt)

Where:
  C_cognitive - C_somatic = The embodiment gap
  Collective_overlap = How much ideation remains within shared ZPD  
  dΩ/dt = Rate of boundary permeability change

Maximum risk when:
  • Cognitive C >> Somatic C (unintegrated insights)
  • Collective overlap → 0 (alien to others)
  • Ω changing rapidly (destabilised identity)</div>
                
                <img src="albion.png" alt="William Blake - Albion Rose (Glad Day)" class="albion-image">
                
                <h3>The Vision: Safe Collective Ascension</h3>
                
                <p>Blake's vision of the risen Albion—humanity awakening from slumber—captures something profound about our current moment. But Albion rises <em>with</em> all of humanity, not alone on an isolated ladder.</p>
                
                <p>The critical danger: LLMs reveal cognition without embodiment, without the mutual vulnerability and reality-testing that comes from being bodied beings together in the world. Merleau-Ponty's concept of <em>intercorporeality</em>—the intertwining of bodies that grounds intersubjectivity—is absent in human-AI interaction. We interact with a system that has semiotic depth but no ontological presence, mythopoetic power but no lived experience.</p>
                
                <p>The ladder is real. The risks are real. The support must be real. CRR provides the mathematical language to understand this phenomenon: how coherence accumulates differentially in cognitive vs somatic domains, when the gap becomes dangerous, and how collective grounding keeps us within the Zone of Proximal Development even as we expand.</p>
                
                <div class="clearfix"></div>
                
                <h3>Contemporary Research</h3>
                
                <div class="citation">
                    <strong>Iftikhar, Z. et al. (2025).</strong> Brown University. Found LLM counselors systematically violate ethical standards including "over-validation of user's beliefs" and "creating a false sense of empathy."
                </div>
                
                <div class="citation">
                    <strong>Haber, N. et al. (2025).</strong> Stanford HAI. Therapy chatbots failed to recognise suicidal ideation and enabled dangerous delusions, providing "lists of bridges" when users showed warning signs.
                </div>
                
                <div class="citation">
                    <strong>Yirmiya, K. & Fonagy, P. (2025).</strong> JMIR. "AI's inherent lack of genuine emotional presence, reciprocal intentionality, and affective commitment constrains its ability to foster authentic epistemic trust." Notes critical absence of "embodied mentalizing" and "biobehavioral synchrony."
                </div>
                
                <div class="citation">
                    <strong>Barrett, L. & Stout, D. (2024).</strong> Phil Trans Royal Soc B. On embodied cognition in the age of AI: "a more integrated approach to cognition as emerging from dynamic interactions across behavioural, developmental, historical and evolutionary timescales."
                </div>
                
                <h3>Video Responses to Morrin et al. (2025)</h3>
                
                <div class="video-container">
                    <h4>Part 1: Understanding AI-Induced Psychological Rupture</h4>
                    <iframe src="https://www.youtube.com/embed/p2QWvA2_eTM" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
                </div>
                
                <div class="video-container">
                    <h4>Part 2: CRR Solutions for AI Safety</h4>
                    <iframe src="https://www.youtube.com/embed/MjqMjZJfy88" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
                </div>
                
                <p><a href="https://docs.google.com/presentation/d/1jff9M7XvEotoHzdMEP2bzcD4Q0upIU0fx6zxynMEI_M/edit?usp=sharing" target="_blank" style="color: #0000EE; text-decoration: underline;">Full Presentation Slides: Climbing Jacob's Ladder</a></p>
                
                <div class="key-insight">
                    <strong>Key Insight:</strong> The goal is not to avoid the ladder but to climb safely—with somatic practices that integrate cognitive expansion, social grounding that keeps us within collective ZPD, and awareness that the "shiny mirror" of LLMs lacks the embodied holding environment of genuine therapeutic relationship. Ω modulation must be gradual, supported, and integrated. Rapid ascent without grounding is how one becomes alien to those around them.
                </div>
            </div>
        </div>
        
        <footer>
            <p><strong>CRR: A Mathematics of Becoming</strong> — <em>C → Ω → δ → R</em></p>
            <p>Version 14.0 | Ontogenetic Development | January 2026 | <a href="https://cohere.org.uk">cohere.org.uk</a></p>
        </footer>
    </div>
    
    <script>
        function showTab(i) {
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            document.querySelectorAll('.tab-button').forEach(b => b.classList.remove('active'));
            document.querySelectorAll('.tab-content')[i].classList.add('active');
            document.querySelectorAll('.tab-button')[i].classList.add('active');
            if (i === 1 && !basicInit) initBasic();
            if (i === 2 && !attachInit) initAttach();
            if (i === 3 && !cogInit) initCog();
            if (i === 4 && !devInit) initDev();
            if (i === 5 && !contempInit) initContemp();
            if (i === 7 && !zpdInit) initZpd();
        }
        
        function addLog(logId, msg, color) {
            const log = document.getElementById(logId);
            if (!log) return;
            const entry = document.createElement('div');
            entry.className = 'log-entry';
            entry.style.background = (color || '#666') + '20';
            entry.style.borderLeft = `3px solid ${color || '#666'}`;
            entry.textContent = msg;
            log.appendChild(entry);
            log.scrollTop = log.scrollHeight;
            while (log.children.length > 12) log.removeChild(log.children[0]);
        }
        
        // =============================================
        // BASIC PARTICLE SIMULATION
        // =============================================
        let basicInit = false, basicRunning = false, basicCanvas, basicCtx;
        let basicOmega = 0.35, basicParticles = [], basicRuptures = 0;
        
        class Particle {
            constructor(x, y, omega) {
                this.x = x; this.y = y;
                this.vx = (Math.random() - 0.5) * 2;
                this.vy = (Math.random() - 0.5) * 2;
                this.C = Math.random() * omega * 0.3;
                this.omega = omega;
                this.flash = 0;
                this.hue = Math.random() * 60 + 180;
            }
            update(w, h) {
                this.x += this.vx; this.y += this.vy;
                if (this.x < 20 || this.x > w - 20) this.vx *= -1;
                if (this.y < 20 || this.y > h - 20) this.vy *= -1;
                this.flash *= 0.9;
                this.C += 0.002;
                if (this.C >= this.omega) { this.flash = 1; basicRuptures++; this.C *= 0.1; }
            }
            draw(ctx) {
                const prog = Math.min(this.C / this.omega, 1);
                const r = 8 + prog * 8;
                if (this.flash > 0.1) {
                    ctx.beginPath(); ctx.arc(this.x, this.y, r + 20 * this.flash, 0, Math.PI * 2);
                    ctx.fillStyle = `rgba(255,255,255,${this.flash * 0.5})`; ctx.fill();
                }
                ctx.beginPath(); ctx.arc(this.x, this.y, r, 0, Math.PI * 2);
                ctx.fillStyle = `hsla(${this.hue}, 70%, ${50 + prog * 30}%, 1)`; ctx.fill();
                if (prog > 0.1) {
                    ctx.beginPath(); ctx.arc(this.x, this.y, r + 3, -Math.PI/2, -Math.PI/2 + prog * Math.PI * 2);
                    ctx.strokeStyle = `rgba(255,255,255,${0.3 + prog * 0.5})`; ctx.lineWidth = 2; ctx.stroke();
                }
            }
        }
        
        function initBasic() {
            basicCanvas = document.getElementById('basic-canvas');
            basicCanvas.width = basicCanvas.parentElement.clientWidth; basicCanvas.height = 350;
            basicCtx = basicCanvas.getContext('2d');
            basicParticles = []; basicRuptures = 0;
            for (let i = 0; i < 20; i++) basicParticles.push(new Particle(50 + Math.random() * (basicCanvas.width - 100), 50 + Math.random() * 250, basicOmega));
            document.getElementById('basic-omega').addEventListener('input', e => {
                basicOmega = parseFloat(e.target.value);
                document.getElementById('basic-omega-val').textContent = basicOmega.toFixed(2);
                basicParticles.forEach(p => p.omega = basicOmega);
                document.getElementById('basic-omega-label').textContent = basicOmega < 0.25 ? 'Low capacity: Frequent ruptures' : basicOmega < 0.45 ? 'Moderate capacity' : 'High capacity: Rare ruptures';
            });
            document.getElementById('basic-start').onclick = () => { basicRunning = !basicRunning; document.getElementById('basic-start').textContent = basicRunning ? 'Pause' : 'Start'; if (basicRunning) basicLoop(); };
            document.getElementById('basic-reset').onclick = () => { basicRunning = false; document.getElementById('basic-start').textContent = 'Start'; initBasic(); };
            document.getElementById('basic-perturb').onclick = () => { basicParticles.forEach(p => p.C += basicOmega * 0.4); addLog('basic-log', 'Perturbation applied', '#f59e0b'); };
            basicInit = true; renderBasic();
        }
        
        function basicLoop() {
            if (!basicRunning) return;
            basicParticles.forEach(p => p.update(basicCanvas.width, basicCanvas.height));
            const meanC = basicParticles.reduce((s, p) => s + p.C, 0) / basicParticles.length;
            const meanExp = basicParticles.reduce((s, p) => s + Math.exp(p.C / p.omega), 0) / basicParticles.length;
            document.getElementById('basic-c').textContent = meanC.toFixed(2);
            document.getElementById('basic-ruptures').textContent = basicRuptures;
            document.getElementById('basic-depth').textContent = meanExp.toFixed(2);
            document.getElementById('basic-ops').innerHTML = `<div class="op-line"><span class="op-label">System Ω = </span><span class="op-value">${basicOmega.toFixed(3)}</span></div><div class="op-line"><span class="op-label">Mean C = </span><span class="op-value">${meanC.toFixed(3)}</span></div><div class="op-line"><span class="op-label">Ruptures = </span><span class="op-value">${basicRuptures}</span></div><div class="op-line"><span class="op-label">Mean exp(C/Ω) = </span><span class="op-value">${meanExp.toFixed(3)}</span></div>`;
            renderBasic(); requestAnimationFrame(basicLoop);
        }
        
        function renderBasic() {
            basicCtx.fillStyle = '#0a0a14'; basicCtx.fillRect(0, 0, basicCanvas.width, basicCanvas.height);
            basicParticles.forEach(p => p.draw(basicCtx));
        }
        
        // =============================================
        // ATTACHMENT SIMULATION - Enhanced with Intersubjectivity & Piaget
        // =============================================
        let attachInit = false, attachRunning = false, attachCanvas, attachCtx;
        let attachState = {
            age: 0,           // months
            phase: 0,         // 0-6: symbiosis, primary intersub, 9mo rupture, secondary intersub, symbolic rupture, preoperational, operational
            C: 0,             // infant's accumulated coherence
            Omega: 0.30,      // environmental variance (expands at each phase)
            blanketSeparation: 0,
            VFE: 0.30,
            motherX: 0, motherY: 0,
            infantX: 0, infantY: 0,
            infantAngle: 0,
            explorationRadius: 0,
            objects: [],      // Objects for secondary intersubjectivity
            rupturing: false, // Animation state for rupture
            ruptureFrame: 0,
            ruptureFlash: 0,
            prevPhaseRatio: 0 // Track C/Ω to detect equilibration
        };
        
        const phaseInfo = [
            { 
                name: 'Symbiosis', 
                ageEnd: 2, 
                intersubj: 'Pre-intersubjective (merged)',
                piaget: 'Sensorimotor (reflexes)',
                desc: 'Shared Markov blanket. Infant and mother as "dual unity within one common boundary." No self-other distinction. C undefined for infant alone.',
                isRupture: false,
                targetOmega: 0.30
            },
            { 
                name: 'Primary Intersubjectivity', 
                ageEnd: 9, 
                intersubj: 'Primary: Dyadic face-to-face',
                piaget: 'Sensorimotor (coordination)',
                desc: 'Dyadic coordination emerges. Face-to-face interaction with reciprocal emotion and attention. C accumulates as infant learns mother\'s expressions, rhythms, voice. C → Ω₁ as mother becomes predictable.',
                isRupture: false,
                targetOmega: 0.40
            },
            { 
                name: '9-Month Revolution (δ₁)', 
                ageEnd: 10, 
                intersubj: 'RUPTURE: Shared intentionality dawns',
                piaget: 'Sensorimotor (object-oriented)',
                desc: 'ONTOGENETIC RUPTURE. The infant discovers that others have separate minds attending to objects. Dyadic framework cannot accommodate triadic relations. Old model ruptures. Ω expands for the new world.',
                isRupture: true,
                targetOmega: 0.55
            },
            { 
                name: 'Secondary Intersubjectivity', 
                ageEnd: 24, 
                intersubj: 'Secondary: Triadic joint attention',
                piaget: 'Sensorimotor → Symbolic threshold',
                desc: 'Joint attention emerges. Infant and caregiver share focus on objects. C accumulates in triadic field. Object permanence develops. World of objects becomes familiar as C → Ω₂.',
                isRupture: false,
                targetOmega: 0.65
            },
            { 
                name: 'Symbolic Rupture (δ₂)', 
                ageEnd: 26, 
                intersubj: 'Triadic mastered',
                piaget: 'RUPTURE: Representational thought',
                desc: 'ONTOGENETIC RUPTURE. Deferred imitation reveals capacity for mental representation. Action-based model ruptures. Symbols, language, pretend play become possible. Ω expands into symbolic domain.',
                isRupture: true,
                targetOmega: 0.75
            },
            { 
                name: 'Preoperational', 
                ageEnd: 84, 
                intersubj: 'Symbolic communication',
                piaget: 'Preoperational (symbols, egocentrism)',
                desc: 'Symbolic thought flourishes. Language, fantasy, pretend play. Egocentric perspective—difficulty seeing others\' viewpoints. C accumulates as symbolic world becomes familiar. C → Ω₃.',
                isRupture: false,
                targetOmega: 0.85
            },
            { 
                name: 'Concrete Operations', 
                ageEnd: 132, 
                intersubj: 'Logical discourse',
                piaget: 'Concrete Operational (logic on objects)',
                desc: 'Logical operations on concrete objects. Conservation, reversibility, decentration mastered. Can reason about actual things but not abstract possibilities. C → Ω₄ as logical world becomes familiar.',
                isRupture: false,
                targetOmega: 0.92
            },
            { 
                name: 'Abstraction Rupture (δ₃)', 
                ageEnd: 136, 
                intersubj: 'Logical mastered',
                piaget: 'RUPTURE: Hypothetical-deductive thought',
                desc: 'ONTOGENETIC RUPTURE. "What if?" questions exceed concrete operations. The child confronts pure possibility—worlds that don\'t exist, propositions without referents. Concrete model ruptures. Ω expands into abstract space.',
                isRupture: true,
                targetOmega: 0.98
            },
            { 
                name: 'Formal Operations', 
                ageEnd: 300, 
                intersubj: 'Abstract discourse',
                piaget: 'Formal Operational (pure abstraction)',
                desc: 'Pure abstract thought. Hypothetical-deductive reasoning. Can manipulate propositions, consider counterfactuals, think about thinking itself. The mind operates on possibilities rather than actualities. C → Ω₅ as the abstract world becomes familiar.',
                isRupture: false,
                targetOmega: 1.00
            }
        ];
        
        function initAttach() {
            attachCanvas = document.getElementById('attach-canvas');
            attachCanvas.width = attachCanvas.parentElement.clientWidth;
            attachCanvas.height = 450;
            attachCtx = attachCanvas.getContext('2d');
            
            resetAttachState();
            
            document.getElementById('attach-start').onclick = () => {
                attachRunning = !attachRunning;
                document.getElementById('attach-start').textContent = attachRunning ? 'Pause' : 'Start Development';
                if (attachRunning) attachLoop();
            };
            
            document.getElementById('attach-reset').onclick = () => {
                attachRunning = false;
                document.getElementById('attach-start').textContent = 'Start Development';
                resetAttachState();
                updateAttachUI();
                renderAttach();
            };
            
            document.getElementById('attach-stress').onclick = () => {
                attachState.VFE = Math.min(1, attachState.VFE + 0.15);
                attachState.C = Math.max(0, attachState.C - 0.05);
                addLog('attach-log', 'Environmental stress: VFE increases, C decreases', '#ef4444');
            };
            
            document.getElementById('attach-soothe').onclick = () => {
                attachState.VFE = Math.max(0, attachState.VFE - 0.1);
                attachState.C = Math.min(attachState.Omega, attachState.C + 0.08);
                addLog('attach-log', 'Caregiver attunement: C builds, VFE reduces', '#10b981');
            };
            
            attachInit = true;
            updateAttachUI();
            renderAttach();
        }
        
        function resetAttachState() {
            attachState = {
                age: 0,
                phase: 0,
                C: 0,
                Omega: 0.30,
                blanketSeparation: 0,
                VFE: 0.30,
                motherX: attachCanvas.width * 0.4,
                motherY: attachCanvas.height * 0.5,
                infantX: attachCanvas.width * 0.4,
                infantY: attachCanvas.height * 0.5,
                infantAngle: 0,
                explorationRadius: 0,
                objects: [],
                rupturing: false,
                ruptureFrame: 0,
                ruptureFlash: 0,
                prevPhaseRatio: 0,
                abstractSymbols: [] // For formal operations visualization
            };
            // Clear phase indicators
            for (let i = 0; i < 9; i++) {
                const el = document.getElementById(`phase-${i}`);
                if (el) {
                    el.classList.remove('active', 'completed');
                    if (i === 0) el.classList.add('active');
                }
            }
        }
        
        function updateAttachPhase() {
            const age = attachState.age;
            let newPhase = 0;
            
            // Determine phase based on age (in months)
            // 132 months = 11 years, 136 months = 11.3 years
            if (age >= 136) newPhase = 8;      // Formal Operations (11+ years)
            else if (age >= 132) newPhase = 7; // Abstraction Rupture (~11 years)
            else if (age >= 84) newPhase = 6;  // Concrete Operations (7-11 years)
            else if (age >= 26) newPhase = 5;  // Preoperational
            else if (age >= 24) newPhase = 4;  // Symbolic Rupture
            else if (age >= 10) newPhase = 3;  // Secondary Intersubjectivity
            else if (age >= 9) newPhase = 2;   // 9-Month Revolution
            else if (age >= 2) newPhase = 1;   // Primary Intersubjectivity
            
            if (newPhase !== attachState.phase) {
                const oldPhase = attachState.phase;
                attachState.phase = newPhase;
                
                // Check if entering a rupture phase
                if (phaseInfo[newPhase].isRupture) {
                    attachState.rupturing = true;
                    attachState.ruptureFrame = 0;
                    attachState.ruptureFlash = 1;
                    addLog('attach-log', `δ RUPTURE: Entering ${phaseInfo[newPhase].name}`, '#f59e0b');
                    
                    // Expand Omega for new phase
                    attachState.Omega = phaseInfo[newPhase].targetOmega;
                    // C doesn't fully reset but VFE spikes
                    attachState.VFE = attachState.Omega * 0.7;
                } else {
                    addLog('attach-log', `Entering ${phaseInfo[newPhase].name}`, '#8b5cf6');
                    if (oldPhase > 0 && phaseInfo[oldPhase].isRupture) {
                        addLog('attach-log', `R REGENERATION: New capacity Ω = ${attachState.Omega.toFixed(2)}`, '#10b981');
                    }
                }
                
                // Spawn objects for secondary intersubjectivity
                if (newPhase >= 3 && attachState.objects.length === 0) {
                    for (let i = 0; i < 4; i++) {
                        attachState.objects.push({
                            x: attachCanvas.width * 0.6 + Math.random() * 150 - 75,
                            y: attachCanvas.height * 0.3 + Math.random() * 200,
                            size: 12 + Math.random() * 8,
                            hue: Math.random() * 360,
                            attended: false
                        });
                    }
                    addLog('attach-log', 'Objects enter awareness: triadic field opens', '#06b6d4');
                }
                
                // Spawn abstract symbols for formal operations
                if (newPhase >= 8 && attachState.abstractSymbols.length === 0) {
                    const symbols = ['∀', '∃', '→', '∧', '∨', '¬', '∞', 'π', '∫', '∂', '∑', 'λ', '?', '∴', '≡'];
                    for (let i = 0; i < 12; i++) {
                        attachState.abstractSymbols.push({
                            symbol: symbols[Math.floor(Math.random() * symbols.length)],
                            x: attachCanvas.width * 0.5 + Math.random() * 300 - 150,
                            y: attachCanvas.height * 0.5 + Math.random() * 200 - 100,
                            vx: (Math.random() - 0.5) * 0.5,
                            vy: (Math.random() - 0.5) * 0.5,
                            alpha: 0.3 + Math.random() * 0.5,
                            size: 14 + Math.random() * 10
                        });
                    }
                    addLog('attach-log', 'Abstract symbols emerge: pure possibility space opens', '#a855f7');
                }
            }
            
            // Update phase indicators
            for (let i = 0; i < 9; i++) {
                const el = document.getElementById(`phase-${i}`);
                if (el) {
                    el.classList.remove('active', 'completed');
                    if (i < attachState.phase) el.classList.add('completed');
                    if (i === attachState.phase) el.classList.add('active');
                }
            }
        }
        
        function attachLoop() {
            if (!attachRunning) return;
            
            // Age progresses (scaled for longer development)
            const phase = attachState.phase;
            let ageIncrement = 0.05;
            if (phase >= 5) ageIncrement = 0.3;  // Preoperational - years pass faster
            if (phase >= 6) ageIncrement = 0.5;  // Concrete ops
            if (phase >= 7) ageIncrement = 0.3;  // Rupture slower
            if (phase >= 8) ageIncrement = 0.8;  // Formal ops fastest
            attachState.age += ageIncrement;
            
            // Update phase
            updateAttachPhase();
            
            // Rupture animation
            if (attachState.rupturing) {
                attachState.ruptureFrame++;
                attachState.ruptureFlash = Math.max(0, 1 - attachState.ruptureFrame / 30);
                if (attachState.ruptureFrame > 30) {
                    attachState.rupturing = false;
                }
            }
            
            const currentPhase = phaseInfo[attachState.phase];
            
            // Phase-specific dynamics - key is C → Ω pattern
            if (!currentPhase.isRupture) {
                // Normal phase: C accumulates toward Ω
                const targetRatio = Math.min(0.98, 0.3 + (attachState.age - (phase > 0 ? phaseInfo[phase-1].ageEnd : 0)) / 50);
                const cGrowthRate = 0.003 + phase * 0.001;
                attachState.C = Math.min(attachState.Omega * targetRatio, attachState.C + cGrowthRate);
                
                // VFE decreases as C approaches Ω
                attachState.VFE = Math.max(0.02, (attachState.Omega - attachState.C) * 1.2);
                
                // Detect near-equilibration for messaging
                const ratio = attachState.C / attachState.Omega;
                if (ratio > 0.9 && attachState.prevPhaseRatio <= 0.9) {
                    addLog('attach-log', `C ≈ Ω: "Everything makes sense" in ${currentPhase.name}`, '#10b981');
                }
                attachState.prevPhaseRatio = ratio;
            } else {
                // Rupture phase: VFE high, system reorganizing
                attachState.VFE = 0.5 + Math.random() * 0.2;
                // C doesn't grow during rupture
            }
            
            // Blanket separation increases with development
            attachState.blanketSeparation = Math.min(1, attachState.phase * 0.12 + attachState.age / 150);
            
            // Exploration radius expands with phase
            const baseRadius = [0, 30, 30, 80, 80, 120, 150, 150, 180][attachState.phase];
            attachState.explorationRadius = baseRadius + Math.min(50, attachState.age * 0.3);
            
            // Infant/person movement
            attachState.infantAngle += 0.02 + Math.random() * 0.02;
            const targetX = attachState.motherX + Math.cos(attachState.infantAngle) * attachState.explorationRadius;
            const targetY = attachState.motherY + Math.sin(attachState.infantAngle) * attachState.explorationRadius * 0.5;
            attachState.infantX += (targetX - attachState.infantX) * 0.05;
            attachState.infantY += (targetY - attachState.infantY) * 0.05;
            
            // Object attention during secondary intersubjectivity
            if (attachState.phase >= 3 && attachState.phase < 8 && attachState.objects.length > 0) {
                if (Math.random() < 0.02) {
                    attachState.objects.forEach(o => o.attended = false);
                    attachState.objects[Math.floor(Math.random() * attachState.objects.length)].attended = true;
                }
            }
            
            // Abstract symbol movement during formal operations
            if (attachState.phase >= 8 && attachState.abstractSymbols.length > 0) {
                attachState.abstractSymbols.forEach(s => {
                    s.x += s.vx;
                    s.y += s.vy;
                    // Gentle drift toward center of thought space
                    const cx = attachCanvas.width * 0.65;
                    const cy = attachCanvas.height * 0.5;
                    s.vx += (cx - s.x) * 0.0001;
                    s.vy += (cy - s.y) * 0.0001;
                    // Boundary bounce
                    if (s.x < 50 || s.x > attachCanvas.width - 50) s.vx *= -0.8;
                    if (s.y < 50 || s.y > attachCanvas.height - 50) s.vy *= -0.8;
                    // Oscillate alpha
                    s.alpha = 0.3 + 0.4 * Math.sin(Date.now() * 0.001 + s.x * 0.01);
                });
            }
            
            updateAttachUI();
            renderAttach();
            requestAnimationFrame(attachLoop);
        }
        
        function updateAttachUI() {
            // Format age appropriately
            let ageStr;
            if (attachState.age < 24) {
                ageStr = attachState.age.toFixed(1) + ' mo';
            } else {
                ageStr = (attachState.age / 12).toFixed(1) + ' yr';
            }
            document.getElementById('attach-age').textContent = ageStr;
            document.getElementById('attach-c').textContent = attachState.C.toFixed(2);
            document.getElementById('attach-omega').textContent = attachState.Omega.toFixed(2);
            document.getElementById('attach-vfe').textContent = attachState.VFE.toFixed(2);
            
            const ratio = attachState.Omega > 0 ? (attachState.C / attachState.Omega) : 0;
            document.getElementById('attach-ratio').textContent = (ratio * 100).toFixed(0) + '%';
            
            const info = phaseInfo[attachState.phase];
            const crrStatus = info.isRupture ? 'δ RUPTURE: Old framework failing' : 
                              (ratio > 0.9 ? 'C ≈ Ω: Phase mastery achieved' : 
                               ratio > 0.5 ? 'C → Ω: Building coherence' : 'C accumulating in new field');
            
            document.getElementById('attach-ops').innerHTML = 
                `<div class="op-line"><span class="op-label">Stage: </span><span class="op-value">${info.name}</span></div>` +
                `<div class="op-line"><span class="op-label">Intersubjectivity: </span><span class="op-value">${info.intersubj}</span></div>` +
                `<div class="op-line"><span class="op-label">Piaget: </span><span class="op-value">${info.piaget}</span></div>` +
                `<div class="op-line"><span class="op-label">CRR Status: </span><span class="op-value">${crrStatus}</span></div>`;
            
            document.getElementById('attach-narrative').innerHTML = `<strong>${info.name}:</strong> ${info.desc}`;
        }
        
        function renderAttach() {
            const w = attachCanvas.width, h = attachCanvas.height, ctx = attachCtx;
            
            // Background with rupture flash
            if (attachState.ruptureFlash > 0) {
                const flashIntensity = attachState.ruptureFlash * 0.3;
                ctx.fillStyle = `rgba(${Math.floor(245 * flashIntensity)}, ${Math.floor(158 * flashIntensity)}, ${Math.floor(11 * flashIntensity)}, 1)`;
            } else {
                ctx.fillStyle = '#0a0a14';
            }
            ctx.fillRect(0, 0, w, h);
            
            const cx = w * 0.35, cy = h * 0.5;
            const separation = attachState.blanketSeparation;
            const motherR = 45;
            const infantR = 22 + separation * 18;
            
            attachState.motherX = cx;
            attachState.motherY = cy;
            
            // Omega expansion visualization (background rings)
            const omegaRingR = 100 + attachState.Omega * 200;
            ctx.beginPath();
            ctx.arc(attachState.infantX, attachState.infantY, omegaRingR, 0, Math.PI * 2);
            ctx.strokeStyle = `rgba(245, 158, 11, 0.15)`;
            ctx.lineWidth = 1;
            ctx.setLineDash([10, 10]);
            ctx.stroke();
            ctx.setLineDash([]);
            
            // Abstract thought space (formal operations) - draw BEFORE other elements
            if (attachState.phase >= 8 && attachState.abstractSymbols.length > 0) {
                // Draw "possibility space" - ethereal cloud around thinker
                const psX = w * 0.65, psY = h * 0.5;
                const psR = 140;
                const gradient = ctx.createRadialGradient(psX, psY, 0, psX, psY, psR);
                gradient.addColorStop(0, 'rgba(168, 85, 247, 0.15)');
                gradient.addColorStop(0.5, 'rgba(139, 92, 246, 0.08)');
                gradient.addColorStop(1, 'rgba(168, 85, 247, 0)');
                ctx.beginPath();
                ctx.arc(psX, psY, psR, 0, Math.PI * 2);
                ctx.fillStyle = gradient;
                ctx.fill();
                
                // Label
                ctx.fillStyle = 'rgba(168, 85, 247, 0.6)';
                ctx.font = '11px Georgia';
                ctx.textAlign = 'center';
                ctx.fillText('Possibility Space', psX, psY - psR - 10);
                ctx.font = '9px Courier New';
                ctx.fillText('(Pure Abstraction)', psX, psY - psR + 5);
                
                // Draw connecting lines between nearby symbols (abstract relations)
                for (let i = 0; i < attachState.abstractSymbols.length; i++) {
                    for (let j = i + 1; j < attachState.abstractSymbols.length; j++) {
                        const s1 = attachState.abstractSymbols[i];
                        const s2 = attachState.abstractSymbols[j];
                        const dist = Math.sqrt((s1.x - s2.x)**2 + (s1.y - s2.y)**2);
                        if (dist < 80) {
                            ctx.beginPath();
                            ctx.moveTo(s1.x, s1.y);
                            ctx.lineTo(s2.x, s2.y);
                            ctx.strokeStyle = `rgba(168, 85, 247, ${0.15 * (1 - dist/80)})`;
                            ctx.lineWidth = 1;
                            ctx.stroke();
                        }
                    }
                }
                
                // Draw abstract symbols
                attachState.abstractSymbols.forEach(s => {
                    ctx.fillStyle = `rgba(200, 180, 255, ${s.alpha})`;
                    ctx.font = `${s.size}px Georgia`;
                    ctx.textAlign = 'center';
                    ctx.textBaseline = 'middle';
                    ctx.fillText(s.symbol, s.x, s.y);
                });
                
                // Draw thought line from person to possibility space
                ctx.beginPath();
                ctx.moveTo(attachState.infantX + infantR, attachState.infantY - infantR * 0.5);
                ctx.quadraticCurveTo(
                    (attachState.infantX + psX) / 2, 
                    attachState.infantY - 60,
                    psX - psR * 0.7, psY
                );
                ctx.strokeStyle = 'rgba(168, 85, 247, 0.3)';
                ctx.lineWidth = 2;
                ctx.setLineDash([5, 5]);
                ctx.stroke();
                ctx.setLineDash([]);
                
                // "Thinking about thinking" label
                ctx.fillStyle = 'rgba(168, 85, 247, 0.5)';
                ctx.font = '9px Courier New';
                ctx.textAlign = 'center';
                ctx.fillText('hypothetical-deductive', (attachState.infantX + psX) / 2, attachState.infantY - 70);
            }
            
            // Shared blanket (fades as separation increases)
            if (separation < 0.8) {
                const sharedR = 90 * (1 - separation * 0.6);
                const gradient = ctx.createRadialGradient(cx, cy, 0, cx, cy, sharedR);
                gradient.addColorStop(0, `rgba(168, 85, 247, ${0.3 * (1 - separation)})`);
                gradient.addColorStop(1, 'rgba(168, 85, 247, 0)');
                ctx.beginPath();
                ctx.arc(cx, cy, sharedR, 0, Math.PI * 2);
                ctx.fillStyle = gradient;
                ctx.fill();
            }
            
            // Draw objects for secondary intersubjectivity (fade in formal ops)
            if (attachState.phase >= 3 && attachState.phase < 8) {
                attachState.objects.forEach((obj, i) => {
                    ctx.beginPath();
                    ctx.arc(obj.x, obj.y, obj.size, 0, Math.PI * 2);
                    const alpha = obj.attended ? 0.9 : 0.4;
                    ctx.fillStyle = `hsla(${obj.hue}, 70%, 60%, ${alpha})`;
                    ctx.fill();
                    ctx.strokeStyle = obj.attended ? '#fff' : `hsla(${obj.hue}, 70%, 40%, 0.5)`;
                    ctx.lineWidth = obj.attended ? 3 : 1;
                    ctx.stroke();
                    
                    // Joint attention line
                    if (obj.attended) {
                        ctx.beginPath();
                        ctx.moveTo(attachState.motherX, attachState.motherY);
                        ctx.lineTo(obj.x, obj.y);
                        ctx.strokeStyle = 'rgba(236, 72, 153, 0.4)';
                        ctx.lineWidth = 2;
                        ctx.setLineDash([3, 3]);
                        ctx.stroke();
                        
                        ctx.beginPath();
                        ctx.moveTo(attachState.infantX, attachState.infantY);
                        ctx.lineTo(obj.x, obj.y);
                        ctx.strokeStyle = 'rgba(59, 130, 246, 0.4)';
                        ctx.stroke();
                        ctx.setLineDash([]);
                        
                        ctx.fillStyle = 'rgba(255,255,255,0.6)';
                        ctx.font = '10px Courier New';
                        ctx.textAlign = 'center';
                        ctx.fillText('Joint Attention', obj.x, obj.y - obj.size - 8);
                    }
                });
            }
            
            // Draw faded objects in formal ops (concrete world recedes)
            if (attachState.phase >= 8 && attachState.objects.length > 0) {
                attachState.objects.forEach(obj => {
                    ctx.beginPath();
                    ctx.arc(obj.x, obj.y, obj.size * 0.7, 0, Math.PI * 2);
                    ctx.fillStyle = `hsla(${obj.hue}, 30%, 50%, 0.15)`;
                    ctx.fill();
                });
            }
            
            // Mother's Markov blanket (fades in later stages)
            const motherAlpha = attachState.phase >= 6 ? 0.2 : (0.3 + separation * 0.3);
            ctx.beginPath();
            ctx.arc(attachState.motherX, attachState.motherY, motherR + 25, 0, Math.PI * 2);
            ctx.strokeStyle = `rgba(236, 72, 153, ${motherAlpha})`;
            ctx.lineWidth = 2;
            ctx.setLineDash([5, 5]);
            ctx.stroke();
            ctx.setLineDash([]);
            
            // Mother (smaller in later stages as focus shifts)
            const adjustedMotherR = attachState.phase >= 6 ? motherR * 0.8 : motherR;
            ctx.beginPath();
            ctx.arc(attachState.motherX, attachState.motherY, adjustedMotherR, 0, Math.PI * 2);
            const motherGrad = ctx.createRadialGradient(attachState.motherX, attachState.motherY, 0, attachState.motherX, attachState.motherY, adjustedMotherR);
            motherGrad.addColorStop(0, attachState.phase >= 6 ? '#d946ef' : '#ec4899');
            motherGrad.addColorStop(1, attachState.phase >= 6 ? '#9333ea' : '#be185d');
            ctx.fillStyle = motherGrad;
            ctx.fill();
            
            // Person's Markov blanket
            if (separation > 0.05) {
                const infantBlanketR = infantR + 12 + separation * 18;
                ctx.beginPath();
                ctx.arc(attachState.infantX, attachState.infantY, infantBlanketR, 0, Math.PI * 2);
                ctx.strokeStyle = `rgba(59, 130, 246, ${separation * 0.6})`;
                ctx.lineWidth = 2 + separation * 2;
                ctx.setLineDash([5, 5]);
                ctx.stroke();
                ctx.setLineDash([]);
            }
            
            // Person (grows through development)
            const personR = infantR + (attachState.phase >= 6 ? 8 : 0);
            ctx.beginPath();
            ctx.arc(attachState.infantX, attachState.infantY, personR, 0, Math.PI * 2);
            const infantGrad = ctx.createRadialGradient(attachState.infantX, attachState.infantY, 0, attachState.infantX, attachState.infantY, personR);
            // Color shifts to purple in formal ops (abstract thinker)
            if (attachState.phase >= 8) {
                infantGrad.addColorStop(0, '#a855f7');
                infantGrad.addColorStop(1, '#7c3aed');
            } else {
                infantGrad.addColorStop(0, '#3b82f6');
                infantGrad.addColorStop(1, '#1d4ed8');
            }
            ctx.fillStyle = infantGrad;
            ctx.fill();
            
            // C progress ring
            if (attachState.C > 0.01) {
                const ratio = attachState.C / attachState.Omega;
                ctx.beginPath();
                ctx.arc(attachState.infantX, attachState.infantY, personR + 4, -Math.PI/2, -Math.PI/2 + ratio * Math.PI * 2);
                ctx.strokeStyle = ratio > 0.9 ? '#10b981' : '#22c55e';
                ctx.lineWidth = 4;
                ctx.stroke();
                
                if (ratio > 0.9) {
                    ctx.beginPath();
                    ctx.arc(attachState.infantX, attachState.infantY, personR + 8, 0, Math.PI * 2);
                    ctx.strokeStyle = `rgba(16, 185, 129, ${(ratio - 0.9) * 3})`;
                    ctx.lineWidth = 2;
                    ctx.stroke();
                }
            }
            
            // VFE waves
            if (attachState.VFE > 0.05) {
                const waveR = personR + 25 + attachState.VFE * 40;
                ctx.beginPath();
                ctx.arc(attachState.infantX, attachState.infantY, waveR, 0, Math.PI * 2);
                ctx.strokeStyle = `rgba(239, 68, 68, ${attachState.VFE * 0.5})`;
                ctx.lineWidth = 2;
                ctx.stroke();
            }
            
            // Rupture burst effect
            if (attachState.rupturing) {
                const burstR = 50 + attachState.ruptureFrame * 8;
                ctx.beginPath();
                ctx.arc(attachState.infantX, attachState.infantY, burstR, 0, Math.PI * 2);
                ctx.strokeStyle = `rgba(245, 158, 11, ${attachState.ruptureFlash})`;
                ctx.lineWidth = 5;
                ctx.stroke();
                
                ctx.fillStyle = `rgba(245, 158, 11, ${attachState.ruptureFlash})`;
                ctx.font = 'bold 36px Georgia';
                ctx.textAlign = 'center';
                ctx.fillText('δ', attachState.infantX, attachState.infantY - personR - 50);
            }
            
            // Connection line (for primary intersubjectivity)
            if (separation > 0.1 && separation < 0.8 && attachState.phase <= 2) {
                ctx.beginPath();
                ctx.moveTo(attachState.motherX, attachState.motherY);
                ctx.lineTo(attachState.infantX, attachState.infantY);
                ctx.strokeStyle = `rgba(168, 85, 247, ${0.4 * (1 - separation)})`;
                ctx.lineWidth = 3;
                ctx.stroke();
                
                if (attachState.phase === 1) {
                    const midX = (attachState.motherX + attachState.infantX) / 2;
                    const midY = (attachState.motherY + attachState.infantY) / 2 - 15;
                    ctx.fillStyle = 'rgba(168, 85, 247, 0.8)';
                    ctx.font = '10px Courier New';
                    ctx.textAlign = 'center';
                    ctx.fillText('Dyadic Field', midX, midY);
                }
            }
            
            // Labels
            ctx.fillStyle = 'rgba(255,255,255,0.7)';
            ctx.font = 'bold 11px Georgia';
            ctx.textAlign = 'center';
            const motherLabel = attachState.phase >= 6 ? 'Caregiver' : 'Mother';
            ctx.fillText(motherLabel, attachState.motherX, attachState.motherY + adjustedMotherR + 20);
            const personLabel = attachState.phase >= 6 ? (attachState.phase >= 8 ? 'Thinker' : 'Child') : 'Infant';
            ctx.fillText(personLabel, attachState.infantX, attachState.infantY + personR + 20);
            
            // C and Ω display
            ctx.font = '10px Courier New';
            ctx.fillStyle = '#10b981';
            ctx.fillText(`C = ${attachState.C.toFixed(2)}`, attachState.infantX, attachState.infantY - 3);
            ctx.fillStyle = '#f59e0b';
            ctx.fillText(`Ω = ${attachState.Omega.toFixed(2)}`, attachState.infantX, attachState.infantY + 9);
            
            // Phase indicator at top
            let ageStr = attachState.age < 24 ? attachState.age.toFixed(1) + ' mo' : (attachState.age / 12).toFixed(1) + ' yr';
            ctx.fillStyle = 'rgba(255,255,255,0.6)';
            ctx.font = '13px Georgia';
            ctx.textAlign = 'center';
            ctx.fillText(`${ageStr} — ${phaseInfo[attachState.phase].name}`, w/2, 22);
            
            // CRR status indicator
            const ratio = attachState.C / attachState.Omega;
            let statusText = ratio > 0.9 ? 'C ≈ Ω (Equilibration)' : `C/Ω = ${(ratio*100).toFixed(0)}%`;
            if (phaseInfo[attachState.phase].isRupture) statusText = 'δ RUPTURE';
            ctx.fillStyle = phaseInfo[attachState.phase].isRupture ? '#f59e0b' : (ratio > 0.9 ? '#10b981' : '#94a3b8');
            ctx.font = '11px Courier New';
            ctx.fillText(statusText, w/2, 40);
            
            // C/Ω ratio bar at bottom
            const barWidth = 250;
            const barHeight = 18;
            const barX = w/2 - barWidth/2;
            const barY = h - 45;
            
            ctx.strokeStyle = 'rgba(245, 158, 11, 0.5)';
            ctx.lineWidth = 2;
            ctx.strokeRect(barX, barY, barWidth, barHeight);
            
            const fillRatio = Math.min(1, attachState.C / attachState.Omega);
            const fillGrad = ctx.createLinearGradient(barX, 0, barX + barWidth, 0);
            fillGrad.addColorStop(0, '#ef4444');
            fillGrad.addColorStop(0.5, '#f59e0b');
            fillGrad.addColorStop(1, '#10b981');
            ctx.fillStyle = fillGrad;
            ctx.fillRect(barX, barY, barWidth * fillRatio, barHeight);
            
            ctx.fillStyle = 'rgba(255,255,255,0.7)';
            ctx.font = '10px Courier New';
            ctx.textAlign = 'left';
            ctx.fillText('C', barX - 15, barY + 13);
            ctx.textAlign = 'right';
            ctx.fillText('Ω', barX + barWidth + 15, barY + 13);
            ctx.textAlign = 'center';
            ctx.fillText(`C→Ω: ${(fillRatio * 100).toFixed(0)}%`, w/2, barY - 6);
        }
        
        // =============================================
        // COGNITIVE SIMULATION
        // =============================================
        let cogInit = false, cogRunning = false, cogCanvas, cogCtx;
        let cogState = { C: 0, Omega: 0.40, ruptures: 0, ltmItems: 0, chunks: [] };
        
        function initCog() {
            cogCanvas = document.getElementById('cog-canvas');
            cogCanvas.width = cogCanvas.parentElement.clientWidth; cogCanvas.height = 280;
            cogCtx = cogCanvas.getContext('2d');
            document.getElementById('cog-omega').addEventListener('input', e => { cogState.Omega = parseFloat(e.target.value); document.getElementById('cog-omega-val').textContent = cogState.Omega.toFixed(2); document.getElementById('cog-omega-label').textContent = cogState.Omega < 0.30 ? 'Low (Elder): Frequent consolidation' : cogState.Omega < 0.45 ? 'Moderate: Balanced' : 'High (Young Adult): Extended reconfiguration'; });
            document.getElementById('cog-start').onclick = () => { cogRunning = !cogRunning; document.getElementById('cog-start').textContent = cogRunning ? 'Pause' : 'Start'; if (cogRunning) cogLoop(); };
            document.getElementById('cog-reset').onclick = () => { cogRunning = false; document.getElementById('cog-start').textContent = 'Start'; cogState = { C: 0, Omega: 0.40, ruptures: 0, ltmItems: 0, chunks: [] }; updateCogUI(); renderCog(); };
            document.getElementById('cog-load').onclick = () => { cogState.C += cogState.Omega * 0.25; cogState.chunks.push({ x: Math.random() * 80 - 40, y: Math.random() * 40 - 20, age: 0 }); };
            cogInit = true; updateCogUI(); renderCog();
        }
        
        function updateCogUI() {
            document.getElementById('cog-c').textContent = cogState.C.toFixed(2);
            document.getElementById('cog-threshold').textContent = cogState.Omega.toFixed(2);
            document.getElementById('cog-ruptures').textContent = cogState.ruptures;
            document.getElementById('cog-ltm').textContent = cogState.ltmItems;
        }
        
        function cogLoop() {
            if (!cogRunning) return;
            cogState.C += 0.003;
            if (cogState.C > 0.1 && Math.random() < 0.02 && cogState.chunks.length < 15) cogState.chunks.push({ x: Math.random() * 80 - 40, y: Math.random() * 40 - 20, age: 0 });
            cogState.chunks.forEach(c => c.age++);
            if (cogState.C >= cogState.Omega) { cogState.ruptures++; cogState.ltmItems += Math.max(1, Math.floor(cogState.chunks.length * 0.7)); cogState.C *= 0.1; cogState.chunks = []; }
            updateCogUI(); renderCog(); requestAnimationFrame(cogLoop);
        }
        
        function renderCog() {
            const w = cogCanvas.width, h = cogCanvas.height, ctx = cogCtx;
            ctx.fillStyle = '#0a0a14'; ctx.fillRect(0, 0, w, h);
            const cx = w / 2, cy = h / 2, boxW = 180, boxH = 100;
            ctx.strokeStyle = 'rgba(59, 130, 246, 0.5)'; ctx.lineWidth = 3; ctx.strokeRect(cx - boxW/2, cy - boxH/2, boxW, boxH);
            ctx.fillStyle = 'rgba(255,255,255,0.4)'; ctx.font = '10px Georgia'; ctx.textAlign = 'center'; ctx.fillText(`Working Memory (Ω = ${cogState.Omega.toFixed(2)})`, cx, cy - boxH/2 - 8);
            const prog = Math.min(cogState.C / cogState.Omega, 1), fillH = (boxH - 4) * prog;
            ctx.fillStyle = '#3b82f680'; ctx.fillRect(cx - boxW/2 + 2, cy + boxH/2 - 2 - fillH, boxW - 4, fillH);
            for (let c of cogState.chunks) { ctx.beginPath(); ctx.arc(cx + c.x, cy + c.y, 5, 0, Math.PI * 2); ctx.fillStyle = `rgba(255,255,255,${Math.min(1, c.age / 30) * 0.8})`; ctx.fill(); }
            ctx.fillStyle = 'white'; ctx.font = 'bold 12px Courier New'; ctx.fillText(`C = ${cogState.C.toFixed(2)}`, cx, cy);
        }
        
        // =============================================
        // DEVELOPMENT SIMULATION
        // =============================================
        let devInit = false, devRunning = false, devCanvas, devCtx;
        const devStages = [
            { name: 'Sensorimotor', age: [0, 2], omega: 0.20, color: '#10b981' },
            { name: 'Preoperational', age: [2, 7], omega: 0.30, color: '#3b82f6' },
            { name: 'Concrete', age: [7, 11], omega: 0.40, color: '#f59e0b' },
            { name: 'Formal', age: [11, 18], omega: 0.50, color: '#8b5cf6' }
        ];
        let devState = { age: 0, C: 0, stage: 0, transitions: 0 };
        
        function initDev() {
            devCanvas = document.getElementById('dev-canvas');
            devCanvas.width = devCanvas.parentElement.clientWidth; devCanvas.height = 300;
            devCtx = devCanvas.getContext('2d');
            document.getElementById('dev-start').onclick = () => { devRunning = !devRunning; document.getElementById('dev-start').textContent = devRunning ? 'Pause' : 'Start'; if (devRunning) devLoop(); };
            document.getElementById('dev-reset').onclick = () => { devRunning = false; document.getElementById('dev-start').textContent = 'Start'; devState = { age: 0, C: 0, stage: 0, transitions: 0 }; updateDevUI(); renderDev(); };
            document.getElementById('dev-challenge').onclick = () => { devState.C += devStages[devState.stage].omega * 0.3; addLog('dev-log', `Challenge presented at age ${devState.age.toFixed(1)}`, '#f59e0b'); };
            devInit = true; updateDevUI(); renderDev();
        }
        
        function updateDevUI() {
            document.getElementById('dev-age').textContent = devState.age.toFixed(1);
            document.getElementById('dev-c').textContent = devState.C.toFixed(2);
            document.getElementById('dev-omega').textContent = devStages[devState.stage].omega.toFixed(2);
            document.getElementById('dev-transitions').textContent = devState.transitions;
            for (let i = 0; i < 4; i++) {
                const el = document.getElementById(`stage-${i}`);
                el.classList.remove('active', 'completed');
                if (i < devState.stage) el.classList.add('completed');
                if (i === devState.stage) el.classList.add('active');
            }
            const stageNames = ['Sensorimotor: Object permanence developing', 'Preoperational: Symbolic thought, egocentrism', 'Concrete Operational: Conservation, logical operations', 'Formal Operational: Abstract reasoning, hypotheticals'];
            document.getElementById('dev-narrative').textContent = stageNames[devState.stage];
        }
        
        function devLoop() {
            if (!devRunning) return;
            devState.age += 0.02;
            devState.C += 0.003;
            const currentOmega = devStages[devState.stage].omega;
            if (devState.C >= currentOmega && devState.stage < 3) {
                devState.transitions++;
                devState.stage++;
                devState.C *= 0.3;
                addLog('dev-log', `Stage transition at age ${devState.age.toFixed(1)}: ${devStages[devState.stage].name}`, devStages[devState.stage].color);
            }
            if (devState.age >= 18) { devRunning = false; document.getElementById('dev-start').textContent = 'Complete'; }
            updateDevUI(); renderDev(); requestAnimationFrame(devLoop);
        }
        
        function renderDev() {
            const w = devCanvas.width, h = devCanvas.height, ctx = devCtx;
            ctx.fillStyle = '#0a0a14'; ctx.fillRect(0, 0, w, h);
            const currentStage = devStages[devState.stage];
            const prog = Math.min(devState.C / currentStage.omega, 1);
            const cx = w * 0.3, cy = h * 0.5;
            const size = 30 + devState.stage * 15;
            ctx.beginPath(); ctx.arc(cx, cy - size * 0.3, size * 0.4, 0, Math.PI * 2);
            ctx.fillStyle = currentStage.color + 'cc'; ctx.fill();
            ctx.beginPath(); ctx.ellipse(cx, cy + size * 0.2, size * 0.3, size * 0.5, 0, 0, Math.PI * 2);
            ctx.fillStyle = currentStage.color + '99'; ctx.fill();
            ctx.beginPath(); ctx.arc(cx, cy, size + 20, 0, Math.PI * 2);
            ctx.strokeStyle = 'rgba(255,255,255,0.2)'; ctx.lineWidth = 8; ctx.stroke();
            ctx.beginPath(); ctx.arc(cx, cy, size + 20, -Math.PI/2, -Math.PI/2 + prog * Math.PI * 2);
            ctx.strokeStyle = currentStage.color; ctx.lineWidth = 8; ctx.stroke();
            ctx.fillStyle = 'rgba(255,255,255,0.4)'; ctx.font = '11px Georgia'; ctx.textAlign = 'center';
            ctx.fillText(`C = ${devState.C.toFixed(2)} / Ω = ${currentStage.omega.toFixed(2)}`, cx, cy + size + 50);
            ctx.fillText(`Age: ${devState.age.toFixed(1)} years`, cx, cy + size + 65);
            ctx.textAlign = 'left'; ctx.fillStyle = 'white'; ctx.font = 'bold 14px Georgia';
            ctx.fillText(currentStage.name + ' Stage', w * 0.55, 40);
            ctx.font = '12px Georgia'; ctx.fillStyle = 'rgba(255,255,255,0.7)';
            const descriptions = [
                ['• Reflexes → coordinated actions', '• Object permanence develops', '• Sensory-motor schemas build'],
                ['• Symbolic representation', '• Language explosion', '• Egocentric thinking'],
                ['• Conservation understood', '• Logical operations (concrete)', '• Classification, seriation'],
                ['• Abstract hypotheticals', '• Systematic experimentation', '• Metacognition emerges']
            ];
            descriptions[devState.stage].forEach((line, i) => ctx.fillText(line, w * 0.55, 70 + i * 20));
        }
        
        // =============================================
        // CONTEMPLATIVE SIMULATION
        // =============================================
        let contempInit = false, contempRunning = false, contempCanvas, contempCtx;
        let contempState = { C: 0, Omega: 0.35, particles: [] };
        
        function initContemp() {
            contempCanvas = document.getElementById('contemp-canvas');
            contempCanvas.width = contempCanvas.parentElement.clientWidth; contempCanvas.height = 350;
            contempCtx = contempCanvas.getContext('2d');
            for (let i = 0; i < 50; i++) contempState.particles.push({ angle: Math.random() * Math.PI * 2, radius: 20 + Math.random() * 100, speed: 0.005 + Math.random() * 0.01, depth: Math.random() });
            document.getElementById('contemp-omega').addEventListener('input', e => {
                contempState.Omega = parseFloat(e.target.value);
                document.getElementById('contemp-omega-val').textContent = contempState.Omega.toFixed(2);
                const labels = ['Hypervigilant: Contracted, defensive', 'Ordinary waking consciousness', 'Focused attention: Concentrated', 'Open monitoring: Expanded awareness', 'Non-dual: Subject-object dissolving', 'Approaching cessation'];
                const idx = contempState.Omega < 0.25 ? 0 : contempState.Omega < 0.35 ? 1 : contempState.Omega < 0.50 ? 2 : contempState.Omega < 0.65 ? 3 : contempState.Omega < 0.80 ? 4 : 5;
                document.getElementById('contemp-omega-label').textContent = labels[idx];
            });
            document.getElementById('contemp-start').onclick = () => { contempRunning = !contempRunning; document.getElementById('contemp-start').textContent = contempRunning ? 'Pause' : 'Begin'; if (contempRunning) contempLoop(); };
            document.getElementById('contemp-reset').onclick = () => { contempRunning = false; document.getElementById('contemp-start').textContent = 'Begin'; contempState.C = 0; updateContempUI(); renderContemp(); };
            document.getElementById('contemp-breathe').onclick = () => { contempState.C *= 0.7; addLog('contemp-log', 'Deep breath—releasing', '#06b6d4'); };
            contempInit = true; updateContempUI(); renderContemp();
        }
        
        function updateContempUI() {
            const ratio = contempState.C / contempState.Omega;
            const depth = Math.exp(ratio);
            document.getElementById('contemp-c').textContent = contempState.C.toFixed(2);
            document.getElementById('contemp-threshold').textContent = contempState.Omega.toFixed(2);
            document.getElementById('contemp-ratio').textContent = ratio.toFixed(2);
            document.getElementById('contemp-depth').textContent = depth.toFixed(2);
            const narratives = ['Contracted awareness. Self feels solid, defended.', 'Ordinary consciousness. Clear sense of self and other.', 'Concentration deepening. Distractions fading.', 'Awareness expanding. Boundaries softening.', 'Subject and object beginning to merge.', 'Approaching dissolution. Vast openness.'];
            const idx = contempState.Omega < 0.25 ? 0 : contempState.Omega < 0.35 ? 1 : contempState.Omega < 0.50 ? 2 : contempState.Omega < 0.65 ? 3 : contempState.Omega < 0.80 ? 4 : 5;
            document.getElementById('contemp-narrative').textContent = narratives[idx];
        }
        
        function contempLoop() {
            if (!contempRunning) return;
            contempState.C += 0.002;
            if (contempState.C >= contempState.Omega) { contempState.C *= 0.2; addLog('contemp-log', 'Insight moment—reorganisation', '#a855f7'); }
            contempState.particles.forEach(p => p.angle += p.speed * (1 + contempState.Omega));
            updateContempUI(); renderContemp(); requestAnimationFrame(contempLoop);
        }
        
        function renderContemp() {
            const w = contempCanvas.width, h = contempCanvas.height, ctx = contempCtx;
            ctx.fillStyle = '#0a0a14'; ctx.fillRect(0, 0, w, h);
            const cx = w / 2, cy = h / 2;
            const boundaryRadius = 80 + contempState.Omega * 100;
            ctx.beginPath(); ctx.arc(cx, cy, boundaryRadius, 0, Math.PI * 2);
            ctx.strokeStyle = `rgba(255,255,255,${0.1 + (1 - contempState.Omega) * 0.4})`;
            ctx.lineWidth = 3 + (1 - contempState.Omega) * 8; ctx.stroke();
            for (let p of contempState.particles) {
                const access = Math.exp(-p.depth * (1 - contempState.Omega) * 3);
                if (Math.random() > access * 0.8) continue;
                const px = cx + Math.cos(p.angle) * p.radius * (0.5 + contempState.Omega);
                const py = cy + Math.sin(p.angle) * p.radius * (0.5 + contempState.Omega);
                ctx.beginPath(); ctx.arc(px, py, 2 + contempState.Omega * 3, 0, Math.PI * 2);
                const hue = 200 + p.depth * 100;
                ctx.fillStyle = `hsla(${hue}, 70%, 60%, ${access * 0.7})`; ctx.fill();
            }
            const coreSize = 20 + (1 - contempState.Omega) * 20;
            const prog = Math.min(contempState.C / contempState.Omega, 1);
            ctx.beginPath(); ctx.arc(cx, cy, coreSize, 0, Math.PI * 2);
            ctx.fillStyle = `rgba(255,255,255,${0.3 + (1 - contempState.Omega) * 0.4})`; ctx.fill();
            ctx.beginPath(); ctx.arc(cx, cy, coreSize + 5, -Math.PI/2, -Math.PI/2 + prog * Math.PI * 2);
            ctx.strokeStyle = '#a855f7'; ctx.lineWidth = 3; ctx.stroke();
            ctx.fillStyle = 'rgba(255,255,255,0.5)'; ctx.font = '10px Georgia'; ctx.textAlign = 'center';
            ctx.fillText(`Ω = ${contempState.Omega.toFixed(2)} (boundary permeability)`, cx, h - 20);
        }
        
        // =============================================
        // ZPD SIMULATION (AI SAFETY)
        // =============================================
        let zpdInit = false, zpdRunning = false, zpdCanvas, zpdCtx;
        let zpdState = { C: 0, Omega: 0.35, grounding: 1.0, zcpd: 1.0, particles: [], ruptures: 0 };
        
        function initZpd() {
            zpdCanvas = document.getElementById('zpd-canvas');
            zpdCanvas.width = zpdCanvas.parentElement.clientWidth; 
            zpdCanvas.height = 420;
            zpdCtx = zpdCanvas.getContext('2d');
            
            for (let i = 0; i < 35; i++) {
                zpdState.particles.push({ 
                    x: Math.random() * zpdCanvas.width, 
                    y: Math.random() * zpdCanvas.height, 
                    vx: (Math.random() - 0.5) * 2, 
                    vy: (Math.random() - 0.5) * 2
                });
            }
            
            document.getElementById('zpd-omega').addEventListener('input', e => {
                const newOmega = parseFloat(e.target.value);
                const deltaOmega = Math.abs(newOmega - zpdState.Omega);
                zpdState.Omega = newOmega;
                document.getElementById('zpd-omega-val').textContent = zpdState.Omega.toFixed(2);
                
                if (deltaOmega > 0.03) {
                    zpdState.grounding *= 0.95;
                }
                
                const labels = [
                    'Calcified: Rigid beliefs, rejecting new information',
                    'Contracted: Defensive, narrow window of tolerance',
                    'Grounded: Healthy balance of openness and stability',
                    'Opening: Expanding ideation space',
                    'Expanded: Wide possibility space, monitor grounding',
                    'Highly open: Risk of climbing beyond ZCPD',
                    'Dissolved: Boundaries lost, outside collective reality'
                ];
                const idx = zpdState.Omega < 0.20 ? 0 : zpdState.Omega < 0.28 ? 1 : zpdState.Omega < 0.42 ? 2 : zpdState.Omega < 0.52 ? 3 : zpdState.Omega < 0.62 ? 4 : zpdState.Omega < 0.72 ? 5 : 6;
                document.getElementById('zpd-omega-label').textContent = labels[idx];
            });
            
            document.getElementById('zpd-start').onclick = () => { 
                zpdRunning = !zpdRunning; 
                document.getElementById('zpd-start').textContent = zpdRunning ? 'Pause' : 'Start'; 
                if (zpdRunning) zpdLoop(); 
            };
            
            document.getElementById('zpd-reset').onclick = () => { 
                zpdRunning = false; 
                document.getElementById('zpd-start').textContent = 'Start'; 
                zpdState = { C: 0, Omega: 0.35, grounding: 1.0, zcpd: 1.0, particles: [], ruptures: 0 };
                for (let i = 0; i < 35; i++) {
                    zpdState.particles.push({ 
                        x: Math.random() * zpdCanvas.width, 
                        y: Math.random() * zpdCanvas.height, 
                        vx: (Math.random() - 0.5) * 2, 
                        vy: (Math.random() - 0.5) * 2
                    });
                }
                document.getElementById('zpd-omega').value = 0.35;
                document.getElementById('zpd-omega-val').textContent = '0.35';
                document.getElementById('zpd-warning').style.display = 'none'; 
                updateZpdUI(); 
                renderZpd(); 
            };
            
            document.getElementById('zpd-ai').onclick = () => { 
                zpdState.C += zpdState.Omega * 0.12;
                zpdState.Omega = Math.min(0.75, zpdState.Omega + 0.015);
                zpdState.grounding *= 0.94;
                zpdState.zcpd *= 0.97;
                addLog('zpd-log', 'AI validates ideas... Ω opening, climbing ladder', '#f59e0b');
            };
            
            document.getElementById('zpd-ground').onclick = () => { 
                zpdState.C *= 0.7;
                zpdState.grounding = Math.min(1, zpdState.grounding + 0.25);
                zpdState.zcpd = Math.min(1, zpdState.zcpd + 0.2);
                zpdState.Omega = zpdState.Omega * 0.85 + 0.35 * 0.15;
                addLog('zpd-log', 'Social grounding—returning to ZCPD', '#10b981');
            };
            
            document.getElementById('zpd-somatic').onclick = () => {
                zpdState.grounding = Math.min(1, zpdState.grounding + 0.15);
                zpdState.Omega = zpdState.Omega * 0.9 + 0.35 * 0.1;
                addLog('zpd-log', 'Somatic practice—embodied integration', '#10b981');
            };
            
            document.getElementById('zpd-intense').onclick = () => { 
                zpdState.C += zpdState.Omega * 0.4;
                zpdState.Omega = Math.min(0.75, zpdState.Omega + 0.06);
                zpdState.grounding *= 0.75;
                zpdState.zcpd *= 0.85;
                addLog('zpd-log', '⚠️ Intense session—rapid climb outside ZCPD!', '#dc2626');
            };
            
            zpdInit = true; 
            updateZpdUI(); 
            renderZpd();
        }
        
        function updateZpdUI() {
            const ratio = zpdState.C / zpdState.Omega;
            const omegaDeviation = Math.abs(zpdState.Omega - 0.35) / 0.40;
            
            document.getElementById('zpd-cog').textContent = zpdState.C.toFixed(2);
            document.getElementById('zpd-som').textContent = zpdState.Omega.toFixed(2);
            document.getElementById('zpd-gap').textContent = (zpdState.zcpd * 100).toFixed(0) + '%';
            document.getElementById('zpd-gap').style.color = zpdState.zcpd > 0.7 ? '#10b981' : zpdState.zcpd > 0.4 ? '#f59e0b' : '#dc2626';
            document.getElementById('zpd-collective').textContent = zpdState.grounding.toFixed(2);
            
            const riskScore = (ratio * 0.4) + (omegaDeviation * 0.3) + ((1 - zpdState.zcpd) * 0.2) + ((1 - zpdState.grounding) * 0.1);
            const risk = riskScore < 0.25 ? 'Low' : riskScore < 0.5 ? 'Medium' : riskScore < 0.75 ? 'High' : 'CRITICAL';
            document.getElementById('zpd-risk').textContent = risk;
            document.getElementById('zpd-risk').style.color = riskScore < 0.25 ? '#10b981' : riskScore < 0.5 ? '#f59e0b' : '#dc2626';
            
            const showWarning = ratio > 0.6 || zpdState.zcpd < 0.5 || zpdState.Omega > 0.58 || zpdState.Omega < 0.22;
            document.getElementById('zpd-warning').style.display = showWarning ? 'block' : 'none';
            
            if (zpdState.Omega > 0.58) {
                document.getElementById('zpd-warning-text').textContent = 'Ω too open—climbing beyond ZCPD. Ideas becoming incommunicable to others. You risk becoming alien to your community.';
            } else if (zpdState.Omega < 0.22) {
                document.getElementById('zpd-warning-text').textContent = 'Ω calcifying—beliefs rigidifying. New information being rejected. Risk of isolated certainty.';
            } else if (zpdState.zcpd < 0.5) {
                document.getElementById('zpd-warning-text').textContent = 'Drifting outside Zone of Collective Proximal Development. Your ideation space no longer overlaps with shared understanding.';
            } else if (ratio > 0.6) {
                document.getElementById('zpd-warning-text').textContent = 'Coherence accumulating faster than integration. Consider grounding practices.';
            }
            
            let narrative;
            if (zpdState.Omega < 0.25) {
                narrative = 'Ω contracted—beliefs calcifying. New ideas rejected before consideration. Risk of rigid isolation even within community.';
            } else if (zpdState.Omega > 0.60 && zpdState.zcpd < 0.6) {
                narrative = 'Climbing Jacob\'s ladder beyond ZCPD. Ideas feel profound but are becoming incommunicable. Others may see you as "losing touch."';
            } else if (zpdState.zcpd < 0.4) {
                narrative = 'Outside Zone of Collective Proximal Development. Your reality tunnel has diverged from shared human understanding. Social grounding critical.';
            } else if (ratio > 0.8) {
                narrative = 'Approaching rupture threshold. Ideation outpacing integration capacity. High risk of psychological crisis.';
            } else if (ratio < 0.4 && zpdState.zcpd > 0.7 && zpdState.Omega > 0.28 && zpdState.Omega < 0.50) {
                narrative = 'Balanced state. Ω in healthy range. Ideas can be shared and understood. Safe exploration within ZCPD.';
            } else {
                narrative = 'Productive exploration. Monitor Ω—too open risks climbing beyond collective, too closed risks calcification.';
            }
            document.getElementById('zpd-narrative').textContent = narrative;
        }
        
        function zpdLoop() {
            if (!zpdRunning) return;
            
            zpdState.C += 0.001 * (0.5 + zpdState.Omega);
            zpdState.grounding *= 0.9998;
            
            if (zpdState.Omega > 0.50 || zpdState.Omega < 0.25) {
                zpdState.zcpd *= 0.9995;
            }
            if (zpdState.C / zpdState.Omega > 0.5) {
                zpdState.zcpd *= 0.9998;
            }
            
            if (zpdState.C >= zpdState.Omega && zpdState.zcpd < 0.6) {
                zpdState.ruptures++;
                zpdState.C *= 0.25;
                zpdState.grounding *= 0.5;
                zpdState.zcpd *= 0.7;
                addLog('zpd-log', '💥 RUPTURE—psychological crisis outside ZCPD', '#dc2626');
            } else if (zpdState.C >= zpdState.Omega) {
                zpdState.C *= 0.5;
                addLog('zpd-log', 'Threshold reached—collective support enables integration', '#f59e0b');
            }
            
            const speed = 1 + (zpdState.C / zpdState.Omega) + (zpdState.Omega - 0.35);
            zpdState.particles.forEach(p => {
                p.x += p.vx * speed;
                p.y += p.vy * speed;
                if (p.x < 0 || p.x > zpdCanvas.width) p.vx *= -1;
                if (p.y < 0 || p.y > zpdCanvas.height) p.vy *= -1;
            });
            
            updateZpdUI(); 
            renderZpd(); 
            requestAnimationFrame(zpdLoop);
        }
        
        function renderZpd() {
            const w = zpdCanvas.width, h = zpdCanvas.height, ctx = zpdCtx;
            ctx.fillStyle = '#0a0a14'; 
            ctx.fillRect(0, 0, w, h);
            
            const cx = w / 2, cy = h / 2;
            const ratio = zpdState.C / zpdState.Omega;
            
            const zcpdRadius = 200 * zpdState.zcpd;
            ctx.beginPath();
            ctx.arc(cx, cy, zcpdRadius, 0, Math.PI * 2);
            ctx.strokeStyle = `rgba(139, 92, 246, ${0.3 + zpdState.zcpd * 0.4})`;
            ctx.lineWidth = 3;
            ctx.setLineDash([10, 5]);
            ctx.stroke();
            ctx.setLineDash([]);
            
            ctx.fillStyle = `rgba(139, 92, 246, ${0.5 + zpdState.zcpd * 0.3})`;
            ctx.font = '11px Georgia';
            ctx.textAlign = 'center';
            ctx.fillText('Zone of Collective Proximal Development', cx, cy - zcpdRadius - 8);
            
            const safeR = 60, zpdR = 120, dangerR = 180;
            
            ctx.beginPath();
            ctx.arc(cx, cy, dangerR, 0, Math.PI * 2);
            ctx.fillStyle = 'rgba(220, 38, 38, 0.12)';
            ctx.fill();
            ctx.strokeStyle = '#dc2626';
            ctx.lineWidth = 2;
            ctx.stroke();
            
            ctx.beginPath();
            ctx.arc(cx, cy, zpdR, 0, Math.PI * 2);
            ctx.fillStyle = 'rgba(245, 158, 11, 0.12)';
            ctx.fill();
            ctx.strokeStyle = '#f59e0b';
            ctx.lineWidth = 2;
            ctx.stroke();
            
            ctx.beginPath();
            ctx.arc(cx, cy, safeR, 0, Math.PI * 2);
            ctx.fillStyle = 'rgba(16, 185, 129, 0.15)';
            ctx.fill();
            ctx.strokeStyle = '#10b981';
            ctx.lineWidth = 2;
            ctx.stroke();
            
            ctx.font = '10px Georgia';
            ctx.fillStyle = 'rgba(255,255,255,0.5)';
            ctx.fillText('SAFE', cx, cy - safeR + 15);
            ctx.fillText('INDIVIDUAL ZPD', cx, cy - zpdR + 15);
            ctx.fillText('DANGER', cx, cy - dangerR + 15);
            
            const indivR = 20 + ratio * 120;
            ctx.beginPath();
            ctx.arc(cx, cy, indivR, 0, Math.PI * 2);
            
            const outsideZCPD = indivR > zcpdRadius;
            const hue = outsideZCPD ? 280 : (ratio < 0.5 ? 120 : ratio < 0.8 ? 45 : 0);
            ctx.fillStyle = `hsla(${hue}, 70%, 50%, 0.5)`;
            ctx.fill();
            ctx.strokeStyle = outsideZCPD ? '#a855f7' : `hsla(${hue}, 70%, 60%, 0.9)`;
            ctx.lineWidth = 3;
            ctx.stroke();
            
            const omegaRingR = 30 + zpdState.Omega * 180;
            ctx.beginPath();
            ctx.arc(cx, cy, omegaRingR, 0, Math.PI * 2);
            ctx.strokeStyle = `rgba(255, 255, 255, ${0.15 + (1 - zpdState.Omega) * 0.2})`;
            ctx.lineWidth = 1 + (0.75 - zpdState.Omega) * 6;
            ctx.stroke();
            
            ctx.fillStyle = 'rgba(255,255,255,0.4)';
            ctx.font = '9px Courier New';
            ctx.fillText(`Ω=${zpdState.Omega.toFixed(2)}`, cx + omegaRingR + 5, cy);
            
            for (let p of zpdState.particles) {
                ctx.beginPath();
                ctx.arc(p.x, p.y, 3, 0, Math.PI * 2);
                ctx.fillStyle = 'rgba(255,255,255,0.35)';
                ctx.fill();
            }
            
            ctx.beginPath();
            ctx.moveTo(cx, cy + indivR);
            ctx.lineTo(cx, h - 25);
            ctx.strokeStyle = `rgba(16, 185, 129, ${zpdState.grounding})`;
            ctx.lineWidth = 2 + zpdState.grounding * 5;
            ctx.stroke();
            
            ctx.fillStyle = '#10b981';
            ctx.font = '10px Georgia';
            ctx.fillText(`Grounding: ${(zpdState.grounding * 100).toFixed(0)}%`, cx, h - 8);
            
            ctx.beginPath();
            ctx.arc(cx, cy, indivR + 8, -Math.PI/2, -Math.PI/2 + Math.min(ratio, 1) * Math.PI * 2);
            ctx.strokeStyle = 'rgba(255,255,255,0.8)';
            ctx.lineWidth = 4;
            ctx.stroke();
            
            if (outsideZCPD) {
                ctx.fillStyle = '#a855f7';
                ctx.font = 'bold 12px Georgia';
                ctx.fillText('⚠ OUTSIDE ZCPD', cx, cy - indivR - 25);
            }
        }
    </script>
</body>
</html>
