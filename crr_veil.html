<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CRR Supernova Remnant: Veil Nebula — Cosmic Regeneration</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background: #020008;
            color: #d0d8e8;
            font-family: 'Courier New', monospace;
            min-height: 100vh;
            overflow-x: hidden;
        }
        
        .container {
            max-width: 1500px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            text-align: center;
            padding: 15px 0 25px;
            border-bottom: 1px solid #1a1a3a;
        }
        
        h1 {
            font-size: 1.6em;
            font-weight: 300;
            background: linear-gradient(90deg, #ff6a9a, #aa7aff, #4af0ff, #7aff9a);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            letter-spacing: 4px;
            margin-bottom: 6px;
        }
        
        .subtitle {
            color: #6a7a9a;
            font-size: 0.8em;
            letter-spacing: 2px;
        }
        
        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 25px;
            margin-top: 25px;
        }
        
        @media (max-width: 1000px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }
        
        /* Nebula Display */
        .nebula-container {
            background: radial-gradient(ellipse at center, #050015 0%, #020008 100%);
            border-radius: 12px;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 520px;
            position: relative;
            overflow: hidden;
            border: 1px solid #1a1a3a;
        }
        
        .star-field {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }
        
        .background-star {
            position: absolute;
            background: white;
            border-radius: 50%;
        }
        
        #nebula-canvas {
            position: relative;
            z-index: 10;
            cursor: grab;
        }
        
        #nebula-canvas:active {
            cursor: grabbing;
        }
        
        .nebula-info {
            text-align: center;
            margin-top: 15px;
            z-index: 10;
        }
        
        .nebula-name {
            font-size: 1.3em;
            background: linear-gradient(90deg, #ff9aaa, #aaaaff, #aaffaa);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            letter-spacing: 3px;
            margin-bottom: 4px;
        }
        
        .nebula-designation {
            color: #5a6a8a;
            font-size: 0.7em;
            letter-spacing: 1px;
        }
        
        /* Controls */
        .controls-overlay {
            position: absolute;
            top: 15px;
            left: 15px;
            right: 15px;
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            z-index: 20;
            pointer-events: none;
        }
        
        .controls-overlay > * {
            pointer-events: auto;
        }
        
        .distance-display {
            color: #4a5a7a;
            font-size: 0.7em;
            letter-spacing: 1px;
            background: rgba(5, 5, 15, 0.9);
            padding: 10px 16px;
            border-radius: 20px;
            border: 1px solid #1a1a3a;
        }
        
        .distance-value {
            color: #ff9aff;
            font-weight: bold;
        }
        
        .crr-state-display {
            background: rgba(5, 5, 15, 0.9);
            border: 1px solid #2a2a4a;
            border-radius: 20px;
            padding: 10px 16px;
            color: #6a7a9a;
            font-size: 0.65em;
            letter-spacing: 1px;
        }
        
        .zoom-controls {
            position: absolute;
            bottom: 15px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            align-items: center;
            gap: 12px;
            z-index: 20;
            background: rgba(5, 5, 15, 0.9);
            padding: 10px 18px;
            border-radius: 30px;
            border: 1px solid #2a2a4a;
        }
        
        .zoom-btn {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            border: 1px solid #3a4a6a;
            background: transparent;
            color: #8a9aba;
            font-size: 1.3em;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .zoom-btn:hover {
            background: #1a1a2a;
            border-color: #5a6a8a;
            color: #ff9aff;
        }
        
        .zoom-slider {
            width: 140px;
            height: 4px;
            -webkit-appearance: none;
            appearance: none;
            background: linear-gradient(90deg, #1a1a3a 0%, #5a4a7a 100%);
            border-radius: 2px;
            outline: none;
        }
        
        .zoom-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 14px;
            height: 14px;
            border-radius: 50%;
            background: linear-gradient(135deg, #ff9aff, #9aaff);
            cursor: pointer;
            box-shadow: 0 0 10px rgba(255, 154, 255, 0.5);
        }
        
        .zoom-label {
            color: #5a6a8a;
            font-size: 0.65em;
            min-width: 80px;
            text-align: center;
        }
        
        /* Calculations Panel */
        .calculations {
            background: #080810;
            border-radius: 12px;
            padding: 20px;
            border: 1px solid #1a1a3a;
        }
        
        .calc-header {
            color: #8a9aba;
            font-size: 0.7em;
            letter-spacing: 2px;
            margin-bottom: 12px;
            padding-bottom: 8px;
            border-bottom: 1px solid #1a1a3a;
        }
        
        .crr-equation {
            background: #0a0a14;
            padding: 12px 16px;
            border-radius: 8px;
            margin-bottom: 15px;
            font-family: 'Times New Roman', serif;
            font-size: 1em;
            text-align: center;
            color: #a0b0d0;
            border-left: 3px solid #6a4a9a;
        }
        
        .crr-component {
            background: #050508;
            padding: 10px 12px;
            border-radius: 6px;
            margin-bottom: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .component-label {
            color: #6a7a9a;
            font-size: 0.75em;
        }
        
        .component-value {
            color: #cad9ff;
            font-size: 0.85em;
            font-weight: bold;
        }
        
        .live-value {
            color: #ff9aff;
            transition: color 0.1s;
        }
        
        /* Systems Grid */
        .systems-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 25px;
        }
        
        @media (max-width: 1000px) {
            .systems-grid {
                grid-template-columns: 1fr;
            }
        }
        
        .system-panel {
            background: #080810;
            border-radius: 12px;
            padding: 18px;
            border: 1px solid #1a1a3a;
        }
        
        .system-title {
            color: #8a9aba;
            font-size: 0.65em;
            letter-spacing: 2px;
            margin-bottom: 12px;
        }
        
        .system-row {
            display: flex;
            justify-content: space-between;
            padding: 6px 0;
            border-bottom: 1px solid #101018;
            font-size: 0.75em;
        }
        
        .system-row:last-child {
            border-bottom: none;
        }
        
        .system-label {
            color: #5a6a8a;
        }
        
        .system-value {
            color: #a0b0c0;
        }
        
        .symmetry-z2 { color: #ff9a7a; }
        .symmetry-so2 { color: #7affda; }
        .phase-explosion { color: #ff5a5a; }
        .phase-sedov { color: #ffaa5a; }
        .phase-radiative { color: #5affaa; }
        
        /* Timeline */
        .timeline-container {
            grid-column: 1 / -1;
            background: #080810;
            border-radius: 12px;
            padding: 20px;
            border: 1px solid #1a1a3a;
            margin-top: 10px;
        }
        
        .timeline-title {
            color: #8a9aba;
            font-size: 0.65em;
            letter-spacing: 2px;
            margin-bottom: 15px;
        }
        
        .timeline {
            position: relative;
            height: 100px;
        }
        
        .timeline-bar {
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, 
                #ff5a5a 0%, #ffaa5a 25%, #5affaa 50%,
                #5aaaff 75%, #aa5aff 100%
            );
            transform: translateY(-50%);
        }
        
        .timeline-point {
            position: absolute;
            top: 50%;
            transform: translate(-50%, -50%);
            width: 14px;
            height: 14px;
            border-radius: 50%;
            border: 2px solid;
            background: #080810;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .timeline-point:hover {
            transform: translate(-50%, -50%) scale(1.4);
            box-shadow: 0 0 15px currentColor;
        }
        
        .point-label {
            position: absolute;
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
            margin-top: 20px;
            font-size: 0.6em;
            color: #5a6a8a;
            white-space: nowrap;
            text-align: center;
        }
        
        .point-time {
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            margin-bottom: 20px;
            font-size: 0.55em;
            color: #3a4a6a;
        }
        
        /* Real-time Panel */
        .realtime-panel {
            grid-column: 1 / -1;
            background: linear-gradient(135deg, #080810 0%, #0a0a18 100%);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid #2a2a4a;
            margin-top: 10px;
        }
        
        .realtime-title {
            color: #ff9aff;
            font-size: 0.65em;
            letter-spacing: 2px;
            margin-bottom: 12px;
        }
        
        .realtime-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 12px;
        }
        
        .realtime-item {
            background: #050508;
            padding: 12px;
            border-radius: 8px;
            text-align: center;
        }
        
        .realtime-label {
            color: #4a5a7a;
            font-size: 0.6em;
            letter-spacing: 1px;
            margin-bottom: 6px;
        }
        
        .realtime-value {
            color: #ff9aff;
            font-size: 1.2em;
            font-weight: bold;
        }
        
        .realtime-unit {
            color: #3a4a6a;
            font-size: 0.6em;
            margin-top: 2px;
        }
        
        /* Footer */
        footer {
            text-align: center;
            padding: 25px;
            color: #3a4a6a;
            font-size: 0.65em;
            margin-top: 25px;
            border-top: 1px solid #1a1a3a;
        }
        
        footer a {
            color: #7a6aaa;
            text-decoration: none;
        }
        
        /* Loading overlay */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #020008;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            transition: opacity 0.5s;
        }
        
        .loading-overlay.hidden {
            opacity: 0;
            pointer-events: none;
        }
        
        .loading-text {
            color: #6a7a9a;
            font-size: 0.8em;
            letter-spacing: 3px;
            margin-top: 20px;
        }
        
        .loading-nebula {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: radial-gradient(circle, 
                rgba(255,154,255,0.8) 0%, 
                rgba(154,170,255,0.4) 30%,
                rgba(154,255,255,0.2) 60%,
                transparent 70%
            );
            animation: nebula-pulse 2s ease-in-out infinite;
        }
        
        @keyframes nebula-pulse {
            0%, 100% { transform: scale(1) rotate(0deg); opacity: 0.8; }
            50% { transform: scale(1.3) rotate(180deg); opacity: 1; }
        }
        
        /* Emission legend */
        .emission-legend {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 10px;
            flex-wrap: wrap;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 0.6em;
            color: #5a6a8a;
        }
        
        .legend-color {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }
        
        .color-hydrogen { background: #ff5a7a; }
        .color-oxygen { background: #5aaaff; }
        .color-sulfur { background: #7aff9a; }
    </style>
</head>
<body>
    <div class="loading-overlay" id="loading">
        <div class="loading-nebula"></div>
        <div class="loading-text">INITIALIZING SUPERNOVA REMNANT SIMULATION</div>
    </div>
    
    <div class="container">
        <header>
            <h1>CRR SUPERNOVA REMNANT</h1>
            <div class="subtitle">VEIL NEBULA (NGC 6960/6992) — COSMIC REGENERATION FROM STELLAR DEATH</div>
        </header>
        
        <div class="main-content">
            <!-- Nebula Display -->
            <div class="nebula-container">
                <div class="star-field" id="starField"></div>
                
                <div class="controls-overlay">
                    <div class="distance-display">
                        DISTANCE: <span class="distance-value" id="distance-display">2,400 ly</span>
                    </div>
                    <div class="crr-state-display" id="crr-state">
                        <span style="color: #ff9aff;">●</span> CRR ACTIVE
                    </div>
                </div>
                
                <canvas id="nebula-canvas" width="380" height="380"></canvas>
                
                <div class="nebula-info">
                    <div class="nebula-name">VEIL NEBULA</div>
                    <div class="nebula-designation">Cygnus Loop · SNR · Age ~20,000 yr · Ø 130 ly</div>
                </div>
                
                <div class="emission-legend">
                    <div class="legend-item">
                        <div class="legend-color color-hydrogen"></div>
                        <span>Hα (656 nm)</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color color-oxygen"></div>
                        <span>[O III] (501 nm)</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color color-sulfur"></div>
                        <span>[S II] (672 nm)</span>
                    </div>
                </div>
                
                <div class="zoom-controls">
                    <button class="zoom-btn" id="zoom-out">−</button>
                    <input type="range" class="zoom-slider" id="zoom-slider" min="0" max="100" value="0">
                    <button class="zoom-btn" id="zoom-in">+</button>
                    <div class="zoom-label" id="zoom-label">Earth View</div>
                </div>
            </div>
            
            <!-- CRR Calculations -->
            <div class="calculations">
                <div class="calc-header">CRR FRAMEWORK — SUPERNOVA REMNANT</div>
                
                <div class="crr-equation">C(x,t) = ∫ L(x,τ) dτ — Coherence</div>
                <div class="crr-component">
                    <span class="component-label">Accumulated Coherence</span>
                    <span class="component-value live-value" id="coherence-live">0.0000</span>
                </div>
                
                <div class="crr-equation">δ(now) — Rupture (Supernova)</div>
                <div class="crr-component">
                    <span class="component-label">Total Rupture Events</span>
                    <span class="component-value live-value" id="rupture-count">0</span>
                </div>
                
                <div class="crr-equation">R = ∫ φ · exp(C/Ω) · Θ dτ — Regeneration</div>
                <div class="crr-component">
                    <span class="component-label">Memory Weight exp(C/Ω)</span>
                    <span class="component-value live-value" id="memory-weight">1.0000</span>
                </div>
                
                <div style="margin-top: 12px; padding-top: 12px; border-top: 1px solid #1a1a3a;">
                    <div class="crr-component">
                        <span class="component-label">Ω (Z₂) = 1/π — Shock Front</span>
                        <span class="component-value">0.31831</span>
                    </div>
                    <div class="crr-component">
                        <span class="component-label">Ω (SO(2)) = 1/2π — Expansion</span>
                        <span class="component-value">0.15915</span>
                    </div>
                    <div class="crr-component">
                        <span class="component-label">e<sup>π</sup> — RT Instability Gain</span>
                        <span class="component-value">23.1407</span>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Systems Grid -->
        <div class="systems-grid">
            <div class="system-panel">
                <div class="system-title">SNR EVOLUTIONARY PHASES (CRR)</div>
                <div class="system-row">
                    <span class="system-label">Explosion (δ-rupture)</span>
                    <span class="system-value"><span class="phase-explosion">t₀</span> · E = 10⁵¹ erg</span>
                </div>
                <div class="system-row">
                    <span class="system-label">Free Expansion</span>
                    <span class="system-value">τ ~ 200 yr · <span class="symmetry-z2">Z₂</span></span>
                </div>
                <div class="system-row">
                    <span class="system-label">Sedov-Taylor Phase</span>
                    <span class="system-value">τ ~ 10-20 kyr · <span class="symmetry-so2">SO(2)</span></span>
                </div>
                <div class="system-row">
                    <span class="system-label">Radiative/Snowplow</span>
                    <span class="system-value">τ ~ 30+ kyr · <span class="phase-radiative">Cooling</span></span>
                </div>
                <div class="system-row">
                    <span class="system-label">ISM Merger</span>
                    <span class="system-value">τ ~ 100+ kyr · Dispersal</span>
                </div>
            </div>
            
            <div class="system-panel">
                <div class="system-title">SHOCK PHYSICS CRR DYNAMICS</div>
                <div class="system-row">
                    <span class="system-label">Shock Velocity</span>
                    <span class="system-value">~1.5×10⁶ km/hr · <span class="symmetry-z2">Z₂</span></span>
                </div>
                <div class="system-row">
                    <span class="system-label">Rayleigh-Taylor τ</span>
                    <span class="system-value">~10³ yr · <span class="symmetry-so2">SO(2)</span></span>
                </div>
                <div class="system-row">
                    <span class="system-label">Richtmyer-Meshkov</span>
                    <span class="system-value">Impulsive · <span class="symmetry-z2">Z₂</span></span>
                </div>
                <div class="system-row">
                    <span class="system-label">Recombination τ</span>
                    <span class="system-value">~10⁴ yr · <span class="symmetry-so2">SO(2)</span></span>
                </div>
                <div class="system-row">
                    <span class="system-label">Filament Thickness</span>
                    <span class="system-value">~0.003 ly (1/50000 R)</span>
                </div>
            </div>
            
            <div class="system-panel">
                <div class="system-title">EMISSION LINE CRR</div>
                <div class="system-row">
                    <span class="system-label">Hα (Hydrogen)</span>
                    <span class="system-value">656.3 nm · Shock Front</span>
                </div>
                <div class="system-row">
                    <span class="system-label">[O III] (Oxygen)</span>
                    <span class="system-value">500.7 nm · Hot Interior</span>
                </div>
                <div class="system-row">
                    <span class="system-label">[S II] (Sulfur)</span>
                    <span class="system-value">672.4 nm · Cooling Shell</span>
                </div>
                <div class="system-row">
                    <span class="system-label">X-ray (Thermal)</span>
                    <span class="system-value">~10⁶ K plasma</span>
                </div>
                <div class="system-row">
                    <span class="system-label">Radio (Synchrotron)</span>
                    <span class="system-value">Relativistic e⁻</span>
                </div>
            </div>
            
            <div class="system-panel">
                <div class="system-title">OBSERVER CRR CHAIN</div>
                <div class="system-row">
                    <span class="system-label">Light Travel Time</span>
                    <span class="system-value">~2,400 years</span>
                </div>
                <div class="system-row">
                    <span class="system-label">Angular Size</span>
                    <span class="system-value">~3° (6× Moon)</span>
                </div>
                <div class="system-row">
                    <span class="system-label">Retinal Integration</span>
                    <span class="system-value">τ = 100ms · <span class="symmetry-z2">Z₂</span></span>
                </div>
                <div class="system-row">
                    <span class="system-label">V1 Gamma Binding</span>
                    <span class="system-value">40 Hz · <span class="symmetry-so2">SO(2)</span></span>
                </div>
                <div class="system-row">
                    <span class="system-label">Cortical Gain</span>
                    <span class="system-value">e<sup>π</sup> ≈ 23.14 / level</span>
                </div>
            </div>
        </div>
        
        <!-- Timeline -->
        <div class="timeline-container">
            <div class="timeline-title">CRR CYCLE: STELLAR COHERENCE → RUPTURE → COSMIC REGENERATION</div>
            <div class="timeline">
                <div class="timeline-bar"></div>
                <div class="timeline-point" style="left: 0%; border-color: #ff5a5a; color: #ff5a5a;">
                    <div class="point-time">-20 kyr</div>
                    <div class="point-label">Supernova δ</div>
                </div>
                <div class="timeline-point" style="left: 10%; border-color: #ff8a5a; color: #ff8a5a;">
                    <div class="point-time">~200 yr</div>
                    <div class="point-label">Free Expansion</div>
                </div>
                <div class="timeline-point" style="left: 30%; border-color: #ffda5a; color: #ffda5a;">
                    <div class="point-time">~1,300 yr</div>
                    <div class="point-label">Sedov-Taylor</div>
                </div>
                <div class="timeline-point" style="left: 55%; border-color: #5affaa; color: #5affaa;">
                    <div class="point-time">NOW</div>
                    <div class="point-label">Radiative Phase</div>
                </div>
                <div class="timeline-point" style="left: 75%; border-color: #5adaff; color: #5adaff;">
                    <div class="point-time">~30 kyr</div>
                    <div class="point-label">Snowplow</div>
                </div>
                <div class="timeline-point" style="left: 95%; border-color: #aa5aff; color: #aa5aff;">
                    <div class="point-time">~100+ kyr</div>
                    <div class="point-label">ISM Merger</div>
                </div>
            </div>
        </div>
        
        <!-- Real-time Panel -->
        <div class="realtime-panel">
            <div class="realtime-title">◉ LIVE CRR DYNAMICS</div>
            <div class="realtime-grid">
                <div class="realtime-item">
                    <div class="realtime-label">DISPLAY δ</div>
                    <div class="realtime-value" id="display-ruptures">0</div>
                    <div class="realtime-unit">frames</div>
                </div>
                <div class="realtime-item">
                    <div class="realtime-label">SHOCK FRONT δ</div>
                    <div class="realtime-value" id="shock-ruptures">0</div>
                    <div class="realtime-unit">collisions</div>
                </div>
                <div class="realtime-item">
                    <div class="realtime-label">RT INSTABILITY</div>
                    <div class="realtime-value" id="rt-cycles">0</div>
                    <div class="realtime-unit">mixing events</div>
                </div>
                <div class="realtime-item">
                    <div class="realtime-label">RECOMBINATION</div>
                    <div class="realtime-value" id="recombination-cycles">0</div>
                    <div class="realtime-unit">ion captures</div>
                </div>
                <div class="realtime-item">
                    <div class="realtime-label">FILAMENT GLOW</div>
                    <div class="realtime-value" id="current-brightness">100%</div>
                    <div class="realtime-unit">intensity</div>
                </div>
                <div class="realtime-item">
                    <div class="realtime-label">SESSION C(t)</div>
                    <div class="realtime-value" id="session-coherence">0.00</div>
                    <div class="realtime-unit">accumulated</div>
                </div>
            </div>
        </div>
        
        <footer>
            CRR Framework © 2025 Alexander Sabine · <a href="https://cohere.org.uk">cohere.org.uk</a><br>
            <span style="color: #2a3a5a;">Supernova remnant physics based on Veil Nebula (Cygnus Loop) observations</span>
        </footer>
    </div>
    
    <script>
        /**
         * ╔══════════════════════════════════════════════════════════════════════════════╗
         * ║           CRR SUPERNOVA REMNANT: MATHEMATICAL FOUNDATIONS                    ║
         * ║                                                                              ║
         * ║  This simulation implements the Coherence-Rupture-Regeneration (CRR)         ║
         * ║  framework for supernova remnant evolution — the ultimate cosmic example     ║
         * ║  of the CRR cycle: stellar coherence → catastrophic rupture → regeneration   ║
         * ║  of new matter, eventually forming new stars, planets, and life.             ║
         * ║                                                                              ║
         * ║  THE VEIL NEBULA AS CRR PARADIGM:                                            ║
         * ║  ════════════════════════════════════════════════════════════════════════    ║
         * ║  • COHERENCE: 20M☉ star accumulated ~10 Myr of nuclear coherence            ║
         * ║  • RUPTURE: Supernova δ-event ~20,000 years ago, E = 10⁵¹ erg               ║
         * ║  • REGENERATION: Expanding shock enriches ISM, seeds future stars           ║
         * ║                                                                              ║
         * ║  CORE CRR EQUATIONS:                                                         ║
         * ║    (1) C(x,t) = ∫₀ᵗ L(x,τ) dτ           [Coherence Accumulation]            ║
         * ║    (2) δ(now)                            [Rupture: Supernova event]          ║
         * ║    (3) R = ∫ φ·exp(C/Ω)·Θ dτ            [Regeneration with memory]          ║
         * ║                                                                              ║
         * ║  Author: Alexander Sabine · cohere.org.uk                                    ║
         * ╚══════════════════════════════════════════════════════════════════════════════╝
         */

        // ════════════════════════════════════════════════════════════════════════════════
        // SECTION 1: CRR FUNDAMENTAL CONSTANTS
        // ════════════════════════════════════════════════════════════════════════════════
        
        /**
         * @CRR_THEOREM: Ω-Symmetry Correspondence
         * ═══════════════════════════════════════════════════════════════════════════════
         * 
         * In supernova remnants, we observe BOTH Z₂ and SO(2) symmetries:
         * 
         * Z₂ PROCESSES (Binary/Shock):
         * - Shock front passage: gas is shocked or not shocked
         * - Richtmyer-Meshkov instability: impulsive acceleration
         * - Ionization events: atom ionized or neutral
         * 
         * SO(2) PROCESSES (Continuous/Rotational):
         * - Sedov-Taylor expansion: self-similar spherical growth
         * - Rayleigh-Taylor mixing: continuous turbulent flow
         * - Recombination cascades: continuous electron capture
         * 
         * The Veil Nebula at ~20,000 years is in the RADIATIVE phase,
         * transitioning from Sedov-Taylor (SO(2)) dynamics.
         */
        
        const OMEGA_Z2 = 1 / Math.PI;  // = 0.3183098861837907
        const OMEGA_SO2 = 1 / (2 * Math.PI);  // = 0.15915494309189535
        const EXP_PI = Math.exp(Math.PI);  // = 23.140692632779267
        
        /**
         * @CRR_TIMESCALES: Supernova Remnant CRR Periods
         * 
         * The Veil Nebula demonstrates CRR across vast timescales:
         * 
         * PROGENITOR COHERENCE:
         * - Main sequence: ~10⁷ years of nuclear fusion coherence
         * - Pre-SN stellar wind: ~10⁵ years blowing cavity
         * 
         * RUPTURE EVENT:
         * - Core collapse: ~milliseconds (ultimate δ)
         * - Energy release: 10⁵¹ ergs in seconds
         * 
         * REGENERATION PHASES:
         * - Free expansion: ~200-300 years
         * - Sedov-Taylor: ~1,000-20,000 years
         * - Radiative: ~20,000-100,000 years
         * - ISM merger: >100,000 years
         */
        
        const TAU_DISPLAY = 1/60;  // Display refresh ~16.67ms
        const TAU_SHOCK = 0.1;    // Simulated shock collision events
        const TAU_RT = 0.5;       // Rayleigh-Taylor mixing timescale
        const TAU_RECOMB = 0.25;  // Recombination events
        const TAU_RETINAL = 0.1;  // Retinal integration
        const TAU_GAMMA = 0.025;  // V1 gamma oscillation
        
        // ════════════════════════════════════════════════════════════════════════════════
        // SECTION 2: VEIL NEBULA PHYSICAL PARAMETERS
        // ════════════════════════════════════════════════════════════════════════════════
        
        /**
         * @CRR_APPLICATION: Veil Nebula (Cygnus Loop) Parameters
         * 
         * The Veil Nebula is a PROTOTYPICAL middle-aged supernova remnant,
         * ideal for demonstrating CRR dynamics because:
         * 
         * 1. It's in the RADIATIVE phase — showing both shock (Z₂) and
         *    cooling/recombination (SO(2)) processes simultaneously
         * 
         * 2. The filamentary structure reveals the shock front geometry:
         *    - Edge-on viewing = bright filaments
         *    - Face-on viewing = diffuse emission
         *    This is the CRR "rupture surface" made visible!
         * 
         * 3. Multi-wavelength emission maps different CRR stages:
         *    - Blue [O III]: Fresh shock excitation (high C)
         *    - Red Hα: Shock front collisions (δ events)
         *    - Green [S II]: Cooling/regeneration zone
         */
        const VEIL = {
            distance_ly: 2400,
            diameter_ly: 130,
            radius_ly: 65,
            age_years: 20000,
            progenitor_mass_solar: 20,
            shock_velocity_km_hr: 1.5e6,  // 1.5 million km/hr
            shock_velocity_km_s: 417,     // ~417 km/s
            expansion_velocity_km_s: 170, // Current shell expansion
            filament_thickness_ly: 0.003, // 1/50,000 of radius
            angular_diameter_deg: 3,      // ~6 full moons
            
            // Emission wavelengths (nm)
            H_alpha: 656.3,    // Hydrogen
            O_III: 500.7,      // Doubly ionized oxygen
            S_II: 672.4,       // Singly ionized sulfur
            
            // Colors for rendering (based on emission lines)
            colors: {
                hydrogen: { r: 255, g: 90, b: 122 },   // Red
                oxygen: { r: 90, g: 170, b: 255 },     // Blue
                sulfur: { r: 122, g: 255, b: 154 }     // Green
            }
        };
        
        const LY_TO_KM = 9.461e12;
        const VEIL_RADIUS_KM = VEIL.radius_ly * LY_TO_KM;
        
        // ════════════════════════════════════════════════════════════════════════════════
        // SECTION 3: VISUAL RENDERING STATE
        // ════════════════════════════════════════════════════════════════════════════════
        const canvas = document.getElementById('nebula-canvas');
        const ctx = canvas.getContext('2d');
        
        let startTime = Date.now();
        let zoomLevel = 0;
        let targetZoom = 0;
        let lastFrameTime = 0;
        
        // CRR State Counters
        let displayRuptures = 0;
        let shockRuptures = 0;
        let rtCycles = 0;
        let recombinationCycles = 0;
        let sessionCoherence = 0;
        let currentBrightness = 1.0;
        
        // Filament state
        let filaments = [];
        const NUM_FILAMENTS = 80;
        
        // Knot state (dense regions)
        let knots = [];
        const NUM_KNOTS = 25;
        
        // Shock wave particles
        let shockParticles = [];
        const NUM_SHOCK_PARTICLES = 60;
        
        // ════════════════════════════════════════════════════════════════════════════════
        // SECTION 4: FILAMENT GENERATION (SHOCK FRONT GEOMETRY)
        // ════════════════════════════════════════════════════════════════════════════════
        
        /**
         * @CRR_SYSTEM: Filament Dynamics
         * 
         * Filaments in SNRs are the visible manifestation of CRR's δ-surface:
         * 
         * PHYSICS: The shock wave is incredibly thin (~1/50,000 of radius).
         * We only see it when viewing EDGE-ON (like seeing a soap bubble's edge).
         * 
         * CRR INTERPRETATION:
         * - Each filament is a line of δ-events where shock meets ISM
         * - The "rope-like" appearance = multiple overlapping shock surfaces
         * - Brightness variations = density variations in ISM (varying L)
         * 
         * SYMMETRY:
         * - Shock passage itself is Z₂ (binary: shocked/unshocked)
         * - Filament undulation is SO(2) (continuous wave-like motion)
         */
        function initFilaments() {
            filaments = [];
            
            // Main diagonal filament band (like in the Hubble image)
            for (let i = 0; i < NUM_FILAMENTS; i++) {
                const baseAngle = Math.PI * 0.3 + (Math.random() - 0.5) * 0.8;
                const spread = Math.random() * 0.4 - 0.2;
                
                filaments.push({
                    // Position along the main band
                    startAngle: baseAngle + spread,
                    length: 0.3 + Math.random() * 0.5,
                    width: 0.5 + Math.random() * 2,
                    
                    // Radial position (shell structure)
                    innerRadius: 0.7 + Math.random() * 0.15,
                    outerRadius: 0.85 + Math.random() * 0.15,
                    
                    // Emission type determines color
                    // Fresh shock = oxygen (blue), older = hydrogen (red), cooled = sulfur (green)
                    emissionType: Math.random() < 0.3 ? 'oxygen' : 
                                  (Math.random() < 0.6 ? 'hydrogen' : 'sulfur'),
                    
                    // CRR phase tracking
                    phase: Math.random() * Math.PI * 2,
                    speed: 0.001 + Math.random() * 0.002,
                    brightness: 0.4 + Math.random() * 0.6,
                    
                    // Undulation (wave-like shape)
                    undulationFreq: 2 + Math.random() * 4,
                    undulationAmp: 0.02 + Math.random() * 0.04,
                    undulationPhase: Math.random() * Math.PI * 2
                });
            }
            
            // Add secondary diagonal band
            for (let i = 0; i < NUM_FILAMENTS / 2; i++) {
                const baseAngle = Math.PI * 1.1 + (Math.random() - 0.5) * 0.6;
                
                filaments.push({
                    startAngle: baseAngle,
                    length: 0.2 + Math.random() * 0.4,
                    width: 0.3 + Math.random() * 1.5,
                    innerRadius: 0.6 + Math.random() * 0.2,
                    outerRadius: 0.75 + Math.random() * 0.15,
                    emissionType: Math.random() < 0.4 ? 'oxygen' : 
                                  (Math.random() < 0.5 ? 'hydrogen' : 'sulfur'),
                    phase: Math.random() * Math.PI * 2,
                    speed: 0.0005 + Math.random() * 0.001,
                    brightness: 0.3 + Math.random() * 0.5,
                    undulationFreq: 3 + Math.random() * 3,
                    undulationAmp: 0.01 + Math.random() * 0.03,
                    undulationPhase: Math.random() * Math.PI * 2
                });
            }
        }
        
        /**
         * @CRR_SYSTEM: Dense Knots
         * 
         * Knots are regions where the shock has encountered denser ISM material.
         * In CRR terms: regions with higher L (living/coherence accumulation rate)
         */
        function initKnots() {
            knots = [];
            for (let i = 0; i < NUM_KNOTS; i++) {
                knots.push({
                    angle: Math.random() * Math.PI * 2,
                    radius: 0.5 + Math.random() * 0.4,
                    size: 0.02 + Math.random() * 0.04,
                    brightness: 0.5 + Math.random() * 0.5,
                    emissionType: ['hydrogen', 'oxygen', 'sulfur'][Math.floor(Math.random() * 3)],
                    pulsePhase: Math.random() * Math.PI * 2,
                    pulseSpeed: 0.5 + Math.random() * 1
                });
            }
        }
        
        /**
         * @CRR_SYSTEM: Shock Wave Particles
         * 
         * Visual representation of the ongoing shock-ISM interaction.
         * Each particle represents a micro-δ event at the shock front.
         */
        function initShockParticles() {
            shockParticles = [];
            for (let i = 0; i < NUM_SHOCK_PARTICLES; i++) {
                shockParticles.push({
                    angle: Math.random() * Math.PI * 2,
                    radius: 0.75 + Math.random() * 0.2,
                    speed: 0.0005 + Math.random() * 0.001,
                    size: 1 + Math.random() * 2,
                    brightness: Math.random(),
                    trail: []
                });
            }
        }
        
        function createStarField() {
            const field = document.getElementById('starField');
            for (let i = 0; i < 80; i++) {
                const star = document.createElement('div');
                star.className = 'background-star';
                star.style.left = Math.random() * 100 + '%';
                star.style.top = Math.random() * 100 + '%';
                const size = Math.random() * 1.5 + 0.5;
                star.style.width = size + 'px';
                star.style.height = size + 'px';
                star.style.opacity = Math.random() * 0.5 + 0.1;
                field.appendChild(star);
            }
        }
        
        // ════════════════════════════════════════════════════════════════════════════════
        // SECTION 5: FILAMENT RENDERING
        // ════════════════════════════════════════════════════════════════════════════════
        
        /**
         * @CRR_FUNCTION: drawFilament
         * 
         * Renders a single filament with proper emission coloring and undulation.
         * 
         * The filament's brightness variation models the CRR memory function:
         *   brightness(t) ∝ exp(C/Ω) where C varies along the filament
         *   representing different amounts of accumulated shock history.
         */
        function drawFilament(fil, cx, cy, maxRadius, t, zoomFactor) {
            const color = VEIL.colors[fil.emissionType];
            const segments = 30;
            
            ctx.save();
            
            // Update phase (SO(2) continuous evolution)
            fil.phase += fil.speed;
            fil.undulationPhase += fil.speed * 2;
            
            ctx.beginPath();
            
            for (let i = 0; i <= segments; i++) {
                const frac = i / segments;
                const angle = fil.startAngle + frac * fil.length;
                
                // Undulation (wave-like distortion)
                const undulation = Math.sin(frac * fil.undulationFreq * Math.PI + fil.undulationPhase) 
                                   * fil.undulationAmp;
                
                // Radial position with undulation
                const r = (fil.innerRadius + (fil.outerRadius - fil.innerRadius) * 
                          (0.5 + 0.5 * Math.sin(frac * Math.PI))) + undulation;
                
                const x = cx + Math.cos(angle) * r * maxRadius;
                const y = cy + Math.sin(angle) * r * maxRadius;
                
                if (i === 0) {
                    ctx.moveTo(x, y);
                } else {
                    ctx.lineTo(x, y);
                }
            }
            
            // Brightness varies with CRR phase
            const phaseBrightness = 0.7 + 0.3 * Math.sin(fil.phase);
            const alpha = fil.brightness * phaseBrightness * (0.6 + zoomFactor * 0.4);
            
            ctx.strokeStyle = `rgba(${color.r}, ${color.g}, ${color.b}, ${alpha})`;
            ctx.lineWidth = fil.width * (0.5 + zoomFactor * 1.5);
            ctx.lineCap = 'round';
            ctx.stroke();
            
            // Add glow for brighter filaments
            if (fil.brightness > 0.7) {
                ctx.strokeStyle = `rgba(${color.r}, ${color.g}, ${color.b}, ${alpha * 0.3})`;
                ctx.lineWidth = fil.width * (2 + zoomFactor * 3);
                ctx.stroke();
            }
            
            ctx.restore();
        }
        
        /**
         * @CRR_FUNCTION: drawKnot
         * 
         * Renders dense emission knots — regions of enhanced CRR activity
         */
        function drawKnot(knot, cx, cy, maxRadius, t, zoomFactor) {
            const color = VEIL.colors[knot.emissionType];
            
            // Pulsing brightness (CRR oscillation)
            knot.pulsePhase += knot.pulseSpeed * 0.02;
            const pulse = 0.6 + 0.4 * Math.sin(knot.pulsePhase);
            
            const x = cx + Math.cos(knot.angle) * knot.radius * maxRadius;
            const y = cy + Math.sin(knot.angle) * knot.radius * maxRadius;
            const size = knot.size * maxRadius * (0.8 + zoomFactor * 0.4);
            
            // Glow layers
            const gradient = ctx.createRadialGradient(x, y, 0, x, y, size * 2);
            gradient.addColorStop(0, `rgba(${color.r}, ${color.g}, ${color.b}, ${knot.brightness * pulse * 0.8})`);
            gradient.addColorStop(0.3, `rgba(${color.r}, ${color.g}, ${color.b}, ${knot.brightness * pulse * 0.4})`);
            gradient.addColorStop(1, 'rgba(0, 0, 0, 0)');
            
            ctx.fillStyle = gradient;
            ctx.beginPath();
            ctx.arc(x, y, size * 2, 0, Math.PI * 2);
            ctx.fill();
        }
        
        /**
         * @CRR_FUNCTION: drawShockParticle
         * 
         * Renders individual shock interaction events at the remnant boundary
         */
        function drawShockParticle(particle, cx, cy, maxRadius, t) {
            // Outward motion (expansion)
            particle.radius += particle.speed;
            if (particle.radius > 0.98) {
                particle.radius = 0.75 + Math.random() * 0.1;
                particle.angle = Math.random() * Math.PI * 2;
            }
            
            const x = cx + Math.cos(particle.angle) * particle.radius * maxRadius;
            const y = cy + Math.sin(particle.angle) * particle.radius * maxRadius;
            
            // Flicker (Z₂ on/off dynamics)
            const flicker = Math.random() > 0.3 ? 1 : 0.3;
            
            ctx.fillStyle = `rgba(255, 200, 220, ${particle.brightness * flicker * 0.6})`;
            ctx.beginPath();
            ctx.arc(x, y, particle.size, 0, Math.PI * 2);
            ctx.fill();
        }
        
        // ════════════════════════════════════════════════════════════════════════════════
        // SECTION 6: MAIN RENDERING
        // ════════════════════════════════════════════════════════════════════════════════
        
        /**
         * @CRR_FUNCTION: drawVeilNebula
         * 
         * Main rendering function implementing multi-scale CRR visualization:
         * 
         * SCALE HIERARCHY:
         * - Macro: Overall shell expansion (SO(2) self-similar)
         * - Meso: Filament structure (mixed Z₂/SO(2))
         * - Micro: Shock particle events (Z₂ binary)
         */
        function drawVeilNebula(brightness, t) {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            const cx = canvas.width / 2;
            const cy = canvas.height / 2;
            const zoomFactor = Math.pow(zoomLevel / 100, 1.5);
            
            // Base radius scales with zoom
            const baseRadius = 30;
            const maxRadius = 170;
            const apparentRadius = baseRadius + (maxRadius - baseRadius) * zoomFactor;
            
            // Draw different detail levels based on zoom
            if (zoomFactor < 0.15) {
                drawDistantNebula(cx, cy, apparentRadius, brightness, t, zoomFactor);
            } else if (zoomFactor < 0.5) {
                drawApproachingNebula(cx, cy, apparentRadius, brightness, t, zoomFactor);
            } else {
                drawCloseNebula(cx, cy, apparentRadius, brightness, t, zoomFactor);
            }
        }
        
        function drawDistantNebula(cx, cy, radius, brightness, t, zoomFactor) {
            // Distant view: diffuse glow with hints of structure
            
            // Overall nebula glow
            const gradient = ctx.createRadialGradient(cx, cy, 0, cx, cy, radius * 1.5);
            gradient.addColorStop(0, `rgba(180, 120, 200, ${0.1 * brightness})`);
            gradient.addColorStop(0.3, `rgba(150, 100, 180, ${0.08 * brightness})`);
            gradient.addColorStop(0.6, `rgba(100, 80, 150, ${0.04 * brightness})`);
            gradient.addColorStop(1, 'rgba(0, 0, 0, 0)');
            
            ctx.fillStyle = gradient;
            ctx.beginPath();
            ctx.arc(cx, cy, radius * 1.5, 0, Math.PI * 2);
            ctx.fill();
            
            // Hint of filamentary structure
            ctx.save();
            ctx.globalAlpha = 0.3 + zoomFactor * 2;
            
            filaments.slice(0, 20).forEach(fil => {
                drawFilament(fil, cx, cy, radius, t, zoomFactor);
            });
            
            ctx.restore();
        }
        
        function drawApproachingNebula(cx, cy, radius, brightness, t, zoomFactor) {
            // Mid-range: filaments becoming visible
            
            // Background glow
            const gradient = ctx.createRadialGradient(cx, cy, 0, cx, cy, radius * 1.2);
            gradient.addColorStop(0, `rgba(100, 60, 120, ${0.15 * brightness})`);
            gradient.addColorStop(0.4, `rgba(80, 50, 100, ${0.1 * brightness})`);
            gradient.addColorStop(1, 'rgba(0, 0, 0, 0)');
            
            ctx.fillStyle = gradient;
            ctx.beginPath();
            ctx.arc(cx, cy, radius * 1.2, 0, Math.PI * 2);
            ctx.fill();
            
            // Draw filaments
            filaments.forEach(fil => {
                drawFilament(fil, cx, cy, radius, t, zoomFactor);
            });
            
            // Draw some knots
            knots.slice(0, Math.floor(NUM_KNOTS * zoomFactor * 2)).forEach(knot => {
                drawKnot(knot, cx, cy, radius, t, zoomFactor);
            });
        }
        
        function drawCloseNebula(cx, cy, radius, brightness, t, zoomFactor) {
            // Close view: full detail
            
            // Subtle background
            const gradient = ctx.createRadialGradient(cx, cy, 0, cx, cy, radius);
            gradient.addColorStop(0, `rgba(50, 30, 60, ${0.1 * brightness})`);
            gradient.addColorStop(1, 'rgba(0, 0, 0, 0)');
            
            ctx.fillStyle = gradient;
            ctx.beginPath();
            ctx.arc(cx, cy, radius, 0, Math.PI * 2);
            ctx.fill();
            
            // All filaments with full detail
            filaments.forEach(fil => {
                drawFilament(fil, cx, cy, radius, t, zoomFactor);
            });
            
            // All knots
            knots.forEach(knot => {
                drawKnot(knot, cx, cy, radius, t, zoomFactor);
            });
            
            // Shock particles at high zoom
            if (zoomFactor > 0.7) {
                shockParticles.forEach(particle => {
                    drawShockParticle(particle, cx, cy, radius, t);
                });
            }
            
            // Add wispy diffuse emission
            drawDiffuseEmission(cx, cy, radius, t, zoomFactor);
        }
        
        function drawDiffuseEmission(cx, cy, radius, t, zoomFactor) {
            // Face-on shock emission (diffuse regions)
            ctx.save();
            ctx.globalAlpha = 0.15 * zoomFactor;
            
            for (let i = 0; i < 15; i++) {
                const angle = (i / 15) * Math.PI * 2 + t * 0.0001;
                const r = 0.4 + Math.sin(i * 2.3 + t * 0.001) * 0.2;
                const x = cx + Math.cos(angle) * r * radius;
                const y = cy + Math.sin(angle) * r * radius;
                const size = (0.1 + Math.sin(i * 1.7) * 0.05) * radius;
                
                const emissionType = ['hydrogen', 'oxygen', 'sulfur'][i % 3];
                const color = VEIL.colors[emissionType];
                
                const grad = ctx.createRadialGradient(x, y, 0, x, y, size);
                grad.addColorStop(0, `rgba(${color.r}, ${color.g}, ${color.b}, 0.3)`);
                grad.addColorStop(0.5, `rgba(${color.r}, ${color.g}, ${color.b}, 0.1)`);
                grad.addColorStop(1, 'rgba(0, 0, 0, 0)');
                
                ctx.fillStyle = grad;
                ctx.beginPath();
                ctx.arc(x, y, size, 0, Math.PI * 2);
                ctx.fill();
            }
            
            ctx.restore();
        }
        
        // ════════════════════════════════════════════════════════════════════════════════
        // SECTION 7: ZOOM & DISTANCE
        // ════════════════════════════════════════════════════════════════════════════════
        
        function getApparentDistance(zoom) {
            const minDist = VEIL.radius_ly * 0.1 * LY_TO_KM;
            const maxDist = VEIL.distance_ly * LY_TO_KM;
            const zoomFactor = Math.pow(zoom / 100, 2);
            return maxDist * Math.pow(minDist / maxDist, zoomFactor);
        }
        
        function formatDistance(distanceKm) {
            const ly = distanceKm / LY_TO_KM;
            
            if (ly > 100) return Math.floor(ly).toLocaleString() + ' ly';
            if (ly > 10) return ly.toFixed(1) + ' ly';
            if (ly > 1) return ly.toFixed(2) + ' ly';
            return (ly * 365.25 * 24).toFixed(0) + ' light-hours';
        }
        
        function getZoomLabel(zoom) {
            if (zoom < 10) return 'Earth View';
            if (zoom < 25) return 'Telescope';
            if (zoom < 45) return 'Approaching';
            if (zoom < 65) return 'Shell Edge';
            if (zoom < 85) return 'Filament Detail';
            return 'Shock Front';
        }
        
        function updateZoomDisplay() {
            const distance = getApparentDistance(zoomLevel);
            document.getElementById('distance-display').textContent = formatDistance(distance);
            document.getElementById('zoom-label').textContent = getZoomLabel(zoomLevel);
            document.getElementById('zoom-slider').value = zoomLevel;
        }
        
        // ════════════════════════════════════════════════════════════════════════════════
        // SECTION 8: CRR CALCULATIONS
        // ════════════════════════════════════════════════════════════════════════════════
        
        function updateDisplays() {
            document.getElementById('display-ruptures').textContent = displayRuptures.toLocaleString();
            document.getElementById('shock-ruptures').textContent = shockRuptures.toLocaleString();
            document.getElementById('rt-cycles').textContent = rtCycles.toLocaleString();
            document.getElementById('recombination-cycles').textContent = recombinationCycles.toLocaleString();
            document.getElementById('current-brightness').textContent = (currentBrightness * 100).toFixed(1) + '%';
            document.getElementById('session-coherence').textContent = sessionCoherence.toFixed(2);
            
            document.getElementById('coherence-live').textContent = sessionCoherence.toFixed(4);
            
            // Memory weight using SO(2) Ω (continuous expansion dynamics)
            const memWeight = Math.exp(Math.min(sessionCoherence / OMEGA_SO2, 10));
            document.getElementById('memory-weight').textContent = memWeight.toFixed(4);
            
            document.getElementById('rupture-count').textContent = 
                (displayRuptures + shockRuptures + rtCycles + recombinationCycles).toLocaleString();
        }
        
        // ════════════════════════════════════════════════════════════════════════════════
        // SECTION 9: MAIN ANIMATION LOOP
        // ════════════════════════════════════════════════════════════════════════════════
        
        function animate(timestamp) {
            const t = (Date.now() - startTime) / 1000;
            const dt = timestamp - (lastFrameTime || timestamp);
            lastFrameTime = timestamp;
            
            // Smooth zoom
            zoomLevel += (targetZoom - zoomLevel) * 0.06;
            updateZoomDisplay();
            
            const zoomFactor = Math.pow(zoomLevel / 100, 1.5);
            
            // CRR accumulation
            sessionCoherence += dt / 1000;
            displayRuptures = Math.floor(t / TAU_DISPLAY);
            shockRuptures = Math.floor(t / TAU_SHOCK);
            rtCycles = Math.floor(t / TAU_RT);
            recombinationCycles = Math.floor(t / TAU_RECOMB);
            
            // Brightness variation (slower than star, more subtle)
            currentBrightness = 0.9 + 0.1 * Math.sin(t * 0.5);
            
            // Render
            drawVeilNebula(currentBrightness, t);
            
            // Update displays
            updateDisplays();
            
            requestAnimationFrame(animate);
        }
        
        // ════════════════════════════════════════════════════════════════════════════════
        // SECTION 10: CONTROLS
        // ════════════════════════════════════════════════════════════════════════════════
        
        function setupControls() {
            const slider = document.getElementById('zoom-slider');
            const zoomIn = document.getElementById('zoom-in');
            const zoomOut = document.getElementById('zoom-out');
            
            slider.addEventListener('input', (e) => {
                targetZoom = parseFloat(e.target.value);
            });
            
            zoomIn.addEventListener('click', () => {
                targetZoom = Math.min(100, targetZoom + 10);
            });
            
            zoomOut.addEventListener('click', () => {
                targetZoom = Math.max(0, targetZoom - 10);
            });
            
            // Keyboard
            document.addEventListener('keydown', (e) => {
                if (e.key === 'ArrowUp' || e.key === '=') {
                    targetZoom = Math.min(100, targetZoom + 5);
                } else if (e.key === 'ArrowDown' || e.key === '-') {
                    targetZoom = Math.max(0, targetZoom - 5);
                } else if (e.key === 'Home') {
                    targetZoom = 0;
                } else if (e.key === 'End') {
                    targetZoom = 100;
                }
            });
            
            // Mouse wheel
            canvas.addEventListener('wheel', (e) => {
                e.preventDefault();
                const delta = e.deltaY > 0 ? -5 : 5;
                targetZoom = Math.max(0, Math.min(100, targetZoom + delta));
            });
        }
        
        // ════════════════════════════════════════════════════════════════════════════════
        // SECTION 11: INITIALIZATION
        // ════════════════════════════════════════════════════════════════════════════════
        
        function init() {
            createStarField();
            initFilaments();
            initKnots();
            initShockParticles();
            setupControls();
            
            // Hide loading screen
            setTimeout(() => {
                document.getElementById('loading').classList.add('hidden');
            }, 1200);
            
            requestAnimationFrame(animate);
            
            console.log('CRR Supernova Remnant initialized');
            console.log('Veil Nebula: The ultimate CRR cycle - stellar death to cosmic regeneration');
        }
        
        init();
    </script>
</body>
</html>
