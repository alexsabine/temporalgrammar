<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mathematical Life - Cohere.org.uk - Mathematical Life and Living Systems</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.min.js"></script>
    <script>
        MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                displayMath: [['$$', '$$'], ['\\[', '\\]']]
            },
            svg: { fontCache: 'global' }
        };
    </script>
    <style>
        /* Base Reset */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 50%, #f5f6f8 100%);
            font-family: Georgia, serif;
            line-height: 1.6;
            color: #2c2c2c;
            overflow-x: hidden;
        }

        /* Main Container */
        .page-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 60px;
        }

        /* Header Section */
        .header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 40px 0;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
            position: relative;
            z-index: 100;
        }

        .logo-section {
            display: flex;
            align-items: center;
        }

        .logo {
            width: 60px;
            height: 60px;
            margin-right: 20px;
            cursor: pointer;
            transition: transform 0.3s ease;
        }

        .logo:hover {
            transform: scale(1.1);
        }

        .title-group {
            display: flex;
            flex-direction: column;
        }

        .site-title {
            font-family: Georgia, serif;
            font-size: 48px;
            font-weight: normal;
            color: #1a1a1a;
            letter-spacing: -0.5px;
            margin-bottom: 5px;
        }

        .strapline {
            font-family: Georgia, serif;
            font-size: 18px;
            font-style: italic;
            color: #6c757d;
            letter-spacing: 0.5px;
        }

        /* Navigation System */
        .main-nav {
            display: flex;
            align-items: center;
            gap: 40px;
        }

        .nav-item {
            position: relative;
        }

        .nav-link {
            font-family: Georgia, serif;
            font-size: 18px;
            font-weight: normal;
            color: #495057;
            text-decoration: none;
            padding: 12px 20px;
            border-radius: 4px;
            transition: all 0.3s ease;
            position: relative;
            display: flex;
            align-items: center;
            gap: 8px;
            white-space: nowrap;
        }

        .nav-link:hover {
            background: rgba(74, 144, 226, 0.08);
            color: #1a1a1a;
            transform: translateY(-2px);
        }

        .nav-link.active {
            background: #4a90e2;
            color: white;
        }

        .dropdown-arrow {
            font-size: 12px;
            transition: transform 0.3s ease;
        }

        .nav-item:hover .dropdown-arrow {
            transform: rotate(180deg);
        }

        /* Dropdown Menu System */
        .dropdown-menu {
            position: absolute;
            top: 100%;
            left: 0;
            background: white;
            min-width: 220px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.12);
            border: 1px solid rgba(0, 0, 0, 0.08);
            border-radius: 8px;
            padding: 8px 0;
            opacity: 0;
            visibility: hidden;
            transform: translateY(-8px);
            transition: all 0.25s ease;
            z-index: 1000;
            overflow: hidden;
        }

        .nav-item:hover .dropdown-menu {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }

        .dropdown-menu:hover {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }

        .nav-item::before {
            content: '';
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            height: 2px;
            background: transparent;
            z-index: 999;
        }

        .dropdown-link {
            display: block;
            padding: 12px 20px;
            color: #495057;
            text-decoration: none;
            font-size: 16px;
            font-family: Georgia, serif;
            transition: all 0.2s ease;
            border-left: 3px solid transparent;
        }

        .dropdown-link:hover {
            background: rgba(74, 144, 226, 0.08);
            color: #4a90e2;
            border-left-color: #4a90e2;
        }

        /* COHERE Memory Loom Banner */
        .cohere-banner {
            position: relative;
            height: 400px;
            margin: 40px 0;
            background: linear-gradient(135deg, #0a0f1c 0%, #1a1f3a 50%, #0f1429 100%);
            border-radius: 12px;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .loom-canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
        }

        .cohere-text {
            position: relative;
            z-index: 2;
            display: flex;
            gap: 2.5rem;
            font-size: 4rem;
            color: rgba(255, 255, 255, 0.95);
            text-shadow: 0 0 20px rgba(120, 180, 255, 0.6);
        }

        .letter {
            transition: none;
            position: relative;
        }

        .banner-controls {
            position: absolute;
            top: 15px;
            left: 15px;
            z-index: 10;
            background: rgba(11, 19, 32, 0.85);
            border: 1px solid #1f3350;
            padding: 12px;
            border-radius: 8px;
            backdrop-filter: blur(4px);
            font-size: 11px;
            color: #cfe3ff;
        }

        .banner-metrics {
            display: flex;
            gap: 12px;
            margin-bottom: 8px;
            flex-wrap: wrap;
        }

        .banner-metric {
            background: #132238;
            border: 1px solid #27456d;
            border-radius: 12px;
            padding: 3px 8px;
            font-family: 'Courier New', monospace;
            font-size: 10px;
        }

        .banner-phase-controls {
            display: flex;
            gap: 8px;
        }

        .banner-phase-btn {
            background: #132238;
            border: 1px solid #27456d;
            color: #cfe3ff;
            padding: 4px 8px;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 9px;
        }

        .banner-phase-btn:hover { background: #1f3350; }
        .banner-phase-btn.active { background: #5aa7ff; color: #0a0f1c; }

        /* Mathematical Life Examples Section */
        .examples-section {
            margin: 60px 0;
            padding: 40px;
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(0, 0, 0, 0.05);
            border-radius: 12px;
        }

        .section-title {
            font-family: Georgia, serif;
            font-size: 32px;
            font-weight: normal;
            margin-bottom: 15px;
            color: #1a1a1a;
            text-align: center;
        }

        .section-subtitle {
            font-family: Georgia, serif;
            font-size: 20px;
            font-weight: normal;
            margin-bottom: 40px;
            color: #495057;
            text-align: center;
            font-style: italic;
        }

        .examples-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 30px;
            margin-top: 30px;
        }

        .example-card {
            background: rgba(255, 255, 255, 0.9);
            padding: 30px;
            border: 1px solid rgba(0, 0, 0, 0.05);
            border-radius: 8px;
            text-align: center;
            transition: all 0.3s ease;
        }

        .example-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .example-title {
            font-family: Georgia, serif;
            font-size: 24px;
            font-weight: normal;
            margin-bottom: 15px;
            color: #1a1a1a;
        }

        .example-description {
            font-family: Georgia, serif;
            font-size: 16px;
            color: #495057;
            margin-bottom: 20px;
            line-height: 1.6;
        }

        .example-link {
            display: inline-block;
            margin: 8px 0;
            padding: 10px 20px;
            color: #4a90e2;
            text-decoration: none;
            border-radius: 4px;
            transition: all 0.3s ease;
            font-family: Georgia, serif;
            border: 1px solid rgba(74, 144, 226, 0.2);
            background: rgba(74, 144, 226, 0.02);
        }

        .example-link:hover {
            background: rgba(74, 144, 226, 0.08);
            transform: translateY(-1px);
        }

        .link-description {
            font-size: 12px;
            color: #6c757d;
            font-style: italic;
            margin-top: 4px;
        }

        .mathematical-features {
            margin-top: 25px;
            padding-top: 20px;
            border-top: 1px solid rgba(0, 0, 0, 0.1);
        }

        .feature-list {
            list-style: none;
            padding: 0;
        }

        .feature-list li {
            font-size: 14px;
            color: #6c757d;
            margin: 6px 0;
            padding-left: 20px;
            position: relative;
        }

        .feature-list li::before {
            content: "∫";
            position: absolute;
            left: 0;
            color: #4a90e2;
            font-weight: bold;
        }

        /* Logo Animation */
        .logo-hive {
            position: relative;
            overflow: visible;
        }

        .logo-bee {
            position: absolute;
            opacity: 0.8;
            transition: all 0.3s ease;
        }

        .logo-interior {
            opacity: 0;
            transition: opacity 0.5s ease;
        }

        .logo:hover .logo-interior {
            opacity: 1;
        }

        .logo:hover .logo-bee {
            opacity: 0.3;
        }

        .logo-hive.rupture {
            animation: hiveGlow 3s ease-out;
        }

        @keyframes hiveGlow {
            0% { filter: drop-shadow(0 0 0 rgba(74, 144, 226, 0)); }
            20% { filter: drop-shadow(0 0 20px rgba(74, 144, 226, 0.6)); }
            40% { filter: drop-shadow(0 0 30px rgba(74, 144, 226, 0.4)); }
            70% { filter: drop-shadow(0 0 15px rgba(74, 144, 226, 0.3)); }
            100% { filter: drop-shadow(0 0 0 rgba(74, 144, 226, 0)); }
        }

        /* Footer */
        .footer {
            background: rgba(245, 246, 248, 0.9);
            backdrop-filter: blur(10px);
            border-top: 1px solid rgba(0, 0, 0, 0.05);
            padding: 50px 0 40px;
            text-align: center;
            margin-top: 80px;
        }

        .footer-content {
            max-width: 1000px;
            margin: 0 auto;
        }

        .copyright {
            font-family: Georgia, serif;
            font-size: 16px;
            color: #1a1a1a;
            margin-bottom: 15px;
            line-height: 1.5;
        }

        .footer-tech-note {
            font-family: Georgia, serif;
            font-size: 14px;
            color: #6c757d;
            font-style: italic;
            line-height: 1.4;
        }

        /* Responsive Design */
        @media (max-width: 1024px) {
            .examples-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .page-container {
                padding: 0 30px;
            }

            .header {
                flex-direction: column;
                gap: 30px;
                text-align: center;
                padding: 30px 0;
            }

            .logo-section {
                flex-direction: column;
                gap: 15px;
            }

            .logo {
                margin-right: 0;
            }

            .site-title {
                font-size: 36px;
            }

            .main-nav {
                flex-wrap: wrap;
                justify-content: center;
                gap: 15px;
            }

            .cohere-banner {
                height: 300px;
            }

            .cohere-text {
                font-size: 2.5rem;
                gap: 1.5rem;
            }

            .dropdown-menu {
                position: static;
                opacity: 1;
                visibility: visible;
                transform: none;
                box-shadow: none;
                border: none;
                background: rgba(74, 144, 226, 0.05);
                margin-top: 10px;
                border-radius: 4px;
                display: none;
            }

            .nav-item:hover .dropdown-menu {
                display: block;
            }
        }
    </style>
</head>
<body>
    <div class="page-container">
        <header class="header">
            <div class="logo-section">
                <svg class="logo logo-hive" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                    <defs>
                        <radialGradient id="hiveGrad" cx="50%" cy="50%" r="50%">
                            <stop offset="0%" style="stop-color:#8B4513;stop-opacity:0.9" />
                            <stop offset="70%" style="stop-color:#A0522D;stop-opacity:0.8" />
                            <stop offset="100%" style="stop-color:#654321;stop-opacity:0.7" />
                        </radialGradient>
                        <radialGradient id="honeyGrad" cx="50%" cy="50%" r="40%">
                            <stop offset="0%" style="stop-color:#FFD700;stop-opacity:0.8" />
                            <stop offset="100%" style="stop-color:#FFA500;stop-opacity:0.6" />
                        </radialGradient>
                    </defs>
                    
                    <ellipse cx="50" cy="55" rx="25" ry="30" fill="url(#hiveGrad)" stroke="#654321" stroke-width="1"/>
                    <ellipse cx="50" cy="75" rx="6" ry="8" fill="#3D2F1F"/>
                    
                    <path d="M30 40 Q50 38 70 40" stroke="#654321" stroke-width="1" fill="none" opacity="0.7"/>
                    <path d="M32 50 Q50 48 68 50" stroke="#654321" stroke-width="1" fill="none" opacity="0.7"/>
                    <path d="M34 60 Q50 58 66 60" stroke="#654321" stroke-width="1" fill="none" opacity="0.7"/>
                    
                    <g class="logo-interior">
                        <polygon points="45,45 47,43 52,43 54,45 52,47 47,47" fill="url(#honeyGrad)" opacity="0.8"/>
                        <polygon points="52,45 54,43 59,43 61,45 59,47 54,47" fill="url(#honeyGrad)" opacity="0.7"/>
                        <polygon points="38,45 40,43 45,43 47,45 45,47 40,47" fill="url(#honeyGrad)" opacity="0.9"/>
                        <polygon points="41,53 43,51 48,51 50,53 48,55 43,55" fill="url(#honeyGrad)" opacity="0.8"/>
                        <polygon points="48,53 50,51 55,51 57,53 55,55 50,55" fill="url(#honeyGrad)" opacity="0.7"/>
                        
                        <ellipse class="interior-bee-1" cx="46" cy="46" rx="2" ry="1.5" fill="#FFD700" opacity="0.8"/>
                        <ellipse class="interior-bee-2" cx="53" cy="52" rx="2" ry="1.5" fill="#FFD700" opacity="0.9"/>
                    </g>
                    
                    <g class="logo-bee bee-1">
                        <ellipse cx="25" cy="35" rx="3" ry="2" fill="#FFD700"/>
                        <ellipse cx="24" cy="35" rx="1.5" ry="1" fill="#000000"/>
                        <ellipse cx="26" cy="33" rx="2" ry="1" fill="rgba(255,255,255,0.7)"/>
                        <ellipse cx="26" cy="37" rx="2" ry="1" fill="rgba(255,255,255,0.7)"/>
                    </g>
                    
                    <g class="logo-bee bee-2">
                        <ellipse cx="75" cy="45" rx="3" ry="2" fill="#FFD700"/>
                        <ellipse cx="74" cy="45" rx="1.5" ry="1" fill="#000000"/>
                        <ellipse cx="76" cy="43" rx="2" ry="1" fill="rgba(255,255,255,0.7)"/>
                        <ellipse cx="76" cy="47" rx="2" ry="1" fill="rgba(255,255,255,0.7)"/>
                    </g>
                    
                    <g class="logo-bee bee-3">
                        <ellipse cx="40" cy="25" rx="3" ry="2" fill="#FFD700"/>
                        <ellipse cx="39" cy="25" rx="1.5" ry="1" fill="#000000"/>
                        <ellipse cx="41" cy="23" rx="2" ry="1" fill="rgba(255,255,255,0.7)"/>
                        <ellipse cx="41" cy="27" rx="2" ry="1" fill="rgba(255,255,255,0.7)"/>
                    </g>
                    
                    <g class="logo-bee bee-4">
                        <ellipse cx="65" cy="25" rx="3" ry="2" fill="#FFD700"/>
                        <ellipse cx="64" cy="25" rx="1.5" ry="1" fill="#000000"/>
                        <ellipse cx="66" cy="23" rx="2" ry="1" fill="rgba(255,255,255,0.7)"/>
                        <ellipse cx="66" cy="27" rx="2" ry="1" fill="rgba(255,255,255,0.7)"/>
                    </g>
                </svg>
                
                <div class="title-group">
                    <h1 class="site-title">Cohere.org.uk</h1>
                    <p class="strapline">A Temporal Grammar</p>
                </div>
            </div>

            <nav class="main-nav">
                <div class="nav-item">
                    <a href="index.html" class="nav-link">Home</a>
                </div>
                <div class="nav-item">
                    <a href="crr-simulations.html" class="nav-link">
                        CRR Simulations
                        <span class="dropdown-arrow">▼</span>
                    </a>
                    <div class="dropdown-menu">
                        <a href="biological-systems.html" class="dropdown-link">Biological Systems</a>
                        <a href="physical-systems.html" class="dropdown-link">Physical Systems</a>
                        <a href="mathematical-life.html" class="dropdown-link">Mathematical Life</a>
                    </div>
                </div>
                <div class="nav-item">
                    <a href="crr-benchmarks.html" class="nav-link">CRR Benchmarks</a>
                </div>
                <div class="nav-item">
                    <a href="crr-explained.html" class="nav-link">CRR Explained</a>
                </div>
                <div class="nav-item">
                    <a href="about.html" class="nav-link">About</a>
                </div>
            </nav>
        </header>

        <main>
            <!-- COHERE Memory Loom Banner -->
            <section class="cohere-banner">
                <canvas class="loom-canvas" id="loomCanvas"></canvas>
                
                <div class="cohere-text">
                    <div class="letter" id="C">$$C$$</div>
                    <div class="letter" id="O">$$O$$</div>
                    <div class="letter" id="H">$$H$$</div>
                    <div class="letter" id="E1">$$E$$</div>
                    <div class="letter" id="R">$$R$$</div>
                    <div class="letter" id="E2">$$E$$</div>
                </div>

                <div class="banner-controls">
                    <div class="banner-metrics">
                        <div class="banner-metric">C: <span id="cVal">0.00</span></div>
                        <div class="banner-metric">δ: <span id="dVal">0</span></div>
                        <div class="banner-metric">R: <span id="rVal">0.00</span></div>
                    </div>
                    <div class="banner-phase-controls">
                        <button class="banner-phase-btn active" onclick="setPhase('coherence')">C</button>
                        <button class="banner-phase-btn" onclick="setPhase('rupture')">δ</button>
                        <button class="banner-phase-btn" onclick="setPhase('rebirth')">R</button>
                    </div>
                </div>
            </section>

            <!-- CRR Guides Section -->
            <section class="examples-section">
                <h2 class="section-title">CRR Mathematical Foundations: Practical Guides</h2>
                <p class="section-subtitle">Understanding how Coherence-Rupture-Regeneration principles apply across domains</p>
                
                <div style="font-family: Georgia, serif; font-size: 16px; line-height: 1.8; color: #495057; margin: 30px 0 40px 0; text-align: left;">
                    <p style="margin-bottom: 15px;">
                        Here we provide a basic quick-guide and more advanced guide that provide some explanations for how CRR principles apply to different domains, starting with a Philosophical Foundations tab, and then applying CRR mathematics to some specific domains. The aim of these guides is to provide a more generic explainer for how the underpinning principles used to build each of the mathematical simulations on this site.
                    </p>
                    <p style="margin-bottom: 15px;">
                        We welcome further conjecture, critique and contributions from mathematicians in dynamical systems theory, physics, biology and other domains where they might be finding similar CRR principles that underpin the more microscopic and detailed expert-level applications in their domains.
                    </p>
                    <p style="margin-bottom: 0;">
                        In an age of rapidly developing technology and converging crises, we think it is important to find universal languages to enable human beings to better discuss core principles in separate domains, sharing coherence between systems to manage the ongoing learning process without risking fragility and catastrophic rupture. We wonder whether CRR might present a unifying framework to enable even better communication between individuals working in separate paradigms.
                    </p>
                </div>
                
                <div class="examples-grid">
                    <div class="example-card" style="border-radius: 0; border: 1px solid #000000;">
                        <h3 class="example-title">Quick Guide: CRR for Everyone</h3>
                        <p class="example-description">
                            A simplified introduction to the Coherence-Rupture-Regeneration framework. Explores how we remember, break, and rebuild through life, with accessible explanations of the three-part temporal structure and practical examples from personal growth to learning systems.
                        </p>
                        
                        <a href="maths_q.html" target="_blank" class="example-link" style="border-radius: 0; border: 1px solid rgba(74, 144, 226, 0.2);">
                            View Quick Guide
                            <div class="link-description">Accessible introduction with everyday examples</div>
                        </a>
                    </div>

                    <div class="example-card" style="border-radius: 0; border: 1px solid #000000;">
                        <h3 class="example-title">Advanced Guide: Mathematical Foundations</h3>
                        <p class="example-description">
                            Comprehensive mathematical formalism for CRR across domains. Detailed exploration of the philosophical foundations, core mathematics, connections to Free Energy Principle, Catastrophe Theory, Machine Learning applications, and memory signature analysis.
                        </p>
                        
                        <a href="Maths.html" target="_blank" class="example-link" style="border-radius: 0; border: 1px solid rgba(74, 144, 226, 0.2);">
                            View Advanced Guide
                            <div class="link-description">Detailed mathematical treatment for researchers</div>
                        </a>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <footer class="footer">
        <div class="page-container">
            <div class="footer-content">
                <p class="copyright">
                    <strong>Copyright Protected © Alexander Sabine (alexander@cohere.org.uk) Patent Pending with European Patent Office: 25196496.1</strong>
                </p>
                <p class="footer-tech-note">
                    Note: These mathematical life simulations utilise HTML5, WebGL2, and advanced JavaScript. Desktop browsers recommended for optimal performance.
                </p>
            </div>
        </div>
    </footer>

    <script>
        'use strict';

        // Canvas setup for memory loom
        const canvas = document.getElementById('loomCanvas');
        const ctx = canvas.getContext('2d');
        
        function resizeCanvas() {
            const rect = canvas.getBoundingClientRect();
            const dpr = Math.min(2, window.devicePixelRatio || 1);
            canvas.width = rect.width * dpr;
            canvas.height = rect.height * dpr;
            ctx.scale(dpr, dpr);
            canvas.style.width = rect.width + 'px';
            canvas.style.height = rect.height + 'px';
        }
        resizeCanvas();
        window.addEventListener('resize', resizeCanvas);

        // CRR State
        let phase = 'coherence';
        let time = 0;
        let coherence = 0;
        let ruptureDelta = 0;
        let regeneration = 0;

        // Memory loom fabric state
        const fabric = {
            warpPhase: 0,
            weftPhase: 0,
            amplitude: 15,
            warpFreq: 0.025,
            weftFreq: 0.02,
            spacing: 10,
            tearNoise: new Array(24).fill(0)
        };

        // Letter states - ONLY MEMORY WEIGHTS, NO COORDINATES
        const letters = ['C', 'O', 'H', 'E1', 'R', 'E2'].map(id => ({
            id,
            element: document.getElementById(id),
            memoryWeights: new Array(6).fill(0).map(() => 0.1 + Math.random() * 0.1),
            opacity: 1,
            scale: 1,
            x: 0,
            y: 0,
            vx: 0,
            vy: 0,
            disrupted: false
        }));

        // Memory buffers
        const memoryHistory = [];
        const coherenceBuffer = [];

        // Multi-timescale coherence integration
        function updateCoherence(localDensity) {
            coherenceBuffer.push(localDensity);
            if (coherenceBuffer.length > 80) coherenceBuffer.shift();
            
            if (coherenceBuffer.length < 8) return coherence;
            
            const scales = [1, 4, 12, 20];
            const weights = [0.4, 0.3, 0.2, 0.1];
            let integrated = 0;
            
            scales.forEach((scale, i) => {
                const idx = Math.max(0, coherenceBuffer.length - scale);
                const avg = coherenceBuffer.slice(idx).reduce((a, b) => a + b, 0) / (coherenceBuffer.length - idx);
                integrated += weights[i] * avg;
            });
            
            coherence = 0.96 * coherence + 0.04 * integrated;
            return coherence;
        }

        // Store memory states
        function storeMemory() {
            memoryHistory.push({
                time,
                coherence,
                letters: letters.map(letter => ({
                    memoryWeights: [...letter.memoryWeights],
                    opacity: letter.opacity,
                    scale: letter.scale
                }))
            });
            if (memoryHistory.length > 100) memoryHistory.shift();
        }

        // Regeneration from memory weights only
        function regenerateLetters() {
            if (memoryHistory.length < 15) return;
            
            const Ω = 1.2;
            
            letters.forEach((letter, idx) => {
                if (!letter.disrupted) return;
                
                let targetOpacity = 0;
                let targetScale = 0;
                let totalWeight = 0;
                
                for (let i = Math.max(0, memoryHistory.length - 50); i < memoryHistory.length; i++) {
                    const mem = memoryHistory[i];
                    const timeDecay = Math.exp(-0.015 * (memoryHistory.length - i));
                    const cohWeight = Math.exp(mem.coherence / Ω);
                    const weight = timeDecay * cohWeight;
                    
                    if (mem.letters[idx]) {
                        targetOpacity += weight * mem.letters[idx].opacity;
                        targetScale += weight * mem.letters[idx].scale;
                        totalWeight += weight;
                    }
                }
                
                if (totalWeight > 0) {
                    targetOpacity /= totalWeight;
                    targetScale /= totalWeight;
                    
                    const rate = 0.025;
                    letter.opacity += rate * (targetOpacity - letter.opacity);
                    letter.scale += rate * (targetScale - letter.scale);
                    
                    letter.x *= 0.96;
                    letter.y *= 0.96;
                    letter.vx *= 0.94;
                    letter.vy *= 0.94;
                    
                    if (letter.opacity > 0.8 && letter.scale > 0.9 && Math.abs(letter.x) < 4) {
                        letter.disrupted = false;
                    }
                }
            });
            
            regeneration = Math.min(1, regeneration + 0.01);
        }

        // Draw memory loom background
        function drawLoom() {
            const rect = canvas.getBoundingClientRect();
            ctx.clearRect(0, 0, rect.width, rect.height);
            
            const centerX = rect.width / 2;
            const centerY = rect.height / 2;
            let localDensity = 0.4;
            
            // Decay tear noise
            fabric.tearNoise.forEach((_, i) => fabric.tearNoise[i] *= 0.97);
            
            // Warp threads
            const warpCount = Math.floor(rect.width / fabric.spacing);
            for (let i = -warpCount/2; i < warpCount/2; i++) {
                const x = centerX + i * fabric.spacing;
                const tearIdx = Math.abs(i) % fabric.tearNoise.length;
                const tearOffset = fabric.tearNoise[tearIdx];
                
                ctx.beginPath();
                ctx.strokeStyle = `rgba(120, 180, 255, ${0.15 + 0.25 * coherence})`;
                ctx.lineWidth = 0.8 + coherence * 0.4;
                
                for (let y = 0; y <= rect.height; y += 2.5) {
                    const waveX = x + fabric.amplitude * Math.sin(
                        fabric.warpFreq * y + fabric.warpPhase + i * 0.08 + tearOffset
                    );
                    if (y === 0) ctx.moveTo(waveX, y);
                    else ctx.lineTo(waveX, y);
                    
                    if (Math.abs(y - centerY) < 80 && Math.abs(x - centerX) < 250) {
                        localDensity += Math.abs(Math.sin(fabric.warpFreq * y + fabric.warpPhase)) * 0.0008;
                    }
                }
                ctx.stroke();
            }
            
            // Weft threads
            const weftCount = Math.floor(rect.height / fabric.spacing);
            for (let j = -weftCount/2; j < weftCount/2; j++) {
                const y = centerY + j * fabric.spacing;
                const tearIdx = Math.abs(j) % fabric.tearNoise.length;
                const tearOffset = fabric.tearNoise[tearIdx];
                
                ctx.beginPath();
                ctx.strokeStyle = `rgba(255, 170, 90, ${0.15 + 0.25 * coherence})`;
                ctx.lineWidth = 0.8 + coherence * 0.4;
                
                for (let x = 0; x <= rect.width; x += 2.5) {
                    const waveY = y + fabric.amplitude * Math.sin(
                        fabric.weftFreq * x + fabric.weftPhase + j * 0.08 + tearOffset
                    );
                    if (x === 0) ctx.moveTo(x, waveY);
                    else ctx.lineTo(x, waveY);
                }
                ctx.stroke();
            }
            
            return Math.min(1, localDensity);
        }

        // Update letter visuals
        function updateLetters() {
            letters.forEach(letter => {
                const el = letter.element;
                if (!el) return;
                
                el.style.opacity = letter.opacity;
                el.style.transform = `translate(${letter.x}px, ${letter.y}px) scale(${letter.scale})`;
                
                if (letter.disrupted && phase === 'rupture') {
                    letter.x += letter.vx;
                    letter.y += letter.vy;
                    letter.vx += (Math.random() - 0.5) * 0.4;
                    letter.vy += (Math.random() - 0.5) * 0.4;
                    letter.vx *= 0.97;
                    letter.vy *= 0.97;
                }
            });
        }

        // Phase control
        function setPhase(newPhase) {
            phase = newPhase;
            document.querySelectorAll('.banner-phase-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelector(`[onclick="setPhase('${newPhase}')"]`).classList.add('active');
            
            if (newPhase === 'rupture') triggerRupture();
        }

        function triggerRupture() {
            ruptureDelta = 1;
            regeneration = 0;
            
            // Tear the fabric
            fabric.tearNoise.forEach((_, i) => {
                fabric.tearNoise[i] += (Math.random() - 0.5) * 2.5;
            });
            
            // Disrupt letters
            letters.forEach(letter => {
                if (Math.random() < 0.75) {
                    letter.disrupted = true;
                    letter.opacity = 0.15 + Math.random() * 0.3;
                    letter.scale = 0.3 + Math.random() * 0.4;
                    letter.vx = (Math.random() - 0.5) * 6;
                    letter.vy = (Math.random() - 0.5) * 6;
                    
                    letter.memoryWeights.forEach((_, i) => {
                        letter.memoryWeights[i] += (Math.random() - 0.5) * 0.25;
                        letter.memoryWeights[i] = Math.max(0.03, Math.min(0.35, letter.memoryWeights[i]));
                    });
                }
            });
        }

        // Main animation loop
        function animate() {
            time += 12;
            
            fabric.warpPhase += 0.006 * (0.8 + 0.4 * coherence);
            fabric.weftPhase += 0.005 * (0.8 + 0.4 * coherence);
            
            const density = drawLoom();
            updateCoherence(density);
            
            if (time % 50 === 0) storeMemory();
            
            switch (phase) {
                case 'coherence':
                    ruptureDelta = Math.max(0, ruptureDelta - 0.015);
                    if (time % 400 === 0 && Math.random() < 0.4) {
                        setPhase('rupture');
                    }
                    break;
                    
                case 'rupture':
                    coherence *= 0.985;
                    ruptureDelta = Math.max(0.4, ruptureDelta - 0.008);
                    if (time % 200 === 0 && ruptureDelta < 0.6) {
                        setPhase('rebirth');
                    }
                    break;
                    
                case 'rebirth':
                    regenerateLetters();
                    ruptureDelta = Math.max(0, ruptureDelta - 0.02);
                    if (regeneration > 0.6 && letters.every(l => !l.disrupted)) {
                        setPhase('coherence');
                    }
                    break;
            }
            
            updateLetters();
            
            // Update UI
            document.getElementById('cVal').textContent = coherence.toFixed(2);
            document.getElementById('dVal').textContent = ruptureDelta > 0.5 ? '1' : '0';
            document.getElementById('rVal').textContent = regeneration.toFixed(2);
            
            requestAnimationFrame(animate);
        }

        // Logo animation system (from original Physical Systems)
        class CRRHomepage {
            constructor() {
                this.animationTime = 0;
                this.isAnimating = true;
                this.rafId = null;
                this.elements = this.cacheElements();
                this.ruptureActive = false;
                this.ruptureStartTime = 0;
                this.init();
            }

            cacheElements() {
                return {
                    logo: document.querySelector('.logo'),
                    logoHive: document.querySelector('.logo-hive'),
                    bees: document.querySelectorAll('.logo-bee'),
                    interiorBees: document.querySelectorAll('[class*="interior-bee"]'),
                    navLinks: document.querySelectorAll('.nav-link')
                };
            }

            init() {
                if (document.readyState === 'loading') {
                    document.addEventListener('DOMContentLoaded', () => this.start());
                } else {
                    this.start();
                }
            }

            start() {
                try {
                    this.setupLogoInteractions();
                    this.setupNavigationInteractions();
                    
                    if (!this.respectsReducedMotion()) {
                        this.startAnimation();
                    }
                    
                    this.setupVisibilityChange();
                } catch (error) {
                    console.error('Logo animation error:', error);
                }
            }

            setupLogoInteractions() {
                if (!this.elements.logo) return;
                this.elements.logo.addEventListener('click', () => {
                    this.triggerDiracRupture();
                });
            }

            triggerDiracRupture() {
                if (this.ruptureActive) return;
                this.ruptureActive = true;
                this.ruptureStartTime = this.animationTime;
                
                this.elements.logoHive.classList.add('rupture');
                
                setTimeout(() => {
                    this.elements.logoHive.classList.remove('rupture');
                }, 3000);

                setTimeout(() => {
                    this.ruptureActive = false;
                }, 4000);
            }

            setupNavigationInteractions() {
                this.elements.navLinks.forEach((link) => {
                    link.addEventListener('mouseenter', () => {
                        if (!link.classList.contains('active')) {
                            link.style.transform = 'translateY(-2px)';
                        }
                    });
                    
                    link.addEventListener('mouseleave', () => {
                        link.style.transform = 'translateY(0)';
                    });
                });
            }

            startAnimation() {
                const animate = () => {
                    if (!this.isAnimating) return;
                    
                    this.animationTime += 0.025;
                    this.animateBees();
                    this.animateInteriorBees();
                    
                    this.rafId = requestAnimationFrame(animate);
                };
                
                animate();
            }

            animateBees() {
                this.elements.bees.forEach((bee, index) => {
                    if (this.ruptureActive) {
                        this.animateRuptureBees(bee, index);
                    } else {
                        this.animateNormalBees(bee, index);
                    }
                });
            }

            animateNormalBees(bee, index) {
                const baseAngle = (index * Math.PI * 0.5) + this.animationTime * (0.4 + index * 0.15);
                const radius = 20 + Math.sin(this.animationTime * 0.7 + index) * 6;
                
                const figure8 = Math.sin(this.animationTime * 0.6 + index * 0.8) * 8;
                
                const x = 50 + Math.cos(baseAngle) * radius + figure8 * Math.cos(baseAngle * 2);
                const y = 50 + Math.sin(baseAngle) * radius * 0.8 + figure8 * 0.3 * Math.sin(baseAngle * 3);
                
                bee.setAttribute('transform', `translate(${x - 50}, ${y - 50})`);
                
                const wingBeat = 0.6 + 0.4 * Math.sin(this.animationTime * 12 + index * 2.5);
                bee.style.opacity = wingBeat;
            }

            animateRuptureBees(bee, index) {
                const elapsedTime = this.animationTime - this.ruptureStartTime;
                
                if (elapsedTime < 60) {
                    const disperseProgress = elapsedTime / 60;
                    const disperseAngle = (index * Math.PI * 0.5) + this.animationTime * (2.5 + index * 0.6);
                    const disperseRadius = 20 + disperseProgress * (70 + index * 12);
                    
                    const x = 50 + Math.cos(disperseAngle) * disperseRadius;
                    const y = 50 + Math.sin(disperseAngle) * disperseRadius;
                    
                    bee.setAttribute('transform', `translate(${x - 50}, ${y - 50})`);
                    bee.style.opacity = 0.2 + 0.8 * Math.sin(this.animationTime * 25 + index * 3.5);
                    
                } else if (elapsedTime < 140) {
                    const recohereProgress = (elapsedTime - 60) / 80;
                    const smoothProgress = 1 - Math.pow(1 - recohereProgress, 3);
                    
                    const currentRadius = 90 - smoothProgress * 70;
                    const angle = (index * Math.PI * 0.5) + this.animationTime * (1.8 - smoothProgress * 1.4);
                    
                    const x = 50 + Math.cos(angle) * currentRadius;
                    const y = 50 + Math.sin(angle) * currentRadius * 0.8;
                    
                    bee.setAttribute('transform', `translate(${x - 50}, ${y - 50})`);
                    bee.style.opacity = 0.6 + 0.4 * Math.sin(this.animationTime * (15 - smoothProgress * 5) + index * 2.5);
                }
            }

            animateInteriorBees() {
                this.elements.interiorBees.forEach((bee, index) => {
                    const movement = Math.sin(this.animationTime * 2.5 + index * 3.5) * 2;
                    const rotation = Math.sin(this.animationTime * 2 + index * 2.5) * 8;
                    
                    bee.setAttribute('transform', `translate(${movement}, ${movement * 0.6}) rotate(${rotation})`);
                });
            }

            setupVisibilityChange() {
                document.addEventListener('visibilitychange', () => {
                    if (document.hidden) {
                        this.isAnimating = false;
                        if (this.rafId) {
                            cancelAnimationFrame(this.rafId);
                        }
                    } else if (!this.respectsReducedMotion()) {
                        this.isAnimating = true;
                        this.startAnimation();
                    }
                });
            }

            respectsReducedMotion() {
                return window.matchMedia('(prefers-reduced-motion: reduce)').matches;
            }

            destroy() {
                this.isAnimating = false;
                if (this.rafId) {
                    cancelAnimationFrame(this.rafId);
                }
            }
        }

        // Start everything
        animate();

        // Auto demo
        setTimeout(() => {
            if (phase === 'coherence') {
                console.log('Auto demo: triggering rupture sequence');
                setPhase('rupture');
            }
        }, 8000);

        // Controls
        document.addEventListener('keydown', e => {
            if (e.code === 'Space') {
                e.preventDefault();
                setPhase('rupture');
            }
        });

        // Initialize logo animation
        const logoApp = new CRRHomepage();

        // Cleanup
        window.addEventListener('beforeunload', () => {
            if (logoApp) logoApp.destroy();
        });

        console.log('Mathematical Life CRR page initialized');
    </script>
</body>
</html>
