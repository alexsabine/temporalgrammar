<!DOCTYPE html>
<html lang="en-GB">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CRR Simulations - Cohere.org.uk</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
    <script>
        MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                displayMath: [['$$', '$$'], ['\\[', '\\]']]
            },
            svg: {
                fontCache: 'global'
            }
        };
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-svg.min.js" async></script>
    <style>
        /* ════════════════════════════════════════════════════════════════════════
           ☉ THE ALCHEMICAL SUN — BLAKE'S VISION RENDERED IN CRR
           ════════════════════════════════════════════════════════════════════════ */

        /* Sun Logo Animations */
        .crr-sun {
            width: 52px;
            height: 52px;
            cursor: pointer;
            margin-right: 20px;
            transition: transform 0.3s ease;
        }

        .crr-sun:hover {
            transform: scale(1.1);
        }

        .crr-sun-svg {
            width: 100%;
            height: 100%;
            transition: filter 0.3s ease;
        }

        /* Photosphere breathing */
        .photosphere {
            animation: photosphereBreath 6s ease-in-out infinite;
        }

        @keyframes photosphereBreath {
            0%, 100% { opacity: 1; }
            42% { opacity: 0.97; }
            48% { opacity: 0.92; }
            55% { opacity: 0.98; }
        }

        /* Granulation */
        .granule {
            animation: granuleLife 3.5s ease-in-out infinite;
            transform-origin: center;
        }

        @keyframes granuleLife {
            0%, 100% { opacity: 0.35; transform: scale(1); }
            40% { opacity: 0.55; transform: scale(1.08); }
            50% { opacity: 0.45; transform: scale(0.95); }
            75% { opacity: 0.38; transform: scale(1.02); }
        }

        .granule-1 { animation-duration: 3.0s; animation-delay: 0s; }
        .granule-2 { animation-duration: 4.0s; animation-delay: -1.2s; }
        .granule-3 { animation-duration: 3.5s; animation-delay: -0.6s; }
        .granule-4 { animation-duration: 4.5s; animation-delay: -2.1s; }
        .granule-5 { animation-duration: 3.2s; animation-delay: -0.9s; }
        .granule-6 { animation-duration: 3.8s; animation-delay: -1.5s; }

        /* Corona flames */
        .corona-ray {
            opacity: 0.88;
            animation: flameDance 1.2s ease-in-out infinite;
        }

        @keyframes flameDance {
            0%, 100% { 
                opacity: 0.75;
                filter: brightness(0.95);
            }
            50% { 
                opacity: 0.95;
                filter: brightness(1.15);
            }
        }

        .ray-1 { animation-duration: 1.15s; animation-delay: 0s; }
        .ray-2 { animation-duration: 1.35s; animation-delay: -0.2s; }
        .ray-3 { animation-duration: 1.05s; animation-delay: -0.5s; }
        .ray-4 { animation-duration: 1.25s; animation-delay: -0.15s; }
        .ray-5 { animation-duration: 1.1s; animation-delay: -0.4s; }
        .ray-6 { animation-duration: 1.3s; animation-delay: -0.25s; }
        .ray-7 { animation-duration: 1.2s; animation-delay: -0.35s; }
        .ray-8 { animation-duration: 1.0s; animation-delay: -0.1s; }

        .corona-ray-minor {
            opacity: 0.5;
            animation: flameDanceMinor 1.5s ease-in-out infinite;
        }

        @keyframes flameDanceMinor {
            0%, 100% { opacity: 0.4; filter: brightness(0.9); }
            50% { opacity: 0.6; filter: brightness(1.1); }
        }

        /* Coronal loop */
        .coronal-loop {
            opacity: 0;
            animation: loopMemory 6s ease-in-out infinite;
        }

        @keyframes loopMemory {
            0%, 48% { opacity: 0; stroke-dashoffset: 15; }
            55% { opacity: 0.5; stroke-dashoffset: 8; }
            72% { opacity: 0.75; stroke-dashoffset: 0; }
            90% { opacity: 0.25; stroke-dashoffset: 0; }
            100% { opacity: 0; stroke-dashoffset: 15; }
        }

        /* Chromosphere */
        .chromosphere-ring {
            animation: limbGlow 6s ease-in-out infinite;
        }

        @keyframes limbGlow {
            0%, 100% { opacity: 0.25; }
            42% { opacity: 0.4; }
            48% { opacity: 0.7; }
            55% { opacity: 0.35; }
        }

        /* Solar flare */
        .solar-flare {
            opacity: 0;
            animation: flareRupture 6s ease-out infinite;
        }

        @keyframes flareRupture {
            0%, 44% { opacity: 0; transform: scale(0.5); }
            48% { opacity: 0.9; transform: scale(1.12); }
            52% { opacity: 0.55; transform: scale(1); }
            62% { opacity: 0.15; transform: scale(0.88); }
            72%, 100% { opacity: 0; transform: scale(0.6); }
        }

        /* Core glow */
        .core-glow {
            animation: coreIntensity 6s ease-in-out infinite;
        }

        @keyframes coreIntensity {
            0%, 100% { opacity: 0.45; transform: scale(1); }
            42% { opacity: 0.7; transform: scale(1.03); }
            48% { opacity: 0.92; transform: scale(1.08); }
            55% { opacity: 0.55; transform: scale(0.97); }
        }

        /* Sun hover effects */
        .crr-sun:hover .corona-ray { animation-duration: 0.6s; }
        .crr-sun:hover .corona-ray-minor { animation-duration: 0.8s; }
        .crr-sun:hover .crr-sun-svg { filter: drop-shadow(0 0 8px rgba(255, 180, 60, 0.6)); }

        /* Click eruption */
        .crr-sun.erupting .solar-flare {
            animation: cmeNow 0.6s ease-out forwards !important;
        }

        @keyframes cmeNow {
            0% { opacity: 0; transform: scale(0.4); }
            20% { opacity: 1; transform: scale(1.2); }
            100% { opacity: 0; transform: scale(0.65); }
        }

        @media (prefers-reduced-motion: reduce) {
            .photosphere, .granule, .corona-ray, .corona-ray-minor,
            .solar-flare, .core-glow, .coronal-loop, .chromosphere-ring {
                animation: none !important;
            }
            .corona-ray { opacity: 0.88; }
            .corona-ray-minor { opacity: 0.5; }
            .granule { opacity: 0.25; }
            .coronal-loop { opacity: 0.4; stroke-dashoffset: 0; }
            .chromosphere-ring { opacity: 0.4; }
        }

        /* Base Reset */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 50%, #f5f6f8 100%);
            font-family: Georgia, serif;
            line-height: 1.6;
            color: #2c2c2c;
            overflow-x: hidden;
        }

        .page-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 60px;
        }

        .header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 40px 0;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
            position: relative;
            z-index: 100;
        }

        .logo-section {
            display: flex;
            align-items: center;
        }

        .title-group {
            display: flex;
            flex-direction: column;
        }

        .site-title {
            font-family: Georgia, serif;
            font-size: 48px;
            font-weight: normal;
            color: #1a1a1a;
            letter-spacing: -0.5px;
            margin-bottom: 5px;
        }

        .strapline {
            font-family: Georgia, serif;
            font-size: 18px;
            font-style: italic;
            color: #6c757d;
            letter-spacing: 0.5px;
        }

        .main-nav {
            display: flex;
            align-items: center;
            gap: 40px;
        }

        .nav-item {
            position: relative;
        }

        .nav-link {
            font-family: Georgia, serif;
            font-size: 18px;
            font-weight: normal;
            color: #495057;
            text-decoration: none;
            padding: 12px 20px;
            border-radius: 0;
            transition: all 0.3s ease;
            position: relative;
            display: flex;
            align-items: center;
            gap: 8px;
            white-space: nowrap;
        }

        .nav-link:hover {
            background: rgba(212, 160, 18, 0.12);
            color: #8B4513;
            transform: translateY(-2px);
        }

        .nav-link.active {
            background: linear-gradient(135deg, #D4A012 0%, #B8860B 100%);
            color: white;
        }

        .dropdown-arrow {
            font-size: 12px;
            transition: transform 0.3s ease;
        }

        .nav-item:hover .dropdown-arrow {
            transform: rotate(180deg);
        }

        .dropdown-menu {
            position: absolute;
            top: 100%;
            left: 0;
            background: white;
            min-width: 220px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.12);
            border: 1px solid rgba(180, 120, 40, 0.2);
            border-radius: 0;
            padding: 8px 0;
            opacity: 0;
            visibility: hidden;
            transform: translateY(-8px);
            transition: all 0.25s ease;
            z-index: 1000;
            overflow: hidden;
        }

        .nav-item:hover .dropdown-menu {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }

        .dropdown-menu:hover {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }

        .nav-item::before {
            content: '';
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            height: 2px;
            background: transparent;
            z-index: 999;
        }

        .dropdown-link {
            display: block;
            padding: 12px 20px;
            color: #495057;
            text-decoration: none;
            font-size: 16px;
            font-family: Georgia, serif;
            transition: all 0.2s ease;
            border-left: 3px solid transparent;
        }

        .dropdown-link:hover {
            background: rgba(212, 160, 18, 0.1);
            color: #B8860B;
            border-left-color: #D4A012;
        }

        .hero-section {
            padding: 100px 0 80px;
            text-align: center;
            position: relative;
        }

        .hero-background {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                radial-gradient(circle at 20% 80%, rgba(212, 160, 18, 0.04) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(184, 134, 11, 0.03) 0%, transparent 50%);
            pointer-events: none;
        }

        .hero-content {
            position: relative;
            z-index: 1;
        }

        .hero-title {
            font-family: Georgia, serif;
            font-size: 56px;
            font-weight: normal;
            line-height: 1.1;
            margin-bottom: 30px;
            color: #1a1a1a;
            letter-spacing: -1px;
        }

        .hero-subtitle {
            font-family: Georgia, serif;
            font-size: 24px;
            font-weight: normal;
            color: #495057;
            margin-bottom: 40px;
            line-height: 1.5;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
        }

        .content-section {
            margin: 80px 0;
            padding: 60px;
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(0, 0, 0, 0.05);
            border-radius: 12px;
            position: relative;
        }

        .section-background {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, rgba(248, 249, 250, 0.5) 0%, transparent 100%);
            border-radius: 12px;
            pointer-events: none;
        }

        .section-content {
            position: relative;
            z-index: 1;
            max-width: 1000px;
            margin: 0 auto;
        }

        .section-title {
            font-family: Georgia, serif;
            font-size: 36px;
            font-weight: normal;
            margin-bottom: 30px;
            color: #1a1a1a;
            text-align: center;
        }

        .section-content p {
            font-family: Georgia, serif;
            font-size: 18px;
            line-height: 1.8;
            margin-bottom: 25px;
            text-align: justify;
        }

        .section-content h3 {
            font-family: Georgia, serif;
            font-size: 24px;
            font-weight: normal;
            margin: 35px 0 20px;
            color: #1a1a1a;
        }

        .intro-text {
            font-size: 20px;
            line-height: 1.9;
            color: #2c2c2c;
            margin-bottom: 40px;
            padding: 30px;
            background: rgba(212, 160, 18, 0.05);
            border-left: 3px solid rgba(184, 134, 11, 0.4);
        }

        /* FAQ Styles */
        .faq-container {
            margin: 40px 0;
        }

        .faq-item {
            margin-bottom: 20px;
            border: 1px solid rgba(0, 0, 0, 0.08);
            background: rgba(255, 255, 255, 0.9);
            overflow: hidden;
        }

        .faq-question {
            padding: 25px 30px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: background 0.3s ease;
        }

        .faq-question:hover {
            background: rgba(212, 160, 18, 0.08);
        }

        .faq-question h4 {
            font-family: Georgia, serif;
            font-size: 20px;
            font-weight: normal;
            color: #1a1a1a;
            margin: 0;
        }

        .faq-toggle {
            font-size: 24px;
            color: #B8860B;
            transition: transform 0.3s ease;
            font-weight: 300;
        }

        .faq-item.active .faq-toggle {
            transform: rotate(45deg);
        }

        .faq-answer {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.4s ease, padding 0.4s ease;
            padding: 0 30px;
        }

        .faq-item.active .faq-answer {
            max-height: 800px;
            padding: 0 30px 30px;
        }

        .faq-answer p {
            font-size: 17px;
            line-height: 1.8;
            color: #495057;
            margin-bottom: 15px;
        }

        .faq-answer p:last-child {
            margin-bottom: 0;
        }

        .equation-highlight {
            background: rgba(212, 160, 18, 0.1);
            padding: 20px 25px;
            margin: 20px 0;
            text-align: center;
            border-left: 3px solid #B8860B;
        }

        /* Simulation Styles */
        .simulation-container {
            margin: 50px 0;
            padding: 40px;
            background: #fafbfc;
            border: 1px solid rgba(0, 0, 0, 0.08);
        }

        .simulation-title {
            font-family: Georgia, serif;
            font-size: 24px;
            font-weight: normal;
            margin-bottom: 20px;
            color: #1a1a1a;
            text-align: center;
        }

        .simulation-description {
            font-size: 16px;
            color: #6c757d;
            text-align: center;
            margin-bottom: 30px;
            font-style: italic;
        }

        .canvas-wrapper {
            display: flex;
            justify-content: center;
            margin-bottom: 30px;
        }

        #crrCanvas {
            border: 1px solid #dee2e6;
            background: white;
        }

        .controls-panel {
            display: flex;
            flex-wrap: wrap;
            gap: 30px;
            justify-content: center;
            margin-bottom: 30px;
        }

        .control-group {
            display: flex;
            flex-direction: column;
            align-items: center;
            min-width: 180px;
        }

        .control-label {
            font-family: Georgia, serif;
            font-size: 14px;
            color: #495057;
            margin-bottom: 8px;
            text-align: center;
        }

        .control-value {
            font-family: 'Courier New', monospace;
            font-size: 13px;
            color: #6c757d;
            margin-top: 5px;
        }

        input[type="range"] {
            width: 160px;
            height: 6px;
            -webkit-appearance: none;
            background: #dee2e6;
            border-radius: 3px;
            outline: none;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 18px;
            height: 18px;
            background: #B8860B;
            border-radius: 50%;
            cursor: pointer;
            transition: background 0.2s;
        }

        input[type="range"]::-webkit-slider-thumb:hover {
            background: #8B4513;
        }

        .button-group {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-bottom: 30px;
        }

        .sim-button {
            font-family: Georgia, serif;
            font-size: 16px;
            padding: 12px 30px;
            border: 1px solid #B8860B;
            background: white;
            color: #B8860B;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .sim-button:hover {
            background: #B8860B;
            color: white;
        }

        .sim-button.active {
            background: #B8860B;
            color: white;
        }

        .metrics-panel {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            padding: 25px;
            background: white;
            border: 1px solid #dee2e6;
        }

        .metric {
            text-align: center;
            padding: 15px;
        }

        .metric-label {
            font-family: Georgia, serif;
            font-size: 13px;
            color: #6c757d;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 8px;
        }

        .metric-value {
            font-family: 'Courier New', monospace;
            font-size: 24px;
            color: #1a1a1a;
        }

        .metric-sublabel {
            font-size: 12px;
            color: #adb5bd;
            margin-top: 5px;
        }

        .state-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
            vertical-align: middle;
        }

        .state-coherence { background: #B8860B; }
        .state-rupture { background: #dc3545; }
        .state-regeneration { background: #28a745; }

        /* Footer */
        .footer {
            background: rgba(245, 246, 248, 0.95);
            backdrop-filter: blur(10px);
            border-top: 1px solid rgba(0, 0, 0, 0.05);
            padding: 50px 0 40px;
            text-align: center;
            margin-top: 80px;
        }

        .footer-content {
            max-width: 1000px;
            margin: 0 auto;
            padding: 0 20px;
        }

        .footer-sections {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 40px;
            margin-bottom: 35px;
            text-align: left;
        }

        .footer-section h4 {
            font-family: Georgia, serif;
            font-size: 14px;
            font-weight: normal;
            font-variant: small-caps;
            letter-spacing: 0.05em;
            color: #1a1a1a;
            margin-bottom: 15px;
            padding-bottom: 8px;
            border-bottom: 1px solid rgba(184, 134, 11, 0.3);
        }

        .footer-section ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .footer-section li {
            margin-bottom: 10px;
        }

        .footer-section a {
            font-family: Georgia, serif;
            font-size: 14px;
            color: #4a4a4a;
            text-decoration: none;
            transition: color 0.2s ease;
        }

        .footer-section a:hover {
            color: #B8860B;
        }

        .footer-divider {
            width: 100%;
            height: 1px;
            background: linear-gradient(90deg, transparent, rgba(184, 134, 11, 0.3), transparent);
            margin: 30px 0;
        }

        .footer-repo-note {
            font-family: Georgia, serif;
            font-size: 13px;
            color: #6c757d;
            font-style: italic;
            line-height: 1.6;
            max-width: 700px;
            margin: 0 auto 25px;
        }

        .footer-author {
            font-family: Georgia, serif;
            font-size: 14px;
            color: #4a4a4a;
            margin-bottom: 20px;
            line-height: 1.6;
        }

        .footer-author a {
            color: #B8860B;
            text-decoration: none;
        }

        .footer-author a:hover {
            text-decoration: underline;
        }

        .footer-tech-note {
            font-family: Georgia, serif;
            font-size: 12px;
            color: #8c8c8c;
            font-style: italic;
            line-height: 1.4;
        }

        /* Responsive */
        @media (max-width: 1200px) {
            .page-container { padding: 0 40px; }
            .main-nav { gap: 25px; }
        }

        @media (max-width: 992px) {
            .header { flex-direction: column; gap: 30px; padding: 30px 0; }
            .site-title { font-size: 36px; }
            .main-nav { flex-wrap: wrap; justify-content: center; gap: 15px; }
            .footer-sections { grid-template-columns: 1fr; text-align: center; }
        }

        @media (max-width: 768px) {
            .page-container { padding: 0 20px; }
            .content-section { padding: 40px 25px; margin: 60px 0; }
            .section-title { font-size: 28px; }
            .hero-section { padding: 60px 0 40px; }
            .hero-title { font-size: 42px; }
            .hero-subtitle { font-size: 20px; }
            .simulation-container { padding: 25px 15px; }
            #crrCanvas { max-width: 100%; height: auto; }
            .controls-panel { gap: 20px; }
            .dropdown-menu {
                position: static;
                opacity: 1;
                visibility: visible;
                transform: none;
                box-shadow: none;
                border: none;
                background: rgba(212, 160, 18, 0.05);
                margin-top: 10px;
                display: none;
            }
            .nav-item:hover .dropdown-menu { display: block; }
        }
    </style>
</head>
<body>
    <div class="page-container">
        <header class="header">
            <div class="logo-section">
                <!-- ☉ THE ALCHEMICAL SUN — Blake's Vision in CRR ☉ -->
                <div class="crr-sun" id="crrSun" title="Sol Invictus — The Alchemical Furnace">
                    <svg class="crr-sun-svg" viewBox="0 0 52 52" xmlns="http://www.w3.org/2000/svg">
                        <defs>
                            <filter id="plasmaTurbulence" x="-20%" y="-20%" width="140%" height="140%">
                                <feTurbulence type="fractalNoise" baseFrequency="0.08" numOctaves="3" seed="42" result="noise"/>
                                <feDisplacementMap in="SourceGraphic" in2="noise" scale="1.5" xChannelSelector="R" yChannelSelector="G"/>
                            </filter>
                            <filter id="coronaGlow" x="-50%" y="-50%" width="200%" height="200%">
                                <feGaussianBlur stdDeviation="1" result="blur"/>
                                <feMerge>
                                    <feMergeNode in="blur"/>
                                    <feMergeNode in="SourceGraphic"/>
                                </feMerge>
                            </filter>
                            <filter id="flareBloom" x="-100%" y="-100%" width="300%" height="300%">
                                <feGaussianBlur stdDeviation="2" result="blur"/>
                                <feComposite in="SourceGraphic" in2="blur" operator="over"/>
                            </filter>
                            <radialGradient id="photosphereGrad" cx="35%" cy="35%" r="60%">
                                <stop offset="0%" stop-color="#FFFDE7"/>
                                <stop offset="20%" stop-color="#FFE082"/>
                                <stop offset="45%" stop-color="#FFB300"/>
                                <stop offset="70%" stop-color="#E65100"/>
                                <stop offset="90%" stop-color="#BF360C"/>
                                <stop offset="100%" stop-color="#8D1F09"/>
                            </radialGradient>
                            <radialGradient id="limbDarkening" cx="50%" cy="50%" r="50%">
                                <stop offset="0%" stop-color="transparent"/>
                                <stop offset="60%" stop-color="transparent"/>
                                <stop offset="85%" stop-color="rgba(139, 31, 9, 0.3)"/>
                                <stop offset="100%" stop-color="rgba(89, 20, 5, 0.5)"/>
                            </radialGradient>
                            <linearGradient id="coronaGrad" x1="50%" y1="100%" x2="50%" y2="0%">
                                <stop offset="0%" stop-color="#FFB300"/>
                                <stop offset="30%" stop-color="#FF8F00"/>
                                <stop offset="60%" stop-color="#E65100"/>
                                <stop offset="100%" stop-color="#BF360C" stop-opacity="0.4"/>
                            </linearGradient>
                            <linearGradient id="coronaGradSoft" x1="50%" y1="100%" x2="50%" y2="0%">
                                <stop offset="0%" stop-color="#FFCA28" stop-opacity="0.8"/>
                                <stop offset="50%" stop-color="#FF9800" stop-opacity="0.5"/>
                                <stop offset="100%" stop-color="#E65100" stop-opacity="0.2"/>
                            </linearGradient>
                            <radialGradient id="chromosphereGrad" cx="50%" cy="50%" r="55%">
                                <stop offset="70%" stop-color="transparent"/>
                                <stop offset="85%" stop-color="rgba(255, 138, 101, 0.4)"/>
                                <stop offset="100%" stop-color="rgba(255, 87, 34, 0.2)"/>
                            </radialGradient>
                            <radialGradient id="flareGrad" cx="50%" cy="50%" r="50%">
                                <stop offset="0%" stop-color="#FFFFFF"/>
                                <stop offset="30%" stop-color="#FFF9C4"/>
                                <stop offset="70%" stop-color="#FFE082" stop-opacity="0.6"/>
                                <stop offset="100%" stop-color="#FFB300" stop-opacity="0"/>
                            </radialGradient>
                            <radialGradient id="coreGlow" cx="50%" cy="50%" r="40%">
                                <stop offset="0%" stop-color="#FFFFFF" stop-opacity="0.9"/>
                                <stop offset="50%" stop-color="#FFF59D" stop-opacity="0.5"/>
                                <stop offset="100%" stop-color="#FFE082" stop-opacity="0"/>
                            </radialGradient>
                        </defs>
                        
                        <!-- Corona flames -->
                        <g filter="url(#coronaGlow)">
                            <path class="corona-ray ray-1" fill="url(#coronaGrad)" d="M26 3 Q28 8 28.5 13 Q27 15.5 26 16 Q25 15.5 23.5 13 Q24 8 26 3"/>
                            <path class="corona-ray ray-2" fill="url(#coronaGrad)" d="M42 10 Q38 13 34 18 Q33 17 33 16.5 Q34.5 15 35 14 Q37 11 42 10"/>
                            <path class="corona-ray ray-3" fill="url(#coronaGrad)" d="M49 26 Q44 24 38 23.5 Q36.5 25 36 26 Q36.5 27 38 28.5 Q44 28 49 26"/>
                            <path class="corona-ray ray-4" fill="url(#coronaGrad)" d="M42 42 Q38 39 34 34 Q33 35 33 35.5 Q34.5 37 35 38 Q37 41 42 42"/>
                            <path class="corona-ray ray-5" fill="url(#coronaGrad)" d="M26 49 Q24 44 23.5 39 Q25 36.5 26 36 Q27 36.5 28.5 39 Q28 44 26 49"/>
                            <path class="corona-ray ray-6" fill="url(#coronaGrad)" d="M10 42 Q14 39 18 34 Q19 35 19 35.5 Q17.5 37 17 38 Q15 41 10 42"/>
                            <path class="corona-ray ray-7" fill="url(#coronaGrad)" d="M3 26 Q8 24 14 23.5 Q15.5 25 16 26 Q15.5 27 14 28.5 Q8 28 3 26"/>
                            <path class="corona-ray ray-8" fill="url(#coronaGrad)" d="M10 10 Q14 13 18 18 Q19 17 19 16.5 Q17.5 15 17 14 Q15 11 10 10"/>
                        </g>
                        
                        <!-- Minor flames -->
                        <g>
                            <path class="corona-ray-minor" fill="url(#coronaGradSoft)" d="M31 6 Q30 10 29 14 Q28 15 27.5 15.5 Q28 14 28.5 12 Q29.5 9 31 6"/>
                            <path class="corona-ray-minor" fill="url(#coronaGradSoft)" d="M46 21 Q42 22 38 23 Q37 24 36.5 23.5 Q38 23 39 22 Q42 20.5 46 21"/>
                            <path class="corona-ray-minor" fill="url(#coronaGradSoft)" d="M46 31 Q42 30 38 29 Q37 28 36.5 28.5 Q38 29 39 30 Q42 31.5 46 31"/>
                            <path class="corona-ray-minor" fill="url(#coronaGradSoft)" d="M31 46 Q30 42 29 38 Q28 37 27.5 36.5 Q28 38 28.5 40 Q29.5 43 31 46"/>
                            <path class="corona-ray-minor" fill="url(#coronaGradSoft)" d="M21 46 Q22 42 23 38 Q24 37 24.5 36.5 Q24 38 23.5 40 Q22.5 43 21 46"/>
                            <path class="corona-ray-minor" fill="url(#coronaGradSoft)" d="M6 31 Q10 30 14 29 Q15 28 15.5 28.5 Q14 29 13 30 Q10 31.5 6 31"/>
                            <path class="corona-ray-minor" fill="url(#coronaGradSoft)" d="M6 21 Q10 22 14 23 Q15 24 15.5 23.5 Q14 23 13 22 Q10 20.5 6 21"/>
                            <path class="corona-ray-minor" fill="url(#coronaGradSoft)" d="M21 6 Q22 10 23 14 Q24 15 24.5 15.5 Q24 14 23.5 12 Q22.5 9 21 6"/>
                        </g>
                        
                        <!-- Chromosphere -->
                        <circle cx="26" cy="26" r="11" fill="url(#chromosphereGrad)"/>
                        <circle class="chromosphere-ring" cx="26" cy="26" r="10.5" fill="none" stroke="rgba(255, 120, 60, 0.4)" stroke-width="0.8"/>
                        
                        <!-- Photosphere -->
                        <g class="photosphere">
                            <circle cx="26" cy="26" r="10" fill="url(#photosphereGrad)"/>
                            <circle cx="26" cy="26" r="10" fill="url(#limbDarkening)"/>
                        </g>
                        
                        <!-- Granulation -->
                        <g>
                            <circle class="granule granule-1" cx="23" cy="24" r="1.6" fill="rgba(255, 248, 210, 0.5)"/>
                            <circle class="granule granule-2" cx="28" cy="25" r="1.3" fill="rgba(255, 245, 195, 0.45)"/>
                            <circle class="granule granule-3" cx="25" cy="28" r="1.4" fill="rgba(255, 242, 180, 0.4)"/>
                            <circle class="granule granule-4" cx="29" cy="28" r="1.1" fill="rgba(255, 248, 200, 0.45)"/>
                            <circle class="granule granule-5" cx="24" cy="22" r="1" fill="rgba(255, 252, 220, 0.5)"/>
                            <circle class="granule granule-6" cx="27" cy="22" r="0.9" fill="rgba(255, 250, 215, 0.42)"/>
                        </g>
                        
                        <!-- Coronal loop -->
                        <path class="coronal-loop" d="M20 22 Q16 26 20 30" fill="none" stroke="rgba(255, 180, 100, 0.8)" stroke-width="1" stroke-linecap="round" stroke-dasharray="15 5"/>
                        <path class="coronal-loop" d="M32 23 Q36 26 32 29" fill="none" stroke="rgba(255, 160, 80, 0.7)" stroke-width="0.8" stroke-linecap="round" stroke-dasharray="12 4" style="animation-delay: -1s;"/>
                        
                        <!-- Solar flare -->
                        <circle class="solar-flare" cx="26" cy="26" r="12" fill="url(#flareGrad)" filter="url(#flareBloom)"/>
                        
                        <!-- Core glow -->
                        <circle class="core-glow" cx="26" cy="26" r="4" fill="url(#coreGlow)"/>
                        
                        <!-- Specular highlight -->
                        <ellipse cx="23" cy="23" rx="2" ry="1.5" fill="rgba(255, 255, 255, 0.35)" transform="rotate(-30 23 23)"/>
                    </svg>
                </div>
               
                <div class="title-group">
                    <h1 class="site-title">Cohere.org.uk</h1>
                    <p class="strapline">A Temporal Grammar</p>
                </div>
            </div>

            <nav class="main-nav">
                <div class="nav-item">
                    <a href="index.html" class="nav-link">Home</a>
                </div>
                <div class="nav-item">
                    <a href="crr-simulations.html" class="nav-link active">
                        CRR Simulations
                        <span class="dropdown-arrow">▼</span>
                    </a>
                    <div class="dropdown-menu">
                        <a href="biological-systems.html" class="dropdown-link">Biological Systems</a>
                        <a href="physical-systems.html" class="dropdown-link">Physical Systems</a>
                        <a href="mathematical-life.html" class="dropdown-link">Mathematical Life</a>
                    </div>
                </div>
                <div class="nav-item">
                    <a href="crr-benchmarks.html" class="nav-link">CRR Benchmarks</a>
                </div>
                <div class="nav-item">
                    <a href="crr-explained.html" class="nav-link">CRR Explained</a>
                </div>
                <div class="nav-item">
                    <a href="about.html" class="nav-link">About</a>
                </div>
            </nav>
        </header>

        <main>
            <section class="hero-section">
                <div class="hero-background"></div>
                <div class="hero-content">
                    <h2 class="hero-title">CRR Simulations</h2>
                    <p class="hero-subtitle">A Coarse Grain Temporal Grammar</p>
                </div>
            </section>

            <section class="content-section">
                <div class="section-background"></div>
                <div class="section-content">
                    <div class="intro-text">
                        <p>These simulations exist because AI is accelerating coherence accumulation beyond human cognitive bandwidth. The density of contemporary information environments presents real psychological risks to individuals navigating overwhelming knowledge production.</p>
                        <p style="margin-bottom: 0;">This site is itself an experiment, an aesthetically crafted AI collaboration designed as a safe holding environment for complex ideas. Beneath the playful surface lie deeper implications, drawn from prior work in child development, ontogenic transformation, and the power of play. The CRR offers a temporal grammar: a way of thinking about how systems integrate their pasts, reach critical thresholds, and regenerate toward new futures.</p>
                    </div>

                    <h3>The CRR as Temporal Grammar</h3>
                    <p>The Coherence-Rupture-Regeneration framework provides a coarse grain grammar for describing temporal dynamics across scales. It is not a theory of everything, but a lens: a minimal formal structure for thinking about how any system, whether a neuron, a mind, an ecosystem, or a market, accumulates history, reaches saturation, and reconstitutes itself.</p>
                    
                    <p>The grammar has three movements: Coherence integrates the past non-Markovianly (the present state depends on all prior states, not just the most recent). Rupture marks the moment of phase transition, when accumulated history saturates the system's capacity. Regeneration reconstructs future states, weighted by the historical field.</p>
                </div>
            </section>

            <section class="content-section">
                <div class="section-background"></div>
                <h2 class="section-title">Frequently Asked Questions</h2>
                <div class="section-content">
                    <div class="faq-container">
                        <div class="faq-item">
                            <div class="faq-question">
                                <h4>What is Coherence?</h4>
                                <span class="faq-toggle">+</span>
                            </div>
                            <div class="faq-answer">
                                <p>Coherence is the temporal integral of all past states. It represents the accumulated history of a system, a non-Markovian memory that weights the present with everything that came before.</p>
                                <div class="equation-highlight">
                                    $$C(x) = \int L(x,\tau) \, d\tau$$
                                </div>
                                <p>Here, $L(x,\tau)$ is the memory density at position $x$ and time $\tau$. The integral runs over all past time, meaning coherence carries the full temporal signature of the system. This is fundamentally different from Markovian dynamics, where only the immediately preceding state matters.</p>
                            </div>
                        </div>

                        <div class="faq-item">
                            <div class="faq-question">
                                <h4>What is Omega and what happens when C equals Omega?</h4>
                                <span class="faq-toggle">+</span>
                            </div>
                            <div class="faq-answer">
                                <p>Omega ($\Omega$) is the system temperature parameter, a normalisation constant that sets the scale of the Markov blanket. It determines how much coherence a system can hold before reaching saturation.</p>
                                <p>When $C = \Omega$, the system reaches Markov blanket saturation. At this critical point, the exponential term $e^{C/\Omega}$ in the Regeneration operator equals Euler's number $e \approx 2.718$:</p>
                                <div class="equation-highlight">
                                    $$e^{C/\Omega} = e^1 = e$$
                                </div>
                                <p>This is the inflection point where the accumulated past has filled the system's capacity to integrate more history. The Markov blanket, the statistical boundary separating system from environment, becomes saturated. The system can no longer absorb new information without structural change.</p>
                            </div>
                        </div>

                        <div class="faq-item">
                            <div class="faq-question">
                                <h4>What does Omega tell us about system porosity?</h4>
                                <span class="faq-toggle">+</span>
                            </div>
                            <div class="faq-answer">
                                <p>Omega controls the porosity of the Markov blanket, determining how easily information flows between system and environment:</p>
                                <p><strong>Higher Omega</strong> means a more porous, liquid system. The blanket is permeable. The system can integrate more history before reaching saturation, and the exponential weighting in Regeneration remains moderate even at high coherence. Such systems are adaptable, responsive, perhaps unstable.</p>
                                <p><strong>Lower Omega</strong> means a more rigid, crystalline system. The blanket is impermeable. Even small amounts of accumulated coherence push the exponential term toward large values, meaning recent priors dominate heavily. Such systems are stable, perhaps brittle, locked into their recent histories.</p>
                                <p>In the simulation below, adjusting Omega lets you see this directly: low Omega systems rupture quickly and regenerate with heavy weighting on recent states. High Omega systems can accumulate vast coherence before transition.</p>
                            </div>
                        </div>

                        <div class="faq-item">
                            <div class="faq-question">
                                <h4>What is Rupture?</h4>
                                <span class="faq-toggle">+</span>
                            </div>
                            <div class="faq-answer">
                                <p>Rupture is the phase transition, the discrete moment when coherence saturates and the system reorganises. Formally, it is represented by a Dirac delta function at the rupture time:</p>
                                <div class="equation-highlight">
                                    $$\delta(t - t_0)$$
                                </div>
                                <p>The Dirac delta is infinitely concentrated at a single instant: infinite intensity, zero duration, unit integral. This captures the scale-invariant nature of rupture. Whether the system is a synapse or a civilisation, the rupture event is singular, a point of discontinuity in the otherwise continuous accumulation of coherence.</p>
                                <p>Rupture can be endogenous (arising from internal dynamics reaching threshold) or exogenous (imposed by external perturbation). At any spatial or temporal scale, rupture marks the moment when the past is metabolised, when accumulated history is processed and the system prepares for reconstitution.</p>
                            </div>
                        </div>

                        <div class="faq-item">
                            <div class="faq-question">
                                <h4>What is Regeneration?</h4>
                                <span class="faq-toggle">+</span>
                            </div>
                            <div class="faq-answer">
                                <p>Regeneration is the reconstruction of future states from the historical field, weighted by the coherence accumulated before rupture:</p>
                                <div class="equation-highlight">
                                    $$R[\chi](x,t) = \int \phi(x,\tau) \cdot e^{C(x)/\Omega} \cdot \Theta(t-\tau) \, d\tau$$
                                </div>
                                <p>The exponential term $e^{C/\Omega}$ is the key: it weights the reconstruction by how much coherence was present. Systems that rupture at high coherence regenerate with stronger weighting on the historical field. Systems that rupture at low coherence are freer to explore new configurations.</p>
                                <p>The Heaviside function $\Theta(t-\tau)$ ensures causality: only past states contribute to regeneration. The reconstruction field $\phi$ represents the available material for rebuilding, whether that's synaptic weights, social ties, or metabolic pathways.</p>
                            </div>
                        </div>

                        <div class="faq-item">
                            <div class="faq-question">
                                <h4>What does "coarse grain" mean?</h4>
                                <span class="faq-toggle">+</span>
                            </div>
                            <div class="faq-answer">
                                <p>The CRR is deliberately coarse grained. It describes patterns that emerge at many scales without specifying microscopic mechanisms. This is intentional: the framework seeks universality rather than precision.</p>
                                <p>This is a grammar in the linguistic sense: a formal structure that generates valid descriptions without specifying content. Just as grammar tells you how to combine words without telling you what to say, the CRR tells you how temporal dynamics unfold without specifying what the system is. A neuron, a forest, a financial market, a human life: all can be parsed through this grammar.</p>
                                <p>The coarseness is the point. By abstracting away particulars, the grammar becomes applicable across scales and domains. The price of this generality is that specific predictions require additional domain knowledge. The CRR provides the temporal skeleton; flesh must be added by understanding the particular system in question.</p>
                            </div>
                        </div>

                        <div class="faq-item">
                            <div class="faq-question">
                                <h4>Why does the role of Euler's number matter here?</h4>
                                <span class="faq-toggle">+</span>
                            </div>
                            <div class="faq-answer">
                                <p>Euler's number $e$ emerges naturally in processes involving continuous growth and decay. It is the base of the natural logarithm, the eigenvalue of differentiation, the limit of compound interest as compounding becomes continuous.</p>
                                <p>In the CRR, $e$ appears in the Regeneration operator as the weighting factor when $C = \Omega$. This is not arbitrary. The exponential function $e^x$ is the unique function equal to its own derivative: it describes processes where the rate of change is proportional to the current value. This is precisely the behaviour of coherence accumulation and its influence on regeneration.</p>
                                <p>When $C/\Omega = 1$, the weighting factor $e^1 = e$ represents a precise balance point. Below this, the historical field is underweighted. Above this, it becomes increasingly dominant. The appearance of $e$ at the saturation threshold is not coincidental; it reflects the deep mathematical structure of continuous integration and exponential dynamics.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <section class="content-section">
                <div class="section-background"></div>
                <h2 class="section-title">Fundamental CRR Dynamics</h2>
                <div class="section-content">
                    <div class="simulation-container">
                        <h3 class="simulation-title">Interactive CRR Simulation</h3>
                        <p class="simulation-description">Observe how coherence accumulates, saturates at the Markov blanket threshold, ruptures, and regenerates</p>
                        
                        <div class="canvas-wrapper">
                            <canvas id="crrCanvas" width="800" height="400"></canvas>
                        </div>

                        <div class="controls-panel">
                            <div class="control-group">
                                <label class="control-label">Omega (System Temperature)</label>
                                <input type="range" id="omegaSlider" min="0.3" max="2.0" step="0.1" value="1.0">
                                <span class="control-value" id="omegaValue">1.0</span>
                            </div>
                            <div class="control-group">
                                <label class="control-label">Memory Density Rate</label>
                                <input type="range" id="densitySlider" min="0.01" max="0.1" step="0.01" value="0.04">
                                <span class="control-value" id="densityValue">0.04</span>
                            </div>
                            <div class="control-group">
                                <label class="control-label">Decay Constant (Lambda)</label>
                                <input type="range" id="lambdaSlider" min="0.01" max="0.2" step="0.01" value="0.05">
                                <span class="control-value" id="lambdaValue">0.05</span>
                            </div>
                        </div>

                        <div class="button-group">
                            <button class="sim-button active" id="playPause">Pause</button>
                            <button class="sim-button" id="reset">Reset</button>
                            <button class="sim-button" id="triggerRupture">Trigger Rupture</button>
                        </div>

                        <div class="metrics-panel">
                            <div class="metric">
                                <div class="metric-label">Coherence (C)</div>
                                <div class="metric-value" id="coherenceMetric">0.000</div>
                            </div>
                            <div class="metric">
                                <div class="metric-label">C / Omega</div>
                                <div class="metric-value" id="ratioMetric">0.000</div>
                                <div class="metric-sublabel">Blanket saturation</div>
                            </div>
                            <div class="metric">
                                <div class="metric-label">exp(C/Omega)</div>
                                <div class="metric-value" id="expMetric">1.000</div>
                                <div class="metric-sublabel">Regeneration weight</div>
                            </div>
                            <div class="metric">
                                <div class="metric-label">System State</div>
                                <div class="metric-value" id="stateMetric">
                                    <span class="state-indicator state-coherence"></span>Coherence
                                </div>
                            </div>
                            <div class="metric">
                                <div class="metric-label">Rupture Count</div>
                                <div class="metric-value" id="ruptureCount">0</div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <footer class="footer">
        <div class="page-container">
            <div class="footer-content">
                <div class="footer-sections">
                    <div class="footer-section">
                        <h4>Framework</h4>
                        <ul>
                            <li><a href="crr-explained.html">CRR Explained</a></li>
                            <li><a href="crr-benchmarks.html">Benchmarks</a></li>
                            <li><a href="guide.html">Interactive Guide</a></li>
                        </ul>
                    </div>
                    <div class="footer-section">
                        <h4>Simulations</h4>
                        <ul>
                            <li><a href="biological-systems.html">Biological Systems</a></li>
                            <li><a href="physical-systems.html">Physical Systems</a></li>
                            <li><a href="mathematical-life.html">Mathematical Life</a></li>
                        </ul>
                    </div>
                    <div class="footer-section">
                        <h4>Resources</h4>
                        <ul>
                            <li><a href="https://github.com/alexsabine/CRR/" target="_blank">GitHub Repository</a></li>
                            <li><a href="about.html">About</a></li>
                            <li><a href="/cdn-cgi/l/email-protection#2e4f424b566e4d41464b5c4b00415c49005b45">Contact</a></li>
                        </ul>
                    </div>
                </div>
                
                <div class="footer-divider"></div>
                
                <p class="footer-repo-note">
                    CRR: A coarse-grained mathematical framework exploring coherence, rupture, and regeneration dynamics across living systems.
                </p>
                
                <p class="footer-author">
                    Alexander Sabine · <a href="https://cohere.org.uk">Cohere Research</a> · <a href="https://www.activeinference.org/">Active Inference Institute</a>
                </p>
                
                <p class="footer-tech-note">
                    Note: These simulations utilise HTML5, WebGL2, and advanced JavaScript. Desktop browsers recommended for optimal performance.
                </p>
            </div>
        </div>
    </footer>

    <script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script><script>
        'use strict';

        // FAQ Toggle
        document.querySelectorAll('.faq-question').forEach(question => {
            question.addEventListener('click', () => {
                const item = question.parentElement;
                const wasActive = item.classList.contains('active');
                
                // Close all other items
                document.querySelectorAll('.faq-item').forEach(i => i.classList.remove('active'));
                
                // Toggle current item
                if (!wasActive) {
                    item.classList.add('active');
                }
            });
        });

        // CRR Simulation
        class CRRSimulation {
            constructor(canvas) {
                this.canvas = canvas;
                this.ctx = canvas.getContext('2d');
                this.width = canvas.width;
                this.height = canvas.height;
                
                // Parameters
                this.omega = 1.0;
                this.lambda = 0.05;
                this.densityRate = 0.04;
                
                // State
                this.C = 0;
                this.L = 0;
                this.state = 'coherence';
                this.ruptureCount = 0;
                this.regenerationTimer = 0;
                this.time = 0;
                
                // History for visualization
                this.history = [];
                this.maxHistory = 400;
                
                // Animation
                this.isRunning = true;
                this.lastTime = performance.now();
                
                this.setupControls();
                this.animate();
            }
            
            setupControls() {
                const omegaSlider = document.getElementById('omegaSlider');
                const densitySlider = document.getElementById('densitySlider');
                const lambdaSlider = document.getElementById('lambdaSlider');
                
                omegaSlider.addEventListener('input', (e) => {
                    this.omega = parseFloat(e.target.value);
                    document.getElementById('omegaValue').textContent = this.omega.toFixed(1);
                });
                
                densitySlider.addEventListener('input', (e) => {
                    this.densityRate = parseFloat(e.target.value);
                    document.getElementById('densityValue').textContent = this.densityRate.toFixed(2);
                });
                
                lambdaSlider.addEventListener('input', (e) => {
                    this.lambda = parseFloat(e.target.value);
                    document.getElementById('lambdaValue').textContent = this.lambda.toFixed(2);
                });
                
                document.getElementById('playPause').addEventListener('click', (e) => {
                    this.isRunning = !this.isRunning;
                    e.target.textContent = this.isRunning ? 'Pause' : 'Play';
                    e.target.classList.toggle('active', this.isRunning);
                    if (this.isRunning) {
                        this.lastTime = performance.now();
                        this.animate();
                    }
                });
                
                document.getElementById('reset').addEventListener('click', () => {
                    this.reset();
                });
                
                document.getElementById('triggerRupture').addEventListener('click', () => {
                    if (this.state === 'coherence' && this.C > 0.1) {
                        this.triggerRupture();
                    }
                });
            }
            
            reset() {
                this.C = 0;
                this.L = 0;
                this.state = 'coherence';
                this.ruptureCount = 0;
                this.regenerationTimer = 0;
                this.time = 0;
                this.history = [];
                this.updateMetrics();
            }
            
            triggerRupture() {
                this.state = 'rupture';
                this.ruptureCount++;
                this.regenerationTimer = 0;
                
                // Store coherence at rupture for regeneration weighting
                this.coherenceAtRupture = this.C;
            }
            
            update(dt) {
                this.time += dt;
                
                if (this.state === 'coherence') {
                    // Accumulate memory density
                    const noise = (Math.random() - 0.5) * 0.01;
                    this.L += (this.densityRate + noise) * dt;
                    this.L = Math.max(0, Math.min(1, this.L));
                    
                    // Coherence integration with decay
                    const dC = this.L * dt - this.lambda * this.C * dt;
                    this.C += dC;
                    this.C = Math.max(0, this.C);
                    
                    // Check for saturation (C approaches Omega)
                    if (this.C >= this.omega * 0.95) {
                        this.triggerRupture();
                    }
                }
                else if (this.state === 'rupture') {
                    // Rapid coherence drop (Dirac-like transition)
                    this.C *= 0.85;
                    this.L *= 0.9;
                    
                    if (this.C < 0.05) {
                        this.state = 'regeneration';
                        this.regenerationTimer = 0;
                    }
                }
                else if (this.state === 'regeneration') {
                    this.regenerationTimer += dt;
                    
                    // Regeneration with exponential weighting from historical field
                    const expWeight = Math.exp(this.coherenceAtRupture / this.omega);
                    const regenerationRate = 0.02 * Math.min(expWeight, 3);
                    
                    this.L += regenerationRate * dt * 0.5;
                    this.C += this.L * regenerationRate * dt;
                    
                    // Transition back to coherence after regeneration period
                    if (this.regenerationTimer > 2.0) {
                        this.state = 'coherence';
                    }
                }
                
                // Record history
                this.history.push({
                    C: this.C,
                    L: this.L,
                    state: this.state,
                    ratio: this.C / this.omega
                });
                
                if (this.history.length > this.maxHistory) {
                    this.history.shift();
                }
                
                this.updateMetrics();
            }
            
            updateMetrics() {
                const ratio = this.C / this.omega;
                const expTerm = Math.exp(ratio);
                
                document.getElementById('coherenceMetric').textContent = this.C.toFixed(3);
                document.getElementById('ratioMetric').textContent = ratio.toFixed(3);
                document.getElementById('expMetric').textContent = expTerm.toFixed(3);
                document.getElementById('ruptureCount').textContent = this.ruptureCount;
                
                const stateEl = document.getElementById('stateMetric');
                const indicator = stateEl.querySelector('.state-indicator');
                
                indicator.className = 'state-indicator';
                if (this.state === 'coherence') {
                    indicator.classList.add('state-coherence');
                    stateEl.innerHTML = '<span class="state-indicator state-coherence"></span>Coherence';
                } else if (this.state === 'rupture') {
                    indicator.classList.add('state-rupture');
                    stateEl.innerHTML = '<span class="state-indicator state-rupture"></span>Rupture';
                } else {
                    indicator.classList.add('state-regeneration');
                    stateEl.innerHTML = '<span class="state-indicator state-regeneration"></span>Regeneration';
                }
            }
            
            render() {
                const ctx = this.ctx;
                const w = this.width;
                const h = this.height;
                
                // Clear
                ctx.fillStyle = '#ffffff';
                ctx.fillRect(0, 0, w, h);
                
                // Grid
                ctx.strokeStyle = '#f0f0f0';
                ctx.lineWidth = 1;
                for (let i = 0; i <= 10; i++) {
                    const y = (h - 60) * (1 - i / 10) + 30;
                    ctx.beginPath();
                    ctx.moveTo(60, y);
                    ctx.lineTo(w - 20, y);
                    ctx.stroke();
                }
                
                // Omega threshold line
                const omegaY = 30 + (h - 60) * (1 - this.omega / 2);
                ctx.strokeStyle = '#dc3545';
                ctx.lineWidth = 2;
                ctx.setLineDash([8, 4]);
                ctx.beginPath();
                ctx.moveTo(60, omegaY);
                ctx.lineTo(w - 20, omegaY);
                ctx.stroke();
                ctx.setLineDash([]);
                
                // Label
                ctx.fillStyle = '#dc3545';
                ctx.font = '12px Georgia';
                ctx.fillText('Omega = ' + this.omega.toFixed(1), w - 100, omegaY - 8);
                
                // e threshold (C/Omega = 1)
                if (this.omega <= 2) {
                    const eY = 30 + (h - 60) * (1 - this.omega / 2);
                    ctx.fillStyle = '#6c757d';
                    ctx.font = '11px Georgia';
                    ctx.fillText('C = Omega (e^1 threshold)', 65, eY - 8);
                }
                
                // Draw history
                if (this.history.length > 1) {
                    const xStep = (w - 80) / this.maxHistory;
                    
                    // Coherence line
                    ctx.beginPath();
                    ctx.strokeStyle = '#B8860B';
                    ctx.lineWidth = 2;
                    
                    for (let i = 0; i < this.history.length; i++) {
                        const x = 60 + i * xStep;
                        const y = 30 + (h - 60) * (1 - this.history[i].C / 2);
                        
                        if (i === 0) ctx.moveTo(x, y);
                        else ctx.lineTo(x, y);
                    }
                    ctx.stroke();
                    
                    // Memory density (lighter)
                    ctx.beginPath();
                    ctx.strokeStyle = 'rgba(184, 134, 11, 0.3)';
                    ctx.lineWidth = 1;
                    
                    for (let i = 0; i < this.history.length; i++) {
                        const x = 60 + i * xStep;
                        const y = 30 + (h - 60) * (1 - this.history[i].L / 2);
                        
                        if (i === 0) ctx.moveTo(x, y);
                        else ctx.lineTo(x, y);
                    }
                    ctx.stroke();
                    
                    // State indicator background
                    for (let i = 0; i < this.history.length; i++) {
                        const x = 60 + i * xStep;
                        const state = this.history[i].state;
                        
                        if (state === 'rupture') {
                            ctx.fillStyle = 'rgba(220, 53, 69, 0.1)';
                            ctx.fillRect(x, 30, xStep, h - 60);
                        } else if (state === 'regeneration') {
                            ctx.fillStyle = 'rgba(40, 167, 69, 0.05)';
                            ctx.fillRect(x, 30, xStep, h - 60);
                        }
                    }
                }
                
                // Y-axis labels
                ctx.fillStyle = '#6c757d';
                ctx.font = '11px Georgia';
                ctx.textAlign = 'right';
                for (let i = 0; i <= 4; i++) {
                    const val = (i * 0.5).toFixed(1);
                    const y = 30 + (h - 60) * (1 - i / 4);
                    ctx.fillText(val, 55, y + 4);
                }
                
                // Axis labels
                ctx.textAlign = 'center';
                ctx.fillText('Time', w / 2, h - 10);
                
                ctx.save();
                ctx.translate(15, h / 2);
                ctx.rotate(-Math.PI / 2);
                ctx.fillText('Coherence (C) / Memory Density (L)', 0, 0);
                ctx.restore();
                
                // Legend
                ctx.textAlign = 'left';
                ctx.fillStyle = '#B8860B';
                ctx.fillRect(70, h - 45, 15, 3);
                ctx.fillStyle = '#495057';
                ctx.fillText('Coherence', 90, h - 40);
                
                ctx.fillStyle = 'rgba(184, 134, 11, 0.3)';
                ctx.fillRect(180, h - 45, 15, 3);
                ctx.fillStyle = '#495057';
                ctx.fillText('Memory Density', 200, h - 40);
            }
            
            animate() {
                if (!this.isRunning) return;
                
                const now = performance.now();
                const dt = Math.min((now - this.lastTime) / 1000, 0.1);
                this.lastTime = now;
                
                this.update(dt);
                this.render();
                
                requestAnimationFrame(() => this.animate());
            }
        }

        // Initialize simulation
        document.addEventListener('DOMContentLoaded', () => {
            new CRRSimulation(document.getElementById('crrCanvas'));
        });

        // Sol Invictus click handler — Trigger CME rupture
        (function() {
            const sun = document.getElementById('crrSun');
            if (!sun) return;
            
            sun.addEventListener('click', function() {
                sun.classList.remove('erupting');
                void sun.offsetWidth; // Force reflow
                sun.classList.a
