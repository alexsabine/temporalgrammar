<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CRR Star: Betelgeuse — Physics Annotated</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { background: #050000; color: #e0d0c0; font-family: 'Courier New', monospace; min-height: 100vh; overflow-x: hidden; }
        .container { max-width: 1400px; margin: 0 auto; padding: 20px; }
        header { text-align: center; padding: 15px 0 25px; border-bottom: 1px solid #3a1a0a; }
        h1 { font-size: 1.6em; font-weight: 300; color: #ffb080; letter-spacing: 4px; margin-bottom: 6px; }
        .subtitle { color: #9a6a4a; font-size: 0.8em; letter-spacing: 2px; }
        .main-content { display: grid; grid-template-columns: 1fr 1fr; gap: 25px; margin-top: 25px; }
        @media (max-width: 1000px) { .main-content { grid-template-columns: 1fr; } }
        .star-container { background: radial-gradient(ellipse at center, #100500 0%, #050000 100%); border-radius: 12px; padding: 20px; display: flex; flex-direction: column; align-items: center; min-height: 520px; position: relative; overflow: hidden; }
        .star-field { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; }
        .background-star { position: absolute; background: white; border-radius: 50%; }
        #betelgeuse-canvas { position: relative; z-index: 10; cursor: grab; }
        .star-info { text-align: center; margin-top: 15px; z-index: 10; }
        .star-name { font-size: 1.3em; color: #ffb080; letter-spacing: 3px; margin-bottom: 4px; }
        .star-designation { color: #8a5a3a; font-size: 0.7em; letter-spacing: 1px; }
        .controls-overlay { position: absolute; top: 15px; left: 15px; right: 15px; display: flex; justify-content: space-between; z-index: 20; pointer-events: none; }
        .controls-overlay > * { pointer-events: auto; }
        .distance-display { color: #7a5a4a; font-size: 0.7em; background: rgba(5,0,0,0.9); padding: 10px 16px; border-radius: 20px; border: 1px solid #3a1a0a; }
        .distance-value { color: #ff9a5a; font-weight: bold; }
        .zoom-controls { position: absolute; bottom: 15px; left: 50%; transform: translateX(-50%); display: flex; align-items: center; gap: 12px; z-index: 20; background: rgba(5,0,0,0.9); padding: 10px 18px; border-radius: 30px; border: 1px solid #4a2a1a; }
        .zoom-btn { width: 32px; height: 32px; border-radius: 50%; border: 1px solid #6a4a3a; background: transparent; color: #ba8a6a; font-size: 1.3em; cursor: pointer; }
        .zoom-btn:hover { background: #2a1a0a; color: #ffb080; }
        .zoom-slider { width: 140px; height: 4px; -webkit-appearance: none; background: linear-gradient(90deg, #3a1a0a, #6a4a3a); border-radius: 2px; }
        .zoom-slider::-webkit-slider-thumb { -webkit-appearance: none; width: 14px; height: 14px; border-radius: 50%; background: #ffb080; cursor: pointer; }
        .zoom-label { color: #8a5a4a; font-size: 0.65em; min-width: 80px; text-align: center; }
        
        /* Physics Overlay */
        .physics-overlay { position: fixed; top: 20px; right: 20px; width: 440px; max-height: calc(100vh - 40px); background: rgba(10,5,0,0.97); border: 1px solid #4a2a1a; border-radius: 12px; z-index: 1000; overflow: hidden; display: none; box-shadow: 0 10px 40px rgba(0,0,0,0.8); }
        .physics-overlay.visible { display: block; }
        .physics-header { background: linear-gradient(135deg, #2a1508, #1a0a04); padding: 15px 20px; border-bottom: 1px solid #4a2a1a; display: flex; justify-content: space-between; align-items: center; }
        .physics-title { color: #ffb080; font-size: 0.8em; letter-spacing: 2px; font-weight: bold; }
        .physics-close { background: none; border: 1px solid #6a4a3a; color: #ba8a6a; width: 28px; height: 28px; border-radius: 50%; cursor: pointer; font-size: 1.1em; }
        .physics-close:hover { background: #3a1a0a; color: #ffb080; }
        .physics-content { padding: 15px 20px; max-height: calc(100vh - 120px); overflow-y: auto; }
        .physics-content::-webkit-scrollbar { width: 6px; }
        .physics-content::-webkit-scrollbar-track { background: #0a0500; }
        .physics-content::-webkit-scrollbar-thumb { background: #4a2a1a; border-radius: 3px; }
        .physics-section { margin-bottom: 20px; padding-bottom: 15px; border-bottom: 1px solid #2a1a0a; }
        .physics-section:last-child { border-bottom: none; }
        .physics-section-title { color: #ff9a5a; font-size: 0.7em; letter-spacing: 2px; margin-bottom: 10px; display: flex; align-items: center; gap: 8px; }
        .symmetry-badge { font-size: 0.85em; padding: 2px 8px; border-radius: 10px; font-weight: bold; }
        .symmetry-badge.z2 { background: #4a1a1a; color: #ff7a5a; }
        .symmetry-badge.so2 { background: #3a3a1a; color: #ffda7a; }
        .physics-equation { background: #0a0400; padding: 12px 15px; border-radius: 6px; margin: 10px 0; font-family: 'Times New Roman', Georgia, serif; font-size: 1.05em; color: #d0a080; border-left: 3px solid #7a4a2a; text-align: center; }
        .physics-explanation { color: #9a8a7a; font-size: 0.75em; line-height: 1.6; margin: 8px 0; }
        .physics-value { display: flex; justify-content: space-between; padding: 6px 0; font-size: 0.75em; border-bottom: 1px dotted #2a1a0a; }
        .physics-value:last-child { border-bottom: none; }
        .physics-value-label { color: #8a7a6a; }
        .physics-value-data { color: #ffb080; font-weight: bold; }
        .physics-live { background: #150a04; border-radius: 6px; padding: 10px 12px; margin-top: 10px; }
        .physics-live-title { color: #ff9a5a; font-size: 0.65em; letter-spacing: 1px; margin-bottom: 8px; }
        .physics-live-value { color: #7f7; font-size: 1.1em; font-weight: bold; font-family: monospace; }
        .physics-toggle { position: fixed; top: 20px; right: 20px; background: rgba(10,5,0,0.95); border: 1px solid #6a4a3a; color: #ffb080; padding: 12px 20px; border-radius: 25px; cursor: pointer; font-size: 0.75em; letter-spacing: 2px; z-index: 999; font-family: 'Courier New', monospace; }
        .physics-toggle:hover { background: #2a1508; }
        .physics-toggle.hidden { display: none; }
        
        .calculations { background: #100800; border-radius: 12px; padding: 20px; border: 1px solid #3a1a0a; }
        .calc-header { color: #ba9a7a; font-size: 0.7em; letter-spacing: 2px; margin-bottom: 12px; padding-bottom: 8px; border-bottom: 1px solid #3a1a0a; }
        .crr-equation { background: #0a0400; padding: 12px 16px; border-radius: 8px; margin-bottom: 15px; font-family: 'Times New Roman', serif; font-size: 1em; text-align: center; color: #d0a080; border-left: 3px solid #7a4a2a; }
        .crr-component { background: #080400; padding: 10px 12px; border-radius: 6px; margin-bottom: 8px; display: flex; justify-content: space-between; align-items: center; }
        .component-label { color: #9a7a5a; font-size: 0.75em; }
        .component-value { color: #ffb080; font-size: 0.85em; font-weight: bold; }
        .live-value { color: #ff9a5a; }
        .systems-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 25px; }
        @media (max-width: 1000px) { .systems-grid { grid-template-columns: 1fr; } }
        .system-panel { background: #100800; border-radius: 12px; padding: 18px; border: 1px solid #3a1a0a; }
        .system-title { color: #ba9a7a; font-size: 0.65em; letter-spacing: 2px; margin-bottom: 12px; }
        .system-row { display: flex; justify-content: space-between; padding: 6px 0; border-bottom: 1px solid #180800; font-size: 0.75em; }
        .system-row:last-child { border-bottom: none; }
        .system-label { color: #8a6a4a; }
        .system-value { color: #c0a080; }
        .symmetry-z2 { color: #ff7a5a; }
        .symmetry-so2 { color: #ffda7a; }
        .pulsation-indicator { grid-column: 1 / -1; background: #100800; border-radius: 12px; padding: 15px 20px; border: 1px solid #3a1a0a; margin-top: 10px; display: flex; align-items: center; gap: 20px; }
        .pulsation-label { color: #9a7a5a; font-size: 0.7em; min-width: 120px; }
        .pulsation-bar { flex: 1; height: 8px; background: #0a0400; border-radius: 4px; overflow: hidden; }
        .pulsation-fill { height: 100%; background: linear-gradient(90deg, #ff5a2a, #ffaa5a, #ff5a2a); border-radius: 4px; }
        .pulsation-value { color: #ffaa5a; font-size: 0.8em; min-width: 80px; text-align: right; }
        .realtime-panel { grid-column: 1 / -1; background: linear-gradient(135deg, #100800, #180a04); border-radius: 12px; padding: 20px; border: 1px solid #4a2a1a; margin-top: 10px; }
        .realtime-title { color: #ff9a5a; font-size: 0.65em; letter-spacing: 2px; margin-bottom: 12px; }
        .realtime-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 12px; }
        .realtime-item { background: #080400; padding: 12px; border-radius: 8px; text-align: center; }
        .realtime-label { color: #7a5a4a; font-size: 0.6em; margin-bottom: 6px; }
        .realtime-value { color: #ff9a5a; font-size: 1.2em; font-weight: bold; }
        .realtime-unit { color: #5a4a3a; font-size: 0.6em; margin-top: 2px; }
        footer { text-align: center; padding: 25px; color: #5a4a3a; font-size: 0.65em; margin-top: 25px; border-top: 1px solid #3a1a0a; }
        footer a { color: #8a6a5a; text-decoration: none; }
        .loading-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #050000; display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 1000; transition: opacity 0.5s; }
        .loading-overlay.hidden { opacity: 0; pointer-events: none; }
        .loading-text { color: #9a6a4a; font-size: 0.8em; letter-spacing: 3px; margin-top: 20px; }
        .loading-star { width: 80px; height: 80px; border-radius: 50%; background: radial-gradient(circle, #ffb080 0%, #8a4a2a 50%, transparent 70%); animation: pulse-red 2s ease-in-out infinite; }
        @keyframes pulse-red { 0%, 100% { transform: scale(1); opacity: 0.8; } 50% { transform: scale(1.3); opacity: 1; } }
        .dimming-event { position: absolute; bottom: 60px; left: 50%; transform: translateX(-50%); background: rgba(20,5,0,0.95); border: 1px solid #ff5a2a; border-radius: 8px; padding: 8px 16px; color: #ff9a5a; font-size: 0.65em; z-index: 15; display: none; animation: pulse-warning 1s infinite; }
        @keyframes pulse-warning { 0%, 100% { opacity: 1; } 50% { opacity: 0.6; } }
    </style>
</head>
<body>
    <div class="loading-overlay" id="loading">
        <div class="loading-star"></div>
        <div class="loading-text">INITIALIZING RED SUPERGIANT SIMULATION</div>
    </div>
    
    <button class="physics-toggle" id="physics-toggle" onclick="togglePhysicsOverlay()">⚛ PHYSICS OVERLAY</button>
    
    <div class="physics-overlay" id="physics-overlay">
        <div class="physics-header">
            <span class="physics-title">⚛ CRR PHYSICS DERIVATIONS</span>
            <button class="physics-close" onclick="togglePhysicsOverlay()">×</button>
        </div>
        <div class="physics-content">
            <div class="physics-section">
                <div class="physics-section-title">CORE CRR FRAMEWORK</div>
                <div class="physics-equation">C(x,t) = ∫₀ᵗ L(x,τ) dτ</div>
                <div class="physics-explanation"><strong>Coherence Accumulation:</strong> Integral of luminous intensity over time. For Betelgeuse, coherence builds over vastly longer timescales than main-sequence stars.</div>
                <div class="physics-equation">δ(now)</div>
                <div class="physics-explanation"><strong>Rupture:</strong> Dirac delta marking ontological present. In supergiants: pulsation peaks, cell turnover, mass ejection.</div>
                <div class="physics-equation">R = ∫ φ(x,τ)·exp(C/Ω)·Θ(τ) dτ</div>
                <div class="physics-explanation"><strong>Regeneration:</strong> Post-rupture reconstruction weighted by exp(C/Ω). Higher coherence = stronger memory influence on new state.</div>
            </div>
            
            <div class="physics-section">
                <div class="physics-section-title">Ω-SYMMETRY THEOREM</div>
                <div class="physics-equation">Ω = 1/φ_G</div>
                <div class="physics-explanation">φ_G = phase (radians) of symmetry group's fundamental domain.</div>
                <div class="physics-value"><span class="physics-value-label">Z₂ (binary, φ=π):</span><span class="physics-value-data">Ω = 1/π ≈ 0.31831</span></div>
                <div class="physics-value"><span class="physics-value-label">SO(2) (rotation, φ=2π):</span><span class="physics-value-data">Ω = 1/2π ≈ 0.15915</span></div>
                <div class="physics-value"><span class="physics-value-label">Universal amplification:</span><span class="physics-value-data">e^π ≈ 23.14</span></div>
                <div class="physics-explanation">Connection to FEP: Precision = 1/σ² = 1/Ω = φ_G</div>
            </div>
            
            <div class="physics-section">
                <div class="physics-section-title">GIANT CONVECTION CELLS <span class="symmetry-badge so2">SO(2)</span></div>
                <div class="physics-equation">τ_conv ≈ 1 year</div>
                <div class="physics-explanation"><strong>THE defining visual feature!</strong> Only ~10-20 cells (vs 10⁶ on Sun), each ~57° and ~3 AU across. Visible in interferometry!</div>
                <div class="physics-equation">C_cell(t) = ∫ L_thermal(τ) dτ</div>
                <div class="physics-explanation"><strong>Coherence:</strong> Hot plasma rises over months. Cell brightness tracks coherence.</div>
                <div class="physics-equation">brightness = 0.5 + 0.5·sin(lifePhase)</div>
                <div class="physics-explanation">Peak at π/2 (max coherence), minimum at 3π/2 (regeneration).</div>
                <div class="physics-live"><div class="physics-live-title">LIVE CELL CYCLES</div><div class="physics-live-value" id="physics-cell-cycles">0</div></div>
            </div>
            
            <div class="physics-section">
                <div class="physics-section-title">PRIMARY PULSATION <span class="symmetry-badge so2">SO(2)</span></div>
                <div class="physics-equation">τ_pulsation = 400 days</div>
                <div class="physics-explanation">Semi-regular variable (SRc). Entire star undergoes C→δ→R at this timescale.</div>
                <div class="physics-equation">R(t) = R₀ × (1 + 0.15·sin(ωt))</div>
                <div class="physics-explanation"><strong>Radius:</strong> ±15% variation (764 R☉ ± 115 R☉)</div>
                <div class="physics-equation">L ∝ R² × T⁴</div>
                <div class="physics-explanation"><strong>Stefan-Boltzmann:</strong> ~30% brightness variation. Cooling dominates during expansion.</div>
                <div class="physics-live"><div class="physics-live-title">LIVE PULSATION</div><div class="physics-live-value" id="physics-pulsation">Phase: 0° | R: 764 R☉</div></div>
            </div>
            
            <div class="physics-section">
                <div class="physics-section-title">MASS EJECTION <span class="symmetry-badge z2">Z₂</span></div>
                <div class="physics-equation">τ_ejection ~ 25 years</div>
                <div class="physics-explanation"><strong>2019-2020 "Great Dimming":</strong> Massive ejection formed dust cloud blocking ~60% of light.</div>
                <div class="physics-equation">P(ejection) ∝ exp(C/Ω_Z₂)</div>
                <div class="physics-explanation"><strong>Z₂ Rupture:</strong> Binary event—material ejected or not. Memory weight determines transition probability.</div>
                <div class="physics-live"><div class="physics-live-title">EJECTION STATUS</div><div class="physics-live-value" id="physics-ejection">QUIESCENT</div></div>
            </div>
            
            <div class="physics-section">
                <div class="physics-section-title">CIRCUMSTELLAR ENVELOPE <span class="symmetry-badge so2">SO(2)</span></div>
                <div class="physics-equation">Ṁ ≈ 10⁻⁶ M☉/year</div>
                <div class="physics-explanation">Intense stellar wind creates nested dust shells to ~100 R*.</div>
                <div class="physics-equation">v_wind ≈ 15 km/s</div>
                <div class="physics-value"><span class="physics-value-label">Inner shell transit:</span><span class="physics-value-data">~10 years</span></div>
            </div>
            
            <div class="physics-section">
                <div class="physics-section-title">OBSERVER CRR CHAIN</div>
                <div class="physics-explanation">Same timescales for any star—these are OUR perceptual dynamics:</div>
                <div class="physics-value"><span class="physics-value-label">Display (Z₂):</span><span class="physics-value-data">τ = 16.67ms</span></div>
                <div class="physics-value"><span class="physics-value-label">Atmosphere (SO(2)):</span><span class="physics-value-data">τ = π ms</span></div>
                <div class="physics-value"><span class="physics-value-label">Retina (Z₂):</span><span class="physics-value-data">τ = 100ms</span></div>
                <div class="physics-value"><span class="physics-value-label">V1 gamma (SO(2)):</span><span class="physics-value-data">τ = 25ms</span></div>
            </div>
            
            <div class="physics-section">
                <div class="physics-section-title">BETELGEUSE vs SIRIUS</div>
                <div class="physics-value"><span class="physics-value-label">Convection τ:</span><span class="physics-value-data">1 yr vs 7 days (52×)</span></div>
                <div class="physics-value"><span class="physics-value-label">Cell count:</span><span class="physics-value-data">~12 vs ~10⁶</span></div>
                <div class="physics-value"><span class="physics-value-label">Pulsation τ:</span><span class="physics-value-data">400d vs 46min (12,500×)</span></div>
                <div class="physics-value"><span class="physics-value-label">Temperature:</span><span class="physics-value-data">3,500K vs 9,940K</span></div>
            </div>
        </div>
    </div>
    
    <div class="container">
        <header>
            <h1>CRR STAR</h1>
            <div class="subtitle">BETELGEUSE — GIANT CONVECTION CELLS & PULSATION DYNAMICS</div>
        </header>
        
        <div class="main-content">
            <div class="star-container">
                <div class="star-field" id="starField"></div>
                <div class="controls-overlay">
                    <div class="distance-display">DISTANCE: <span class="distance-value" id="distance-display">700 ly</span></div>
                    <div style="background: rgba(5,0,0,0.9); border: 1px solid #4a2a1a; border-radius: 20px; padding: 10px 16px; color: #9a7a6a; font-size: 0.65em;"><span style="color: #ff9a5a;">●</span> CRR ACTIVE</div>
                </div>
                <canvas id="betelgeuse-canvas" width="380" height="380"></canvas>
                <div class="dimming-event" id="dimming-event">⚠ MASS EJECTION EVENT</div>
                <div class="star-info">
                    <div class="star-name">BETELGEUSE</div>
                    <div class="star-designation">α Ori · M1-M2 Ia-ab · 3,500 K · 126,000 L☉</div>
                </div>
                <div class="zoom-controls">
                    <button class="zoom-btn" id="zoom-out">−</button>
                    <input type="range" class="zoom-slider" id="zoom-slider" min="0" max="100" value="0">
                    <button class="zoom-btn" id="zoom-in">+</button>
                    <div class="zoom-label" id="zoom-label">Earth View</div>
                </div>
            </div>
            
            <div class="calculations">
                <div class="calc-header">CRR FRAMEWORK — RED SUPERGIANT</div>
                <div class="crr-equation">C(x,t) = ∫ L(x,τ) dτ</div>
                <div class="crr-component"><span class="component-label">Coherence</span><span class="component-value live-value" id="coherence-live">0.0000</span></div>
                <div class="crr-equation">δ(now) — Rupture</div>
                <div class="crr-component"><span class="component-label">Total Ruptures</span><span class="component-value live-value" id="rupture-count">0</span></div>
                <div class="crr-equation">R = ∫ φ·exp(C/Ω)·Θ dτ</div>
                <div class="crr-component"><span class="component-label">Memory Weight</span><span class="component-value live-value" id="memory-weight">1.0000</span></div>
                <div style="margin-top: 12px; padding-top: 12px; border-top: 1px solid #3a1a0a;">
                    <div class="crr-component"><span class="component-label">Ω (Z₂) = 1/π</span><span class="component-value">0.31831</span></div>
                    <div class="crr-component"><span class="component-label">Ω (SO(2)) = 1/2π</span><span class="component-value">0.15915</span></div>
                    <div class="crr-component"><span class="component-label">e<sup>π</sup></span><span class="component-value">23.1407</span></div>
                </div>
                <div style="margin-top: 12px; padding-top: 12px; border-top: 1px solid #3a1a0a;">
                    <div class="calc-header" style="margin-bottom: 8px;">PULSATION STATE</div>
                    <div class="crr-component"><span class="component-label">Phase (400d period)</span><span class="component-value live-value" id="pulsation-phase">0°</span></div>
                    <div class="crr-component"><span class="component-label">Radius Variation</span><span class="component-value live-value" id="radius-variation">0%</span></div>
                </div>
            </div>
        </div>
        
        <div class="systems-grid">
            <div class="system-panel">
                <div class="system-title">STELLAR CRR DYNAMICS (SUPERGIANT)</div>
                <div class="system-row"><span class="system-label">Core He Fusion (3α)</span><span class="system-value">τ = 10⁻¹² s · <span class="symmetry-z2">Z₂</span></span></div>
                <div class="system-row"><span class="system-label">Giant Convection Cells</span><span class="system-value">τ = 1 year · <span class="symmetry-so2">SO(2)</span></span></div>
                <div class="system-row"><span class="system-label">Primary Pulsation</span><span class="system-value">τ = 400 days · <span class="symmetry-so2">SO(2)</span></span></div>
                <div class="system-row"><span class="system-label">Mass Ejection Events</span><span class="system-value">τ ~ 25 years · <span class="symmetry-z2">Z₂</span></span></div>
            </div>
            <div class="system-panel">
                <div class="system-title">GIANT CONVECTION CELLS</div>
                <div class="system-row"><span class="system-label">Number of Cells</span><span class="system-value">~10-20 (vs 10⁶ on Sun)</span></div>
                <div class="system-row"><span class="system-label">Cell Angular Size</span><span class="system-value">~57° each</span></div>
                <div class="system-row"><span class="system-label">Cell Radius</span><span class="system-value">~3 AU (446M km)</span></div>
                <div class="system-row"><span class="system-label">Cell Lifetime</span><span class="system-value">~6-12 months</span></div>
            </div>
        </div>
        
        <div class="pulsation-indicator">
            <div class="pulsation-label">PULSATION PHASE</div>
            <div class="pulsation-bar"><div class="pulsation-fill" id="pulsation-bar-fill" style="width: 50%;"></div></div>
            <div class="pulsation-value" id="pulsation-percent">50%</div>
        </div>
        
        <div class="realtime-panel">
            <div class="realtime-title">◉ LIVE CRR DYNAMICS</div>
            <div class="realtime-grid">
                <div class="realtime-item"><div class="realtime-label">CELL CYCLES</div><div class="realtime-value" id="cell-cycles">0</div><div class="realtime-unit">convective</div></div>
                <div class="realtime-item"><div class="realtime-label">PULSATION δ</div><div class="realtime-value" id="pulsation-ruptures">0</div><div class="realtime-unit">cycles</div></div>
                <div class="realtime-item"><div class="realtime-label">DISPLAY δ</div><div class="realtime-value" id="display-ruptures">0</div><div class="realtime-unit">frames</div></div>
                <div class="realtime-item"><div class="realtime-label">CURRENT RADIUS</div><div class="realtime-value" id="current-radius">764</div><div class="realtime-unit">R☉</div></div>
                <div class="realtime-item"><div class="realtime-label">BRIGHTNESS</div><div class="realtime-value" id="current-brightness">100%</div><div class="realtime-unit">intensity</div></div>
                <div class="realtime-item"><div class="realtime-label">SESSION C(t)</div><div class="realtime-value" id="session-coherence">0.00</div><div class="realtime-unit">accumulated</div></div>
            </div>
        </div>
        
        <footer>CRR Framework © 2025 Alexander Sabine · <a href="https://cohere.org.uk">cohere.org.uk</a><br><span style="color: #3a2a1a;">View source for complete CRR mathematical derivations</span></footer>
    </div>
    
    <script>
/**
 * ══════════════════════════════════════════════════════════════════════════════════════════════════
 * CRR STAR: BETELGEUSE — COMPLETE MATHEMATICAL DERIVATION
 * ══════════════════════════════════════════════════════════════════════════════════════════════════
 * 
 * This script implements the Coherence-Rupture-Regeneration (CRR) framework for a red supergiant.
 * Every visual element derives from CRR equations with precise physical justification.
 * 
 * CORE CRR EQUATIONS:
 * ───────────────────
 * (1) C(x,t) = ∫₀ᵗ L(x,τ) dτ     — Coherence accumulation
 * (2) δ(now)                      — Rupture (Dirac delta at present moment)
 * (3) R = ∫ φ·exp(C/Ω)·Θ dτ      — Regeneration with memory weighting
 * 
 * Ω-SYMMETRY THEOREM:
 * ───────────────────
 * Ω = 1/φ_G where φ_G = phase of symmetry group's fundamental domain
 * 
 * Z₂ (binary):     Ω = 1/π ≈ 0.31831    (flip at π radians)
 * SO(2) (rotation): Ω = 1/2π ≈ 0.15915  (full circle at 2π radians)
 * 
 * CONNECTION TO FREE ENERGY PRINCIPLE:
 * Precision = 1/σ² = 1/Ω = φ_G
 * 
 * Author: Alexander Sabine · cohere.org.uk
 * ══════════════════════════════════════════════════════════════════════════════════════════════════
 */

// ═══════════════════════════════════════════════════════════════════════════════════════════════
// CRR FUNDAMENTAL CONSTANTS
// ═══════════════════════════════════════════════════════════════════════════════════════════════

/**
 * @CRR_CONSTANT: OMEGA_Z2 = 1/π ≈ 0.31831
 * Z₂ symmetry: binary states {s, -s}, transition at π radians
 * Applications: Core fusion, mass ejection, display frames
 */
const OMEGA_Z2 = 1 / Math.PI;

/**
 * @CRR_CONSTANT: OMEGA_SO2 = 1/(2π) ≈ 0.15915
 * SO(2) symmetry: continuous rotation on circle S¹
 * Applications: Convection, pulsation, stellar rotation
 */
const OMEGA_SO2 = 1 / (2 * Math.PI);

/** @CRR_CONSTANT: e^π ≈ 23.14 — Universal amplification at Z₂/SO₂ boundary */
const E_PI = Math.exp(Math.PI);

// Observer timescales (identical for all stars—these are OUR perceptual timescales)
const TAU_DISPLAY = 1/60;           // Display refresh: Z₂, 60 Hz
const TAU_ATM = Math.PI/1000;       // Atmospheric seeing: SO(2), π ms
const TAU_RETINAL = 0.1;            // Retinal integration: Z₂, 100 ms
const TAU_GAMMA = 0.025;            // V1 gamma: SO(2), 40 Hz

// ═══════════════════════════════════════════════════════════════════════════════════════════════
// BETELGEUSE PHYSICAL PARAMETERS
// ═══════════════════════════════════════════════════════════════════════════════════════════════

/**
 * @STELLAR_DATA: Betelgeuse (α Orionis)
 * Red supergiant with CRR timescales orders of magnitude longer than main-sequence stars.
 * 
 * KEY DIFFERENCES FROM SIRIUS:
 * - Temperature: 3500K vs 9940K (cooler = redder)
 * - Radius: 764 R☉ vs 1.7 R☉ (450× larger!)
 * - Convection cells: ~12 vs ~10⁶ (GIANT cells visible!)
 * - Pulsation: 400 days vs 46 minutes (12,500× slower)
 */
const BETELGEUSE = {
    temperature: 3500,
    radius_solar: 764,
    mass_solar: 16.5,
    luminosity_solar: 126000,
    distance_ly: 700,
    
    /** @CRR: Pulsation period τ = 400 days (SO(2) symmetry) */
    pulsation_period_days: 400,
    radius_variation_percent: 15,
    
    /** @CRR: Convective turnover τ ≈ 1 year (SO(2) symmetry) */
    convective_turnover_days: 365,
    num_convection_cells: 12,
    cell_angular_size: 57,
    
    // RGB from blackbody at 3500K
    rgb: { r: 255, g: 192, b: 140 }
};

const SOLAR_RADIUS_KM = 696340;
const LY_TO_KM = 9.461e12;
const BETELGEUSE_RADIUS_KM = BETELGEUSE.radius_solar * SOLAR_RADIUS_KM;

// ═══════════════════════════════════════════════════════════════════════════════════════════════
// STATE VARIABLES
// ═══════════════════════════════════════════════════════════════════════════════════════════════

const canvas = document.getElementById('betelgeuse-canvas');
const ctx = canvas.getContext('2d');

let startTime = Date.now();
let zoomLevel = 0, targetZoom = 0, lastFrameTime = 0;
let displayRuptures = 0, pulsationCycles = 0, cellCycles = 0;

/** @CRR_STATE: Session coherence C(t) = ∫₀ᵗ L dτ = t (with L=1) */
let sessionCoherence = 0;
let pulsationPhase = Math.random() * Math.PI * 2;
let currentRadiusFactor = 1.0, currentBrightness = 1.0;
let ejectionActive = false, ejectionTimer = 0, ejectionOpacity = 0;

// ═══════════════════════════════════════════════════════════════════════════════════════════════
// GIANT CONVECTION CELLS — CRR IMPLEMENTATION
// ═══════════════════════════════════════════════════════════════════════════════════════════════
/**
 * @CRR_SYSTEM: Giant Convection Cells
 * SYMMETRY: SO(2) — continuous rotational flow
 * τ ≈ 1 year
 * 
 * THE DEFINING VISUAL FEATURE of Betelgeuse!
 * Only ~10-20 cells vs ~10⁶ on the Sun.
 * 
 * CRR DYNAMICS:
 * COHERENCE: C_cell(t) = ∫ L_thermal(τ) dτ — hot plasma rises
 * RUPTURE: δ at surface spreading event
 * REGENERATION: R = ∫ φ·exp(C/Ω_SO2)·Θ dτ — cool plasma sinks
 * 
 * BRIGHTNESS FORMULA: brightness = 0.5 + 0.5·sin(lifePhase)
 * - Peak at π/2 (max coherence)
 * - Minimum at 3π/2 (regeneration)
 */
let giantCells = [];
const NUM_GIANT_CELLS = 12;

function initGiantCells() {
    giantCells = [];
    const goldenAngle = Math.PI * (3 - Math.sqrt(5));
    for (let i = 0; i < NUM_GIANT_CELLS; i++) {
        const y = 1 - (i / (NUM_GIANT_CELLS - 1)) * 2;
        giantCells.push({
            theta: goldenAngle * i,
            phi: Math.acos(y),
            angularSize: 50 + Math.random() * 20,
            lifePhase: Math.random() * Math.PI * 2,
            evolutionRate: 0.0005 + Math.random() * 0.001,
            temperatureOffset: (Math.random() - 0.5) * 500,
            coherence: Math.random() * OMEGA_SO2,
            baseIntensity: 0.7 + Math.random() * 0.3,
            currentBrightness: 0.5
        });
    }
}

/** @CRR_FUNCTION: Update giant cells through C→δ→R cycle */
function updateGiantCells(dt, t) {
    giantCells.forEach(cell => {
        cell.lifePhase += cell.evolutionRate;
        
        // Coherence accumulation: C += L × dt
        cell.coherence += 0.0001 * (1 + cell.baseIntensity) * dt;
        
        // Brightness from lifecycle: brightness = 0.5 + 0.5·sin(φ)
        cell.currentBrightness = 0.5 + 0.5 * Math.sin(cell.lifePhase);
        cell.theta += 0.00001;
        
        // Rupture check: reset when lifePhase > 2π
        if (cell.lifePhase > Math.PI * 2) {
            cell.lifePhase -= Math.PI * 2;
            cellCycles++;
            cell.coherence = 0;
            cell.temperatureOffset = (Math.random() - 0.5) * 500;
            cell.baseIntensity = 0.7 + Math.random() * 0.3;
        }
    });
}

// ═══════════════════════════════════════════════════════════════════════════════════════════════
// PULSATION — CRR IMPLEMENTATION
// ═══════════════════════════════════════════════════════════════════════════════════════════════
/**
 * @CRR_SYSTEM: Primary Pulsation
 * SYMMETRY: SO(2) — continuous radial oscillation
 * τ = 400 days (real), 30s (visualization)
 * 
 * RADIUS: R(t) = R₀ × (1 + 0.15·sin(ωt))
 * Range: 650 R☉ to 878 R☉
 * 
 * BRIGHTNESS: L ∝ R² × T⁴ (Stefan-Boltzmann)
 * ~30% variation with π/4 phase lag (thermal relaxation)
 */
function computePulsation(t) {
    const vizPeriod = 30;
    pulsationPhase = (t / vizPeriod) * Math.PI * 2;
    currentRadiusFactor = 1 + (BETELGEUSE.radius_variation_percent / 100) * Math.sin(pulsationPhase);
    currentBrightness = 1 + 0.3 * Math.sin(pulsationPhase - Math.PI/4);
    const newCycles = Math.floor(pulsationPhase / (Math.PI * 2));
    if (newCycles > pulsationCycles) pulsationCycles = newCycles;
}

// ═══════════════════════════════════════════════════════════════════════════════════════════════
// MASS EJECTION — CRR IMPLEMENTATION
// ═══════════════════════════════════════════════════════════════════════════════════════════════
/**
 * @CRR_SYSTEM: Mass Ejection Events
 * SYMMETRY: Z₂ — binary event (ejection or not)
 * τ ~ 25 years
 * 
 * The 2019-2020 "Great Dimming" was a perfect CRR rupture:
 * - COHERENCE: Material accumulated on surface
 * - RUPTURE: Massive ejection (Z₂ flip)
 * - REGENERATION: Dust cloud formed and dispersed
 * 
 * PROBABILITY: P(ejection) ∝ exp(C/Ω_Z₂)
 */
function checkMassEjection(dt) {
    if (!ejectionActive) {
        if (Math.random() < 0.0001 * dt) {
            ejectionActive = true;
            ejectionTimer = 0;
            document.getElementById('dimming-event').style.display = 'block';
        }
    } else {
        ejectionTimer += dt;
        const progress = ejectionTimer / 10;
        if (progress < 0.3) ejectionOpacity = progress / 0.3;
        else if (progress < 0.7) ejectionOpacity = 1.0;
        else if (progress < 1.0) ejectionOpacity = 1 - (progress - 0.7) / 0.3;
        else {
            ejectionActive = false;
            ejectionOpacity = 0;
            document.getElementById('dimming-event').style.display = 'none';
        }
    }
}

// Dust envelope
let dustParticles = [];
function initDustEnvelope() {
    dustParticles = [];
    for (let i = 0; i < 50; i++) {
        dustParticles.push({
            angle: Math.random() * Math.PI * 2,
            distance: 1.1 + Math.random() * 0.5,
            size: 0.01 + Math.random() * 0.02,
            speed: 0.0001 + Math.random() * 0.0002,
            opacity: 0.1 + Math.random() * 0.2
        });
    }
}

function updateDustEnvelope(dt) {
    dustParticles.forEach(p => {
        p.distance += p.speed * dt;
        p.angle += 0.00005;
        p.opacity *= 0.9999;
        if (p.distance > 2.0 || p.opacity < 0.01) {
            p.distance = 1.1;
            p.angle = Math.random() * Math.PI * 2;
            p.opacity = 0.1 + Math.random() * 0.2;
        }
    });
}

// ═══════════════════════════════════════════════════════════════════════════════════════════════
// RENDERING
// ═══════════════════════════════════════════════════════════════════════════════════════════════

function createStarField() {
    const field = document.getElementById('starField');
    for (let i = 0; i < 80; i++) {
        const star = document.createElement('div');
        star.className = 'background-star';
        star.style.left = Math.random() * 100 + '%';
        star.style.top = Math.random() * 100 + '%';
        const size = Math.random() * 1.5 + 0.5;
        star.style.width = size + 'px';
        star.style.height = size + 'px';
        star.style.opacity = Math.random() * 0.4 + 0.1;
        field.appendChild(star);
    }
}

function drawBetelgeuse(t) {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    const cx = canvas.width / 2, cy = canvas.height / 2;
    const zoomFactor = Math.pow(zoomLevel / 100, 2);
    const baseSize = 6, maxSize = 150;
    const apparentSize = (baseSize + (maxSize - baseSize) * zoomFactor) * currentRadiusFactor;
    const dimmingFactor = 1 - ejectionOpacity * 0.6;
    const effectiveBrightness = currentBrightness * dimmingFactor;
    
    if (zoomFactor < 0.1) drawDistantStar(cx, cy, apparentSize, effectiveBrightness, t);
    else if (zoomFactor < 0.4) drawApproachingStar(cx, cy, apparentSize, effectiveBrightness, zoomFactor, t);
    else drawCloseStar(cx, cy, apparentSize, effectiveBrightness, zoomFactor, t);
}

function drawDistantStar(cx, cy, size, brightness, t) {
    const layers = [{r:120,a:0.02},{r:80,a:0.04},{r:50,a:0.08},{r:30,a:0.15},{r:15,a:0.4},{r:size,a:0.95}];
    layers.forEach(l => {
        const g = ctx.createRadialGradient(cx, cy, 0, cx, cy, l.r * brightness);
        g.addColorStop(0, `rgba(${BETELGEUSE.rgb.r},${BETELGEUSE.rgb.g},${BETELGEUSE.rgb.b},${l.a * brightness})`);
        g.addColorStop(0.5, `rgba(${BETELGEUSE.rgb.r*0.8},${BETELGEUSE.rgb.g*0.6},${BETELGEUSE.rgb.b*0.4},${l.a*0.3*brightness})`);
        g.addColorStop(1, 'rgba(0,0,0,0)');
        ctx.fillStyle = g; ctx.beginPath(); ctx.arc(cx, cy, l.r * brightness, 0, Math.PI*2); ctx.fill();
    });
    drawSpikes(cx, cy, brightness, 50, 0.12);
    const twinkle = 0.9 + 0.1 * Math.sin(t*5) * Math.sin(t*7.3);
    const cg = ctx.createRadialGradient(cx, cy, 0, cx, cy, size*2);
    cg.addColorStop(0, `rgba(255,220,180,${brightness*twinkle})`);
    cg.addColorStop(0.3, `rgba(${BETELGEUSE.rgb.r},${BETELGEUSE.rgb.g},${BETELGEUSE.rgb.b},${brightness*twinkle})`);
    cg.addColorStop(1, 'rgba(0,0,0,0)');
    ctx.fillStyle = cg; ctx.beginPath(); ctx.arc(cx, cy, size*2, 0, Math.PI*2); ctx.fill();
}

function drawApproachingStar(cx, cy, size, brightness, zf, t) {
    const og = ctx.createRadialGradient(cx, cy, size*0.6, cx, cy, size*2.5);
    og.addColorStop(0, `rgba(${BETELGEUSE.rgb.r},${BETELGEUSE.rgb.g*0.8},${BETELGEUSE.rgb.b*0.5},${0.25*brightness})`);
    og.addColorStop(0.5, `rgba(${BETELGEUSE.rgb.r*0.7},${BETELGEUSE.rgb.g*0.5},${BETELGEUSE.rgb.b*0.3},${0.1*brightness})`);
    og.addColorStop(1, 'rgba(0,0,0,0)');
    ctx.fillStyle = og; ctx.beginPath(); ctx.arc(cx, cy, size*2.5, 0, Math.PI*2); ctx.fill();
    drawDisk(cx, cy, size, brightness, zf);
    if (zf > 0.2) drawCellsPreview(cx, cy, size, brightness, zf, t);
    const so = 0.1 * (1 - zf*2);
    if (so > 0.01) drawSpikes(cx, cy, brightness, 70, so);
}

function drawCloseStar(cx, cy, size, brightness, zf, t) {
    if (zf > 0.5) drawEnvelope(cx, cy, size, brightness, zf);
    drawDisk(cx, cy, size, brightness, zf);
    if (zf > 0.4) drawCells(cx, cy, size, brightness, zf, t);
    if (zf > 0.5) drawChromosphere(cx, cy, size, brightness, zf);
    if (ejectionActive) drawEjectionCloud(cx, cy, size, brightness);
}

function drawDisk(cx, cy, r, b, zf) {
    const g = ctx.createRadialGradient(cx, cy, 0, cx, cy, r);
    g.addColorStop(0, `rgba(255,220,180,${b})`);
    g.addColorStop(0.15, `rgba(255,210,165,${b})`);
    g.addColorStop(0.4, `rgba(${BETELGEUSE.rgb.r},${BETELGEUSE.rgb.g},${BETELGEUSE.rgb.b},${b})`);
    g.addColorStop(0.7, `rgba(${BETELGEUSE.rgb.r*0.85},${BETELGEUSE.rgb.g*0.75},${BETELGEUSE.rgb.b*0.6},${b})`);
    g.addColorStop(0.9, `rgba(${BETELGEUSE.rgb.r*0.5},${BETELGEUSE.rgb.g*0.4},${BETELGEUSE.rgb.b*0.3},${b*0.7})`);
    g.addColorStop(1, `rgba(${BETELGEUSE.rgb.r*0.3},${BETELGEUSE.rgb.g*0.2},${BETELGEUSE.rgb.b*0.1},${b*0.3})`);
    ctx.fillStyle = g; ctx.beginPath(); ctx.arc(cx, cy, r, 0, Math.PI*2); ctx.fill();
}

function drawCells(cx, cy, r, b, zf, t) {
    const vis = Math.min(1, (zf-0.4)*2);
    ctx.save(); ctx.beginPath(); ctx.arc(cx, cy, r*0.98, 0, Math.PI*2); ctx.clip();
    giantCells.forEach(c => {
        const x3d = Math.sin(c.phi)*Math.cos(c.theta+t*0.02);
        const y3d = Math.sin(c.phi)*Math.sin(c.theta+t*0.02);
        const z3d = Math.cos(c.phi);
        if (z3d > -0.3) {
            const cx2 = cx + x3d*r*0.85, cy2 = cy + y3d*r*0.85;
            const fs = Math.max(0.3, z3d), cr = r*0.35*fs;
            const lb = c.currentBrightness;
            const red = Math.min(255, BETELGEUSE.rgb.r+lb*20);
            const grn = Math.min(255, BETELGEUSE.rgb.g+lb*40);
            const blu = Math.min(255, BETELGEUSE.rgb.b+lb*30);
            const a = vis*(0.15+lb*0.25)*b*(0.5+fs*0.5);
            const cg = ctx.createRadialGradient(cx2, cy2, 0, cx2, cy2, cr);
            cg.addColorStop(0, `rgba(${red},${grn},${blu},${a})`);
            cg.addColorStop(0.5, `rgba(${red*0.9},${grn*0.85},${blu*0.8},${a*0.6})`);
            cg.addColorStop(1, 'rgba(0,0,0,0)');
            ctx.fillStyle = cg; ctx.beginPath(); ctx.arc(cx2, cy2, cr, 0, Math.PI*2); ctx.fill();
        }
    });
    ctx.restore();
}

function drawCellsPreview(cx, cy, r, b, zf, t) {
    const vis = (zf-0.2)*3;
    ctx.save(); ctx.beginPath(); ctx.arc(cx, cy, r*0.98, 0, Math.PI*2); ctx.clip();
    giantCells.slice(0,5).forEach(c => {
        const ang = c.theta+t*0.02, dist = r*0.4;
        const x = cx+Math.cos(ang)*dist, y = cy+Math.sin(ang)*dist;
        const a = vis*0.15*c.currentBrightness*b, sz = r*0.3;
        const g = ctx.createRadialGradient(x, y, 0, x, y, sz);
        g.addColorStop(0, `rgba(255,220,170,${a})`);
        g.addColorStop(1, 'rgba(0,0,0,0)');
        ctx.fillStyle = g; ctx.beginPath(); ctx.arc(x, y, sz, 0, Math.PI*2); ctx.fill();
    });
    ctx.restore();
}

function drawChromosphere(cx, cy, r, b, zf) {
    const ci = Math.min(1, (zf-0.5)*2);
    const cg = ctx.createRadialGradient(cx, cy, r*0.94, cx, cy, r*1.06);
    cg.addColorStop(0, 'rgba(0,0,0,0)');
    cg.addColorStop(0.3, `rgba(255,100,80,${0.08*ci*b})`);
    cg.addColorStop(0.6, `rgba(255,80,60,${0.12*ci*b})`);
    cg.addColorStop(1, 'rgba(0,0,0,0)');
    ctx.fillStyle = cg; ctx.beginPath(); ctx.arc(cx, cy, r*1.06, 0, Math.PI*2); ctx.fill();
}

function drawEnvelope(cx, cy, r, b, zf) {
    const ev = Math.min(1, (zf-0.5)*2);
    for (let s=1; s<=3; s++) {
        const sr = r*(1.1+s*0.15), sa = 0.03/s*ev*b;
        const sg = ctx.createRadialGradient(cx, cy, sr*0.9, cx, cy, sr*1.1);
        sg.addColorStop(0, `rgba(180,120,80,${sa})`);
        sg.addColorStop(0.5, `rgba(150,100,70,${sa*0.5})`);
        sg.addColorStop(1, 'rgba(0,0,0,0)');
        ctx.fillStyle = sg; ctx.beginPath(); ctx.arc(cx, cy, sr*1.1, 0, Math.PI*2); ctx.fill();
    }
    dustParticles.forEach(p => {
        const x = cx+Math.cos(p.angle)*r*p.distance, y = cy+Math.sin(p.angle)*r*p.distance;
        const dg = ctx.createRadialGradient(x, y, 0, x, y, r*p.size);
        dg.addColorStop(0, `rgba(180,130,100,${p.opacity*ev*b})`);
        dg.addColorStop(1, 'rgba(0,0,0,0)');
        ctx.fillStyle = dg; ctx.beginPath(); ctx.arc(x, y, r*p.size, 0, Math.PI*2); ctx.fill();
    });
}

function drawEjectionCloud(cx, cy, r, b) {
    const ca = Math.PI*0.3, cd = r*(1.2+ejectionTimer*0.05);
    const x = cx+Math.cos(ca)*cd, y = cy+Math.sin(ca)*cd, sz = r*(0.3+ejectionTimer*0.03);
    const cg = ctx.createRadialGradient(x, y, 0, x, y, sz);
    cg.addColorStop(0, `rgba(100,70,50,${ejectionOpacity*0.4*b})`);
    cg.addColorStop(0.5, `rgba(80,50,30,${ejectionOpacity*0.2*b})`);
    cg.addColorStop(1, 'rgba(0,0,0,0)');
    ctx.fillStyle = cg; ctx.beginPath(); ctx.arc(x, y, sz, 0, Math.PI*2); ctx.fill();
}

function drawSpikes(cx, cy, b, len, op) {
    ctx.save();
    [0, Math.PI/2, Math.PI, 3*Math.PI/2].forEach(ang => {
        const g = ctx.createLinearGradient(cx, cy, cx+Math.cos(ang)*len, cy+Math.sin(ang)*len);
        g.addColorStop(0, `rgba(${BETELGEUSE.rgb.r},${BETELGEUSE.rgb.g},${BETELGEUSE.rgb.b},${op*b})`);
        g.addColorStop(0.4, `rgba(${BETELGEUSE.rgb.r},${BETELGEUSE.rgb.g*0.7},${BETELGEUSE.rgb.b*0.5},${op*0.3*b})`);
        g.addColorStop(1, 'rgba(0,0,0,0)');
        ctx.strokeStyle = g; ctx.lineWidth = 1;
        ctx.beginPath(); ctx.moveTo(cx, cy); ctx.lineTo(cx+Math.cos(ang)*len, cy+Math.sin(ang)*len); ctx.stroke();
    });
    ctx.restore();
}

// ═══════════════════════════════════════════════════════════════════════════════════════════════
// ZOOM & DISPLAY FUNCTIONS
// ═══════════════════════════════════════════════════════════════════════════════════════════════

function getApparentDistance(z) {
    const min = BETELGEUSE_RADIUS_KM*5, max = BETELGEUSE.distance_ly*LY_TO_KM;
    return max * Math.pow(min/max, Math.pow(z/100, 2));
}

function formatDistance(km) {
    const ly = km/LY_TO_KM, au = km/1.496e8, sr = km/SOLAR_RADIUS_KM, br = km/BETELGEUSE_RADIUS_KM;
    if (ly > 1) return ly.toFixed(1)+' ly';
    if (au > 500) return Math.floor(au).toLocaleString()+' AU';
    if (au > 10) return au.toFixed(0)+' AU';
    if (sr > 1000) return (sr/1000).toFixed(1)+'k R☉';
    if (br > 10) return br.toFixed(0)+' R*';
    return br.toFixed(1)+' R*';
}

function getZoomLabel(z) {
    if (z < 5) return 'Earth View';
    if (z < 20) return 'Interstellar';
    if (z < 40) return 'Approaching';
    if (z < 60) return 'Near Star';
    if (z < 80) return 'Photosphere';
    return 'Surface Detail';
}

function updateZoomDisplay() {
    document.getElementById('distance-display').textContent = formatDistance(getApparentDistance(zoomLevel));
    document.getElementById('zoom-label').textContent = getZoomLabel(zoomLevel);
    document.getElementById('zoom-slider').value = zoomLevel;
}

function updateDisplays() {
    document.getElementById('display-ruptures').textContent = displayRuptures.toLocaleString();
    document.getElementById('pulsation-ruptures').textContent = pulsationCycles.toLocaleString();
    document.getElementById('cell-cycles').textContent = cellCycles.toLocaleString();
    document.getElementById('current-brightness').textContent = (currentBrightness*(1-ejectionOpacity*0.6)*100).toFixed(1)+'%';
    document.getElementById('current-radius').textContent = Math.round(BETELGEUSE.radius_solar*currentRadiusFactor);
    document.getElementById('session-coherence').textContent = sessionCoherence.toFixed(2);
    document.getElementById('coherence-live').textContent = sessionCoherence.toFixed(4);
    document.getElementById('memory-weight').textContent = Math.exp(Math.min(sessionCoherence/OMEGA_SO2, 10)).toFixed(4);
    document.getElementById('rupture-count').textContent = (displayRuptures+pulsationCycles+cellCycles).toLocaleString();
    const pd = ((pulsationPhase%(Math.PI*2))/(Math.PI*2)*360).toFixed(0);
    document.getElementById('pulsation-phase').textContent = pd+'°';
    const rv = ((currentRadiusFactor-1)*100).toFixed(1);
    document.getElementById('radius-variation').textContent = (rv>=0?'+':'')+rv+'%';
    const pp = (Math.sin(pulsationPhase)+1)/2*100;
    document.getElementById('pulsation-bar-fill').style.width = pp+'%';
    document.getElementById('pulsation-percent').textContent = pp.toFixed(0)+'%';
    
    // Physics overlay updates
    document.getElementById('physics-cell-cycles').textContent = cellCycles;
    document.getElementById('physics-pulsation').textContent = `Phase: ${pd}° | R: ${Math.round(BETELGEUSE.radius_solar*currentRadiusFactor)} R☉`;
    document.getElementById('physics-ejection').textContent = ejectionActive ? '⚠ ACTIVE - '+Math.round(ejectionOpacity*100)+'% dimming' : 'QUIESCENT';
    document.getElementById('physics-ejection').style.color = ejectionActive ? '#f55' : '#7f7';
}

// ═══════════════════════════════════════════════════════════════════════════════════════════════
// ANIMATION & CONTROLS
// ═══════════════════════════════════════════════════════════════════════════════════════════════

function animate(ts) {
    const t = (Date.now()-startTime)/1000;
    const dt = ts - (lastFrameTime||ts);
    lastFrameTime = ts;
    
    zoomLevel += (targetZoom-zoomLevel)*0.06;
    updateZoomDisplay();
    
    sessionCoherence += dt/1000;
    displayRuptures = Math.floor(t/TAU_DISPLAY);
    
    computePulsation(t);
    updateGiantCells(dt, t);
    updateDustEnvelope(dt);
    checkMassEjection(dt/1000);
    
    drawBetelgeuse(t);
    updateDisplays();
    
    requestAnimationFrame(animate);
}

function setupControls() {
    const slider = document.getElementById('zoom-slider');
    slider.addEventListener('input', e => { targetZoom = parseFloat(e.target.value); });
    document.getElementById('zoom-in').addEventListener('click', () => { targetZoom = Math.min(100, targetZoom+10); });
    document.getElementById('zoom-out').addEventListener('click', () => { targetZoom = Math.max(0, targetZoom-10); });
    document.addEventListener('keydown', e => {
        if (e.key==='ArrowUp'||e.key==='=') targetZoom = Math.min(100, targetZoom+5);
        else if (e.key==='ArrowDown'||e.key==='-') targetZoom = Math.max(0, targetZoom-5);
        else if (e.key==='Home') targetZoom = 0;
        else if (e.key==='End') targetZoom = 100;
        else if (e.key==='p'||e.key==='P') togglePhysicsOverlay();
    });
    canvas.addEventListener('wheel', e => {
        e.preventDefault();
        targetZoom = Math.max(0, Math.min(100, targetZoom + (e.deltaY>0?-5:5)));
    });
}

function togglePhysicsOverlay() {
    const overlay = document.getElementById('physics-overlay');
    const toggle = document.getElementById('physics-toggle');
    overlay.classList.toggle('visible');
    toggle.classList.toggle('hidden');
}

function init() {
    createStarField();
    initGiantCells();
    initDustEnvelope();
    setupControls();
    setTimeout(() => { document.getElementById('loading').classList.add('hidden'); }, 1200);
    requestAnimationFrame(animate);
    console.log('CRR Star: Betelgeuse initialized with physics overlay');
    console.log('Press P to toggle physics panel');
}

init();
    </script>
</body>
</html>
