<!DOCTYPE html>
<html lang="en-GB">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CRR Framework: Mathematical Foundations</title>
    
    <script>
    MathJax = {
        tex: {
            inlineMath: [['$', '$']],
            displayMath: [['$$', '$$']],
            processEscapes: true,
            processEnvironments: true,
            tags: 'ams'
        }
    };
    </script>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Palatino Linotype', 'Book Antiqua', Palatino, serif;
            line-height: 1.8;
            color: #1a1a1a;
            background: #f0f0f0;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            box-shadow: 0 0 30px rgba(0,0,0,0.1);
            min-height: 100vh;
        }
        
        .header-info {
            background: #1a1a1a;
            color: white;
            padding: 40px 60px;
            border-bottom: 3px solid #c9a227;
        }
        
        .header-info h1 {
            font-size: 2.4em;
            margin-bottom: 0.3em;
            font-weight: 400;
            letter-spacing: 1px;
            color: white;
        }
        
        .header-info p {
            font-size: 1.1em;
            color: #ccc;
            margin: 0.5em 0;
            font-style: italic;
        }
        
        .tabs {
            display: flex;
            background: #2a2a2a;
            position: sticky;
            top: 0;
            z-index: 1000;
            flex-wrap: wrap;
        }
        
        .tab-button {
            flex: 1;
            min-width: 120px;
            padding: 18px 16px;
            background: #2a2a2a;
            color: #ccc;
            border: none;
            cursor: pointer;
            font-size: 13px;
            transition: all 0.3s;
            font-family: inherit;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .tab-button:hover {
            background: #3a3a3a;
            color: white;
        }
        
        .tab-button.active {
            background: #c9a227;
            color: #1a1a1a;
            font-weight: 600;
        }
        
        .tab-content {
            display: none;
            padding: 50px 60px;
        }
        
        .tab-content.active {
            display: block;
        }
        
        h2 {
            font-size: 1.6em;
            margin: 1.5em 0 0.8em;
            color: #1a1a1a;
            border-bottom: 2px solid #c9a227;
            padding-bottom: 0.3em;
            font-weight: 400;
        }
        
        h2:first-child { margin-top: 0; }
        
        h3 {
            font-size: 1.3em;
            margin: 1.2em 0 0.6em;
            color: #333;
            font-weight: 600;
        }
        
        p {
            margin-bottom: 1.2em;
            text-align: justify;
        }
        
        .definition, .theorem, .proposition, .remark, .assumption {
            background: #fafafa;
            border: 1px solid #ddd;
            padding: 20px 25px;
            margin: 1.5em 0;
        }
        
        .assumption {
            background: #fef8f0;
            border-color: #e0c090;
        }
        
        .theorem {
            background: #f0f5fa;
            border-color: #a0b8d0;
        }
        
        .proposition {
            background: #f0faf5;
            border-color: #90c0a0;
        }
        
        .remark {
            background: #f7fafc;
            border-color: #b0b8c0;
        }
        
        .warning-box {
            background: #fff8e6;
            border: 1px solid #e0c060;
            padding: 20px 25px;
            margin: 1.5em 0;
        }
        
        .critical-box {
            background: #fef0f0;
            border: 1px solid #e0a0a0;
            padding: 20px 25px;
            margin: 1.5em 0;
        }
        
        .success-box {
            background: #f0fef0;
            border: 1px solid #90c090;
            padding: 20px 25px;
            margin: 1.5em 0;
        }
        
        .layperson-box {
            background: #f8fbfe;
            border: 1px solid #b0c8e0;
            padding: 20px 25px;
            margin: 1.5em 0;
        }
        
        .env-title {
            font-weight: 600;
            margin-bottom: 0.5em;
            color: #1a1a1a;
        }
        
        .equation-box {
            background: #f8f8f8;
            border: 1px solid #ddd;
            padding: 20px;
            margin: 1.5em 0;
            text-align: center;
            border-radius: 4px;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 1.5em 0;
        }
        
        th {
            background: #1a1a1a;
            color: white;
            padding: 12px 15px;
            text-align: left;
            font-weight: 400;
        }
        
        td {
            padding: 10px 15px;
            border-bottom: 1px solid #ddd;
        }
        
        tr:nth-child(even) {
            background: #f8f8f8;
        }
        
        ul, ol {
            margin-left: 2em;
            margin-bottom: 1.2em;
        }
        
        li {
            margin-bottom: 0.5em;
        }
        
        .proof {
            margin: 1em 0 1em 2em;
            font-style: italic;
        }
        
        .proof::before {
            content: "Proof. ";
            font-style: italic;
            font-weight: 600;
        }
        
        .proof::after {
            content: " ‚ñ°";
            float: right;
        }
        
        code {
            background: #f4f4f4;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Consolas', 'Monaco', monospace;
        }
        
        .citation {
            font-size: 0.9em;
            color: #555;
        }
        
        .references {
            font-size: 0.95em;
        }
        
        .references p {
            margin-bottom: 0.8em;
            padding-left: 2em;
            text-indent: -2em;
        }
        
        /* Simulation styles */
        .sim-container {
            border: 2px solid #1a1a1a;
            padding: 20px;
            margin: 1.5em 0;
            background: #fafafa;
        }
        
        .omega-control, .precision-control {
            text-align: center;
            padding: 20px;
            border: 2px solid #c9a227;
            margin-bottom: 20px;
            background: white;
        }
        
        .omega-value, .precision-value {
            font-size: 2.2rem;
            font-weight: bold;
        }
        
        .omega-label, .precision-label {
            font-size: 0.85rem;
            color: #666;
            margin-bottom: 12px;
        }
        
        .omega-control input[type="range"],
        .precision-control input[type="range"] {
            width: 80%;
            max-width: 500px;
            margin: 10px 0;
        }
        
        .regime-label {
            font-size: 1rem;
            font-weight: bold;
            margin-top: 8px;
            padding: 8px 20px;
            display: inline-block;
            border-radius: 3px;
        }
        
        .regime-i { background: #d0e0f0; color: #1a4a7a; }
        .regime-crit { background: #d0f0d0; color: #1a6a1a; }
        .regime-e { background: #f0d0d0; color: #7a1a1a; }
        
        .sim-figures {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        @media (max-width: 768px) {
            .tab-content { padding: 30px 20px; }
            .header-info { padding: 20px; }
            .header-info h1 { font-size: 1.8em; }
            .tab-button { padding: 12px 8px; font-size: 11px; min-width: 80px; }
            .sim-figures { grid-template-columns: 1fr; }
        }
        
        .sim-figure {
            border: 1px solid #ccc;
            padding: 12px;
            background: white;
        }
        
        .sim-figure-title {
            font-weight: bold;
            font-size: 0.9rem;
            margin-bottom: 8px;
            border-bottom: 1px solid #ddd;
            padding-bottom: 5px;
        }
        
        .sim-figure canvas {
            display: block;
            width: 100%;
        }
        
        .sim-figure-caption {
            font-size: 0.8rem;
            margin-top: 8px;
            color: #444;
            line-height: 1.4;
        }
        
        .sim-figure-full {
            grid-column: 1 / -1;
        }
        
        .state-box {
            border: 2px solid #1a1a1a;
            padding: 15px 20px;
            margin-bottom: 20px;
            min-height: 100px;
            background: white;
        }
        
        .state-box h4 {
            font-size: 1rem;
            margin-bottom: 8px;
        }
        
        .state-box p {
            font-size: 0.9rem;
            margin-bottom: 6px;
            text-align: left;
        }
        
        .state-box .mechanism {
            font-style: italic;
            color: #444;
        }
        
        .correspondence-table td:first-child {
            font-weight: 600;
            background: #f8f8f8;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header-info">
            <h1>Coherence‚ÄìRupture‚ÄìRegeneration</h1>
            <p>Mathematical Foundations for Non-Markovian Dynamics with Threshold-Triggered Discontinuities</p>
            <p style="font-size: 0.95em; margin-top: 1.5em; opacity: 0.8;">A. Sabine ¬∑ Cohere Research ¬∑ Version 5.1 ¬∑ January 2026</p>
        </div>
        
        <div class="tabs">
            <button class="tab-button active" onclick="openTab(event, 'overview')">Overview</button>
            <button class="tab-button" onclick="openTab(event, 'foundations')">Foundations</button>
            <button class="tab-button" onclick="openTab(event, 'mechanism')">Regeneration</button>
            <button class="tab-button" onclick="openTab(event, 'ei')">E-I Criticality</button>
            <button class="tab-button" onclick="openTab(event, 'fep')">FEP Connection</button>
            <button class="tab-button" onclick="openTab(event, 'empirical')">Empirical</button>
        </div>

        <!-- OVERVIEW TAB -->
        <div id="overview" class="tab-content active">
            <h2>What is CRR? A Plain-Language Introduction</h2>
            
            <div class="layperson-box">
                <div class="env-title">üí° The Core Idea</div>
                <p>Imagine how your experience of the present moment works. You don't experience time as a smooth flow‚Äîyou experience distinct "nows," each one feeling complete before giving way to the next. William James called these "perchings" and "flights" of consciousness.</p>
                <p>CRR proposes that this pattern‚Äî<strong>build up, break, rebuild</strong>‚Äîis a universal signature of how complex systems navigate time. It happens in your brain, in your body's healing, in how groups form and reform, and perhaps even in the structure of physics itself.</p>
            </div>
            
            <h3>The Three Phases</h3>
            
            <div class="layperson-box">
                <div class="env-title">üí° Coherence: Building Up</div>
                <p>Think of coherence as "accumulating constraint." As you read this sentence, your brain is integrating information‚Äîwords build on words, meaning accumulates. You're not just perceiving isolated letters; you're building a coherent understanding.</p>
                <p>Mathematically, coherence is like filling a bucket. Drop by drop, experience accumulates until the bucket reaches capacity.</p>
            </div>
            
            <div class="layperson-box">
                <div class="env-title">üí° Rupture: The Breaking Point</div>
                <p>When the bucket is full, it tips over. This is rupture‚Äîthe discrete moment when accumulated coherence reaches threshold and the system must reorganise.</p>
                <p>In consciousness, this might be the moment you "get" a sentence, when the meaning clicks into place. In wound healing, it's the moment when accumulated cellular signals trigger the next phase. In groups, it's the decisive moment when accumulated tension forces change.</p>
                <p><strong>The key insight:</strong> Rupture is when the "inside" (your accumulated understanding) finally matches the "outside" (reality's demands). At this moment, you can <em>write</em> to memory‚Äîthis is the <strong>write window</strong>.</p>
            </div>
            
            <div class="layperson-box">
                <div class="env-title">üí° Regeneration: Selective Rebuilding</div>
                <p>After rupture, the system doesn't start from scratch. It rebuilds using its history‚Äîbut not all history equally. Moments of high coherence contribute more to what comes next; moments of low coherence fade away.</p>
                <p>This is why significant experiences shape you more than forgettable ones. The mathematics describes exactly how history is weighted: recent high-coherence moments matter most.</p>
            </div>
            
            <h2>The Single Parameter: Œ©</h2>
            
            <div class="layperson-box">
                <div class="env-title">üí° One Dial, Many Effects</div>
                <p>The framework has one central parameter: <strong>Œ©</strong> (omega). Think of it as a dial between "rigid" and "flexible":</p>
                <ul>
                    <li><strong>Low Œ© (rigid):</strong> System ruptures frequently, holds tight patterns, resists change. Only the most intense experiences survive into regeneration. Like an anxious mind‚Äîhypervigilant, unable to relax.</li>
                    <li><strong>High Œ© (flexible):</strong> System ruptures rarely, holds loose patterns, transforms easily. All of history contributes to regeneration. Like a dreaming mind‚Äîassociations flow freely, boundaries dissolve.</li>
                    <li><strong>Œ© ‚âà 1 (critical):</strong> The sweet spot. System is maximally sensitive, maximally organised. This is where consciousness operates when you're fully awake and present.</li>
                </ul>
            </div>
            
            <h2>Where Does This Come From?</h2>
            
            <p>CRR builds on cutting-edge neuroscience, particularly the work of <strong>Don Tucker, Phan Luu, and Karl Friston</strong> on how the brain balances excitation (E) and inhibition (I). Their research shows that consciousness emerges when E and I are perfectly balanced‚Äîat <em>criticality</em>.</p>
            
            <p>CRR proposes that their two parameters (E and I) collapse into one (Œ©), and provides the temporal dynamics‚Äîthe <em>process</em>‚Äîby which this balance is achieved and maintained moment by moment.</p>
            
            <div class="success-box">
                <div class="env-title">Why Does This Matter?</div>
                <p>If CRR is correct, it provides:</p>
                <ul>
                    <li>A unified language for dynamics across scales (cells, brains, societies)</li>
                    <li>Testable predictions about timing and variability</li>
                    <li>A bridge between physics, biology, and psychology</li>
                    <li>A formal account of what it <em>feels like</em> to be in time</li>
                </ul>
            </div>
            
            <h2>Navigate This Document</h2>
            
            <p>Use the tabs above to explore:</p>
            <ul>
                <li><strong>Foundations:</strong> The rigorous mathematical definitions</li>
                <li><strong>Regeneration:</strong> How the memory mechanism works</li>
                <li><strong>E-I Criticality:</strong> Interactive simulation of brain dynamics</li>
                <li><strong>FEP Connection:</strong> How CRR relates to Active Inference and the Free Energy Principle</li>
                <li><strong>Empirical:</strong> Testable predictions and current evidence</li>
            </ul>
        </div>

        <!-- FOUNDATIONS TAB -->
        <div id="foundations" class="tab-content">
            <h2>1. Standing Assumptions</h2>
            
            <div class="assumption">
                <div class="env-title">Assumption (A1) Regularity</div>
                <p>For each $x$ and $t$, the function $\tau \mapsto \mathcal{L}(x,\tau)$ is locally integrable on $[0,t]$.</p>
            </div>
            
            <div class="assumption">
                <div class="env-title">Assumption (A2) Non-negativity</div>
                <p>$\mathcal{L}(x,\tau) \geq 0$ for all $x, \tau$. History accumulates; it does not spontaneously dissipate.</p>
            </div>
            
            <div class="assumption">
                <div class="env-title">Assumption (A6) Bounded Rate (No-Zeno Condition)</div>
                <p>There exists $M > 0$ such that $\mathcal{L}(x,t) \leq M$ for all $x, t$. This ensures each coherence cycle has duration at least $\Omega/M$, preventing infinitely many ruptures in finite time.</p>
            </div>
            
            <h2>2. Core Definitions</h2>
            
            <div class="definition">
                <div class="env-title">Definition 1 (Mnemonic Entanglement Rate)</div>
                <p>The <em>mnemonic entanglement rate</em> is a function $\mathcal{L} : \mathcal{X} \times [0,T] \to \mathbb{R}_{\geq 0}$ that assigns to each state-time pair $(x,\tau)$ a rate of coherence accumulation.</p>
                <p><strong>Dimensions:</strong> $[\mathcal{L}] = [T^{-1}]$ (a rate, so that $\int \mathcal{L}\, d\tau$ is dimensionless).</p>
            </div>
            
            <div class="critical-box">
                <div class="env-title">Critical Distinction: Archival vs Active Coherence</div>
                <p>CRR requires <strong>two distinct coherence quantities</strong> to resolve the tension between:</p>
                <ul>
                    <li><strong>Memory</strong>: Regeneration must access the full historical record (never resets)</li>
                    <li><strong>Rupture</strong>: The triggering accumulator must reset (otherwise, system immediately re-ruptures)</li>
                </ul>
            </div>
            
            <div class="definition">
                <div class="env-title">Definition 2 (Archival Coherence)</div>
                <p>The <em>archival coherence</em> at state $x$ and time $t$ is the total accumulated constraint from the origin:</p>
                <div class="equation-box">
                    $$\mathcal{A}(x,t) := \int_0^t \mathcal{L}(x,\tau) \, d\tau$$
                </div>
                <p><strong>Properties:</strong> Dimensionless, globally monotone non-decreasing, continuous everywhere, <strong>never resets</strong>.</p>
            </div>
            
            <div class="definition">
                <div class="env-title">Definition 3 (Active Coherence)</div>
                <p>Let $t_j$ denote the most recent rupture time before $t$ (with $t_0 = 0$). The <em>active coherence</em> is:</p>
                <div class="equation-box">
                    $$c(x,t) := \mathcal{A}(x,t) - \mathcal{A}(x,t_j) = \int_{t_j}^t \mathcal{L}(x,\tau) \, d\tau$$
                </div>
                <p><strong>Properties:</strong> Dimensionless, monotone within each cycle, <strong>resets to 0 at each rupture</strong>.</p>
            </div>
            
            <div class="definition">
                <div class="env-title">Definition 4 (Threshold Parameter)</div>
                <p>The <em>threshold parameter</em> $\Omega > 0$ is a positive dimensionless constant characterising the system's capacity for coherence accumulation before structural change becomes necessary.</p>
            </div>
            
            <div class="definition">
                <div class="env-title">Definition 5 (Rupture)</div>
                <p>A <em>rupture</em> occurs at time $t_*$ when active coherence reaches threshold:</p>
                <div class="equation-box">
                    $$t_* := \inf\{t > t_j : c(x,t) \geq \Omega\}$$
                </div>
                <p>The rupture event is represented by a Dirac delta $\delta(t - t_*)$. Following rupture: $c(x, t_*^+) = 0$.</p>
            </div>
            
            <div class="definition">
                <div class="env-title">Definition 6 (Regeneration) ‚Äî Normalised Form</div>
                <p>The <em>regeneration operator</em> uses <strong>archival coherence</strong> for weighting:</p>
                <div class="equation-box">
                    $$\mathcal{R}(x,t) := \frac{\displaystyle\int_0^t \Phi(x,\tau) \cdot e^{\mathcal{A}(x,\tau)/\Omega} \, d\tau}{\displaystyle\int_0^t e^{\mathcal{A}(x,\tau)/\Omega} \, d\tau}$$
                </div>
            </div>
            
            <div class="critical-box">
                <div class="env-title">Critical: Uses $\mathcal{A}(x,\tau)$, not $\mathcal{A}(x,t)$</div>
                <p>The regeneration integral contains $\mathcal{A}(x,\tau)$‚Äîthe archival coherence <strong>at each historical moment $\tau$</strong>‚Äînot $\mathcal{A}(x,t)$. Using $\mathcal{A}(x,t)$ would reduce to an unweighted average, destroying the memory mechanism.</p>
            </div>
            
            <h2>3. Key Properties</h2>
            
            <div class="theorem">
                <div class="env-title">Theorem (No Zeno Pathology)</div>
                <p>Under (A6), each coherence cycle has duration at least $\Omega/M$. Hence the number of ruptures in any finite interval $[0,T]$ is at most $\lfloor TM/\Omega \rfloor + 1 < \infty$.</p>
            </div>
            
            <h2>4. Dimensional Analysis Summary</h2>
            
            <table>
                <tr>
                    <th>Quantity</th>
                    <th>Symbol</th>
                    <th>Dimensions</th>
                </tr>
                <tr><td>Mnemonic rate</td><td>$\mathcal{L}$</td><td>$[T^{-1}]$</td></tr>
                <tr><td>Archival coherence</td><td>$\mathcal{A}$</td><td>dimensionless</td></tr>
                <tr><td>Active coherence</td><td>$c$</td><td>dimensionless</td></tr>
                <tr><td>Threshold</td><td>$\Omega$</td><td>dimensionless</td></tr>
                <tr><td>Historical field</td><td>$\Phi$</td><td>[F]</td></tr>
                <tr><td>Regeneration</td><td>$\mathcal{R}$</td><td>[F]</td></tr>
            </table>
        </div>

        <!-- REGENERATION MECHANISM TAB -->
        <div id="mechanism" class="tab-content">
            <h2>1. The Regeneration Mechanism</h2>
            
            <div class="layperson-box">
                <div class="env-title">üí° In Plain Language</div>
                <p>When a system regenerates after rupture, it doesn't treat all of history equally. Important moments (high coherence) contribute more to what comes next; forgettable moments (low coherence) fade away.</p>
                <p>It's like how your memories of significant events shape who you are more than memories of ordinary days.</p>
            </div>
            
            <h3>1.1 Weight Function</h3>
            
            <div class="definition">
                <div class="env-title">Definition (Coherence Weight)</div>
                <p>Define the normalised weight function:</p>
                <div class="equation-box">
                    $$w(\tau; t) := \frac{e^{\mathcal{A}(x,\tau)/\Omega}}{Z(t)} \quad \text{where} \quad Z(t) := \int_0^t e^{\mathcal{A}(x,s)/\Omega} \, ds$$
                </div>
            </div>
            
            <div class="proposition">
                <div class="env-title">Proposition (Weight Properties)</div>
                <ol>
                    <li>$w(\tau; t) \geq 0$ for all $\tau \in [0,t]$</li>
                    <li>$\int_0^t w(\tau; t) \, d\tau = 1$ (normalisation)</li>
                    <li>$w$ is monotonically non-decreasing in $\tau$ (later moments have higher weight)</li>
                </ol>
            </div>
            
            <h3>1.2 Œ©-Regime Behaviour</h3>
            
            <div class="remark">
                <div class="env-title">Remark (Temperature Analogy)</div>
                <p>$\Omega$ plays the role of "temperature" in the Boltzmann weighting:</p>
                <ul>
                    <li><strong>Low $\Omega$:</strong> Weights concentrate on high-coherence moments‚Äîrigid reconstitution</li>
                    <li><strong>High $\Omega$:</strong> Weights spread uniformly‚Äîtransformative reconstitution</li>
                </ul>
            </div>
            
            <h3>1.3 Euler Calibration</h3>
            
            <div class="success-box">
                <div class="env-title">Euler Calibration</div>
                <p>At rupture, active coherence equals threshold: $c(x, t_*) = \Omega$.</p>
                <p>Therefore, the rupture moment contributes with weight proportional to:</p>
                $$e^{c(x,t_*)/\Omega} = e^{\Omega/\Omega} = e \approx 2.718$$
            </div>
            
            <h2>2. Non-Markovian Signature</h2>
            
            <div class="theorem">
                <div class="env-title">Theorem (Path Dependence)</div>
                <p>Two systems with identical current coherence but different histories will in general have different regenerations.</p>
            </div>
            
            <div class="layperson-box">
                <div class="env-title">üí° What This Means</div>
                <p>History matters, not just its summary. Two people at the same point in life but with different histories will respond differently to the same challenge. CRR captures this mathematically.</p>
            </div>
        </div>

        <!-- E-I CRITICALITY TAB -->
        <div id="ei" class="tab-content">
            <h2>E-I Balance and the Write Window</h2>
            
            <div class="layperson-box">
                <div class="env-title">üí° The Brain's Balancing Act</div>
                <p>Your brain constantly balances two opposing forces: <strong>excitation</strong> (generating predictions, expanding associations) and <strong>inhibition</strong> (correcting errors, constraining activity). Tucker, Luu, and Friston (2025) show that consciousness emerges when these forces are <em>perfectly balanced</em>‚Äîat criticality.</p>
                <p>CRR proposes that their two parameters (E and I) collapse into a single parameter Œ©. When <strong>C = Œ©</strong>, the inside matches the outside‚Äîthis is the <strong>write window</strong>, where early long-term potentiation (LTP) can occur and experiences become memories.</p>
            </div>
            
            <div class="sim-container">
                <div class="omega-control">
                    <div class="omega-value">Œ© = <span id="omegaVal">1.00</span></div>
                    <div class="omega-label">Temporal Integration Depth = 1/Precision</div>
                    <input type="range" id="omegaSlider" min="0.25" max="2.5" step="0.01" value="1.0">
                    <div><span id="regimeLabel" class="regime-label regime-crit">E ‚âà I ‚Äî CRITICALITY</span></div>
                </div>
                
                <div class="state-box" id="stateBox">
                    <h4>At Criticality (E = I, Œ© ‚âà 1)</h4>
                    <p><strong>Oscillatory:</strong> Theta waves (excitatory) and gamma/beta waves (inhibitory) meet and halt each other ‚Üí standing wave resonance.</p>
                    <p><strong>Plasticity:</strong> The resonance plateau lasts ~100-200ms‚Äîlong enough for early LTP. This is the write window.</p>
                    <p><strong>CRR:</strong> Coherence C has reached threshold Œ©. The rupture Œ¥(now) fires. The pattern is inscribed.</p>
                    <p class="mechanism">Phenomenology: James's "perchings"‚Äîthe felt now, coherently given, briefly held, then reorganised.</p>
                </div>
                
                <div class="sim-figures">
                    <div class="sim-figure">
                        <div class="sim-figure-title">A. E and I as Functions of Œ©</div>
                        <canvas id="mappingCanvas" height="180"></canvas>
                        <div class="sim-figure-caption">
                            E ‚àù Œ© (red): excitatory, theta-driven<br>
                            I ‚àù 1/Œ© (blue): inhibitory, gamma/beta-driven
                        </div>
                    </div>
                    
                    <div class="sim-figure">
                        <div class="sim-figure-title">B. Memory Weighting exp(C/Œ©)</div>
                        <canvas id="weightingCanvas" height="180"></canvas>
                        <div class="sim-figure-caption">
                            Low Œ©: sharply peaked (selective)<br>
                            High Œ©: broadly uniform (integrative)
                        </div>
                    </div>
                    
                    <div class="sim-figure">
                        <div class="sim-figure-title">C. CRR Dynamics</div>
                        <canvas id="crrCanvas" height="180"></canvas>
                        <div class="sim-figure-caption">
                            C(t) accumulates until C = Œ© ‚Üí rupture ‚Üí reset
                        </div>
                    </div>
                    
                    <div class="sim-figure">
                        <div class="sim-figure-title">D. Write Window Duration</div>
                        <canvas id="windowCanvas" height="180"></canvas>
                        <div class="sim-figure-caption">
                            Window peaks at criticality (Œ© ‚âà 1)
                        </div>
                    </div>
                </div>
            </div>
            
            <h2>The Tucker-Luu-Friston Framework</h2>
            
            <h3>Dual Limbic Systems</h3>
            
            <table>
                <tr>
                    <th>System</th>
                    <th>Dorsal (Papez)</th>
                    <th>Ventral (Yakovlev)</th>
                </tr>
                <tr>
                    <td>Control Mode</td>
                    <td>Excitatory feedforward</td>
                    <td>Inhibitory feedback</td>
                </tr>
                <tr>
                    <td>Sleep Consolidation</td>
                    <td>REM</td>
                    <td>NREM</td>
                </tr>
                <tr>
                    <td>Arousal Pathway</td>
                    <td>Lemnothalamic (phasic)</td>
                    <td>Collothalamic (tonic)</td>
                </tr>
                <tr>
                    <td>Affective Tone</td>
                    <td>Elation</td>
                    <td>Anxiety</td>
                </tr>
                <tr>
                    <td>CRR Mapping</td>
                    <td>High Œ©</td>
                    <td>Low Œ©</td>
                </tr>
            </table>
            
            <h3>Oscillatory Implementation</h3>
            
            <table>
                <tr>
                    <th>Oscillation</th>
                    <th>Frequency</th>
                    <th>CRR Role</th>
                    <th>FEP Role</th>
                </tr>
                <tr>
                    <td>Theta (Œ∏)</td>
                    <td>~7 Hz</td>
                    <td>Accumulation clock</td>
                    <td>Evidence integration rate</td>
                </tr>
                <tr>
                    <td>Gamma (Œ≥)</td>
                    <td>30‚Äì100 Hz</td>
                    <td>Coherence content</td>
                    <td>Prediction error signals</td>
                </tr>
                <tr>
                    <td>Beta (Œ≤)</td>
                    <td>~20 Hz</td>
                    <td>Threshold enforcer</td>
                    <td>Precision maintenance</td>
                </tr>
            </table>
            
            <div class="success-box">
                <div class="env-title">The Write Window: When C = Œ©</div>
                <p>At rupture, when accumulated coherence C exactly equals the threshold Œ©:</p>
                <ul>
                    <li>The "inside" (internal model's accumulated evidence) matches the "outside" (reality's threshold)</li>
                    <li>E and I are balanced‚Äîneither wins</li>
                    <li>A standing wave resonance forms, lasting ~100-200ms</li>
                    <li>This is sufficient for early LTP‚Äîthe write window opens</li>
                    <li>The pattern is inscribed; memory forms</li>
                </ul>
                <p>This is the neural mechanism for James's "perchings"‚Äîthe discrete moments of conscious experience.</p>
            </div>
        </div>

        <!-- FEP CONNECTION TAB -->
        <div id="fep" class="tab-content">
            <h2>1. CRR as Process Theory for Active Inference</h2>
            
            <div class="layperson-box">
                <div class="env-title">üí° What is the Free Energy Principle?</div>
                <p>The Free Energy Principle (FEP), developed by Karl Friston, proposes that living systems survive by minimising "free energy"‚Äîroughly, the mismatch between what they expect and what they experience. Brains are prediction machines, constantly generating expectations and updating them when reality surprises them.</p>
                <p>CRR provides the <em>temporal dynamics</em> that FEP presupposes but doesn't fully specify: <strong>when</strong> do beliefs update? <strong>How</strong> does history shape reconstitution?</p>
            </div>
            
            <h3>1.1 The Central Correspondence</h3>
            
            <table class="correspondence-table">
                <tr>
                    <th>Question</th>
                    <th>FEP Answer</th>
                    <th>CRR Extension</th>
                </tr>
                <tr>
                    <td>What do beliefs update to?</td>
                    <td>Free energy minimum</td>
                    <td>(Presupposed)</td>
                </tr>
                <tr>
                    <td>When does updating occur?</td>
                    <td>(Not explicit)</td>
                    <td>When $c(x,t) \geq \Omega$</td>
                </tr>
                <tr>
                    <td>How does history shape reconstitution?</td>
                    <td>(Not explicit)</td>
                    <td>Via $\mathcal{R} = \mathbb{E}_w[\Phi]$</td>
                </tr>
                <tr>
                    <td>What triggers discrete insight?</td>
                    <td>Bayesian Model Reduction</td>
                    <td>Rupture $\delta(t - t_*)$</td>
                </tr>
            </table>
            
            <h2>2. Rupture IS Occam's Razor</h2>
            
            <div class="layperson-box">
                <div class="env-title">üí° The "Aha Moment" Correspondence</div>
                <p>In Friston et al. (2025) "Active Inference and Artificial Reasoning," an <strong>"aha moment"</strong> occurs when evidence accumulates until confidence in one hypothesis exceeds a threshold, triggering Bayesian Model Reduction‚Äîthe application of Occam's Razor.</p>
                <p>CRR's <strong>Rupture</strong> is the same phenomenon: coherence accumulates until it reaches threshold Œ©, triggering a discrete state commitment. The mathematical structures are isomorphic.</p>
            </div>
            
            <div class="theorem">
                <div class="env-title">Theorem (Rupture-BMR Isomorphism)</div>
                <p>CRR Rupture and Bayesian Model Reduction (BMR) share the following structure:</p>
                <ol>
                    <li><strong>Accumulation:</strong> Evidence/coherence accumulates over time</li>
                    <li><strong>Threshold:</strong> A criterion determines when commitment occurs</li>
                    <li><strong>Discrete transition:</strong> The system jumps to a new state</li>
                    <li><strong>Reconstitution:</strong> Beliefs/field values are updated based on history</li>
                </ol>
            </div>
            
            <h3>2.1 Mathematical Correspondence</h3>
            
            <table class="correspondence-table">
                <tr>
                    <th>CRR Concept</th>
                    <th>FEP/Active Inference Concept</th>
                    <th>Mathematical Mapping</th>
                </tr>
                <tr>
                    <td>Archival Coherence $\mathcal{A}(x,t)$</td>
                    <td>Accumulated Log Evidence</td>
                    <td>$\mathcal{A} \leftrightarrow \sum_i \log p(o_i|s,m)$</td>
                </tr>
                <tr>
                    <td>Active Coherence $c(x,t)$</td>
                    <td>Evidence since last update</td>
                    <td>$c \leftrightarrow \log p(D_{\text{new}}|m)$</td>
                </tr>
                <tr>
                    <td>Threshold $\Omega$</td>
                    <td>Model selection threshold $\theta$</td>
                    <td>$\Omega \leftrightarrow \theta$</td>
                </tr>
                <tr>
                    <td>Rupture $\delta(t-t_*)$</td>
                    <td>BMR / Occam's Razor</td>
                    <td>$\{c \geq \Omega\} \leftrightarrow \{\max_m p(m|D) > \theta\}$</td>
                </tr>
                <tr>
                    <td>Regeneration $\mathcal{R}$</td>
                    <td>Posterior update after BMR</td>
                    <td>$\mathcal{R} \leftrightarrow q(s|m^*)$</td>
                </tr>
            </table>
            
            <h3>2.2 The Key Equations</h3>
            
            <div class="definition">
                <div class="env-title">Definition (Evidence-Coherence Bridge)</div>
                <p>In FEP contexts, the mnemonic entanglement rate can be identified with precision-weighted squared prediction error:</p>
                <div class="equation-box">
                    $$\mathcal{L}(x,t) = \frac{1}{2} \varepsilon(t)^\top \Pi \, \varepsilon(t)$$
                </div>
                <p>where $\varepsilon$ is prediction error and $\Pi$ is precision.</p>
            </div>
            
            <div class="definition">
                <div class="env-title">Definition (Threshold-Precision Correspondence)</div>
                <p>The threshold parameter corresponds to inverse precision:</p>
                <div class="equation-box">
                    $$\Omega = \frac{1}{\pi} = \sigma^2$$
                </div>
                <p>This creates a three-way bridge: geometric ($1/\varphi$), statistical ($\sigma^2$), and inferential ($1/\pi$).</p>
            </div>
            
            <h2>3. Active Inference Simulation</h2>
            
            <div class="sim-container">
                <div class="precision-control">
                    <div class="precision-value">œÄ = <span id="precisionVal">1.00</span></div>
                    <div class="precision-label">Precision (œÄ = 1/Œ©)</div>
                    <input type="range" id="precisionSlider" min="0.4" max="4.0" step="0.01" value="1.0">
                    <div>Œ© = <span id="omegaFromPrecision">1.00</span></div>
                </div>
                
                <div class="state-box" id="fepStateBox">
                    <h4>At Balanced Precision (œÄ ‚âà 1)</h4>
                    <p><strong>Evidence Accumulation:</strong> Prediction errors accumulate at moderate rate.</p>
                    <p><strong>Model Selection:</strong> Neither overly quick (premature commitment) nor overly slow (paralysis).</p>
                    <p><strong>CRR:</strong> Coherence reaches threshold at optimal rate; ruptures neither too frequent nor too rare.</p>
                    <p class="mechanism">This is the "aha moment" regime‚Äîinsight emerges when evidence warrants.</p>
                </div>
                
                <div class="sim-figures">
                    <div class="sim-figure">
                        <div class="sim-figure-title">A. Evidence Accumulation ‚Üí Rupture</div>
                        <canvas id="evidenceCanvas" height="180"></canvas>
                        <div class="sim-figure-caption">
                            Evidence accumulates until threshold Œ© is reached.<br>
                            At threshold: "aha moment" / rupture fires.
                        </div>
                    </div>
                    
                    <div class="sim-figure">
                        <div class="sim-figure-title">B. Posterior Confidence Over Time</div>
                        <canvas id="posteriorCanvas" height="180"></canvas>
                        <div class="sim-figure-caption">
                            Confidence increases with evidence.<br>
                            Discrete jump at rupture = model commitment.
                        </div>
                    </div>
                    
                    <div class="sim-figure">
                        <div class="sim-figure-title">C. Expected Free Energy Components</div>
                        <canvas id="efeCanvas" height="180"></canvas>
                        <div class="sim-figure-caption">
                            Risk (red) + Ambiguity (blue) - Info Gain (green)<br>
                            All modulated by precision œÄ = 1/Œ©
                        </div>
                    </div>
                    
                    <div class="sim-figure">
                        <div class="sim-figure-title">D. Precision-Threshold Relationship</div>
                        <canvas id="precisionOmegaCanvas" height="180"></canvas>
                        <div class="sim-figure-caption">
                            Œ© = 1/œÄ: Low precision ‚Üí high threshold (slow updates)<br>
                            High precision ‚Üí low threshold (quick updates)
                        </div>
                    </div>
                </div>
            </div>
            
            <h2>4. From Friston et al. (2025): Active Reasoning</h2>
            
            <p>In "Active Inference and Artificial Reasoning" (arXiv:2512.21129, 24 December 2025), Friston and colleagues describe how agents:</p>
            
            <ol>
                <li><strong>Accumulate evidence</strong> through active sampling (epistemic foraging)</li>
                <li><strong>Evaluate competing hypotheses</strong> using Bayesian model evidence</li>
                <li><strong>Apply Occam's Razor</strong> when one model's posterior exceeds threshold</li>
                <li><strong>Commit to the selected model</strong> and update behaviour discretely</li>
            </ol>
            
            <p>This is precisely the CRR cycle: Coherence (evidence accumulation) ‚Üí Rupture (Occam's Razor) ‚Üí Regeneration (posterior reconstitution).</p>
            
            <div class="success-box">
                <div class="env-title">The Central Insight</div>
                <p><strong>Rupture IS the "aha moment."</strong></p>
                <p>Both frameworks describe the same phenomenon: the discrete transition from uncertainty to commitment when accumulated evidence warrants model selection. CRR provides the explicit temporal dynamics; FEP provides the inferential interpretation.</p>
                <div class="equation-box">
                    $$\underbrace{c(x,t) \geq \Omega}_{\text{CRR Rupture}} \quad \Longleftrightarrow \quad \underbrace{\max_m p(m|D) > \theta}_{\text{FEP: Occam's Razor}}$$
                </div>
            </div>
            
            <h2>5. References</h2>
            
            <div class="references">
                <p>Friston, K., Da Costa, L., Tschantz, A., Heins, C., Buckley, C., Verbelen, T., & Parr, T. (2025). Active inference and artificial reasoning. <em>arXiv:2512.21129</em>. https://arxiv.org/abs/2512.21129</p>
                
                <p>Friston, K., FitzGerald, T., Rigoli, F., Schwartenbeck, P., & Pezzulo, G. (2017). Active inference: A process theory. <em>Neural Computation</em>, 29(1), 1‚Äì49.</p>
                
                <p>Friston, K., Rigoli, F., Ognibene, D., Mathys, C., Fitzgerald, T., & Pezzulo, G. (2015). Active inference and epistemic value. <em>Cognitive Neuroscience</em>, 6(4), 187‚Äì214.</p>
                
                <p>Parr, T., Pezzulo, G., & Friston, K. J. (2022). <em>Active Inference: The Free Energy Principle in Mind, Brain, and Behavior</em>. MIT Press.</p>
                
                <p>Tucker, D. M., Luu, P., & Friston, K. J. (2025). The Criticality of Consciousness: Excitatory‚ÄìInhibitory Balance and Dual Memory Systems in Active Inference. <em>Entropy</em>, 27(8), 829.</p>
            </div>
        </div>

        <!-- EMPIRICAL TAB -->
        <div id="empirical" class="tab-content">
            <h2>1. Testable Predictions</h2>
            
            <h3>1.1 The Œ©-Symmetry Conjecture</h3>
            
            <div class="theorem">
                <div class="env-title">Conjecture (Œ©-Phase Relationship)</div>
                <p>For systems whose coherence-rupture cycle has underlying phase structure:</p>
                <div class="equation-box">
                    $$\Omega = \frac{1}{\varphi}$$
                </div>
                <p>where $\varphi$ is the phase (in radians) traversed during one coherence accumulation cycle.</p>
            </div>
            
            <table>
                <tr>
                    <th>Symmetry</th>
                    <th>Phase to Rupture</th>
                    <th>$\Omega$ Value</th>
                    <th>CV Prediction</th>
                </tr>
                <tr>
                    <td>$\mathbb{Z}_2$ (flip)</td>
                    <td>$\pi$ (half-cycle)</td>
                    <td>$1/\pi \approx 0.318$</td>
                    <td>$\approx 0.159$</td>
                </tr>
                <tr>
                    <td>$SO(2)$ (rotation)</td>
                    <td>$2\pi$ (full-cycle)</td>
                    <td>$1/2\pi \approx 0.159$</td>
                    <td>$\approx 0.080$</td>
                </tr>
            </table>
            
            <h3>1.2 CV Predictions by Symmetry Class</h3>
            
            <div class="success-box">
                <div class="env-title">$\mathbb{Z}_2$ Systems: $CV \approx 0.159$</div>
                <p><strong>Saltatory growth</strong> (Lampl & Johnson, 1998):</p>
                <ul>
                    <li>Prediction: $CV \approx 0.159$</li>
                    <li>Observed: $CV \approx 0.15$‚Äì$0.16$</li>
                    <li>Status: <strong>Confirmed</strong> (11/11 individual predictions)</li>
                </ul>
            </div>
            
            <h2>2. Summary of Empirical Status</h2>
            
            <table>
                <tr>
                    <th>Domain</th>
                    <th>Test Type</th>
                    <th>Status</th>
                </tr>
                <tr>
                    <td>Saltatory growth</td>
                    <td>Prospective</td>
                    <td>Confirmed</td>
                </tr>
                <tr>
                    <td>Wound healing</td>
                    <td>Post-hoc fit</td>
                    <td>Consistent ($R^2 = 0.9989$)</td>
                </tr>
                <tr>
                    <td>Muscle hypertrophy</td>
                    <td>Mixed</td>
                    <td>Consistent (10/10)</td>
                </tr>
            </table>
            
            <h2>3. Falsification Criteria</h2>
            
            <p>The framework would be challenged if:</p>
            <ul>
                <li>$\mathbb{Z}_2$ systems showed $CV$ significantly different from $\sim 0.16$</li>
                <li>$SO(2)$ systems showed $CV$ significantly different from $\sim 0.08$</li>
                <li>Regeneration proved Markovian (no path dependence)</li>
            </ul>
            
            <div class="warning-box">
                <p><strong>Current assessment:</strong> Preliminary evidence is encouraging but not conclusive. The framework generates specific, testable predictions that distinguish it from generic curve-fitting.</p>
            </div>
        </div>
    </div>
    
    <script>
        'use strict';
        
        // Tab switching
        function openTab(evt, tabName) {
            var tabContents = document.getElementsByClassName("tab-content");
            for (var i = 0; i < tabContents.length; i++) {
                tabContents[i].classList.remove("active");
            }
            
            var tabButtons = document.getElementsByClassName("tab-button");
            for (var i = 0; i < tabButtons.length; i++) {
                tabButtons[i].classList.remove("active");
            }
            
            document.getElementById(tabName).classList.add("active");
            evt.currentTarget.classList.add("active");
            
            if (typeof MathJax !== 'undefined') {
                MathJax.typesetPromise([document.getElementById(tabName)]).catch((err) => console.log(err));
            }
            
            // Resize canvases when tabs are opened
            if (tabName === 'ei') {
                setTimeout(() => {
                    resizeEICanvases();
                    drawEI();
                }, 100);
            }
            if (tabName === 'fep') {
                setTimeout(() => {
                    resizeFEPCanvases();
                    drawFEP();
                }, 100);
            }
        }
        
        // ================================================================
        // E-I CRITICALITY SIMULATION
        // ================================================================
        
        let omega = 1.0;
        let time = 0;
        let C = 0;
        let cHistory = [];
        const HIST_LEN = 200;
        
        const mapCanvas = document.getElementById('mappingCanvas');
        const weightCanvas = document.getElementById('weightingCanvas');
        const crrCanvas = document.getElementById('crrCanvas');
        const windowCanvas = document.getElementById('windowCanvas');
        
        let mapCtx, weightCtx, crrCtx, windowCtx;
        
        function initEICanvases() {
            if (mapCanvas) mapCtx = mapCanvas.getContext('2d');
            if (weightCanvas) weightCtx = weightCanvas.getContext('2d');
            if (crrCanvas) crrCtx = crrCanvas.getContext('2d');
            if (windowCanvas) windowCtx = windowCanvas.getContext('2d');
        }
        
        function resizeEICanvases() {
            [mapCanvas, weightCanvas, crrCanvas, windowCanvas].forEach(c => {
                if (c) {
                    c.width = c.offsetWidth || 400;
                    c.height = 180;
                }
            });
        }
        
        function updateStateBox() {
            const box = document.getElementById('stateBox');
            const label = document.getElementById('regimeLabel');
            if (!box || !label) return;
            
            if (omega < 0.6) {
                label.className = 'regime-label regime-i';
                label.textContent = 'I > E ‚Äî INHIBITION DOMINANT';
                box.innerHTML = `
                    <h4>I-Dominant Regime (Low Œ©, High Precision)</h4>
                    <p><strong>Oscillatory:</strong> Gamma/beta waves overpower theta. No stable resonance forms.</p>
                    <p><strong>Plasticity:</strong> Write window is narrow. Only high-salience events get inscribed.</p>
                    <p><strong>CRR:</strong> Frequent but shallow ruptures. exp(C/Œ©) is sharply peaked‚Äîselective memory.</p>
                    <p class="mechanism">Phenomenology: Hyper-focused, anxious, over-constrained. NREM-like consolidation.</p>
                `;
            } else if (omega > 1.5) {
                label.className = 'regime-label regime-e';
                label.textContent = 'E > I ‚Äî EXCITATION DOMINANT';
                box.innerHTML = `
                    <h4>E-Dominant Regime (High Œ©, Low Precision)</h4>
                    <p><strong>Oscillatory:</strong> Theta waves overpower gamma/beta. Diffuse activation.</p>
                    <p><strong>Plasticity:</strong> Write window is broad but unstable. Patterns blur together.</p>
                    <p><strong>CRR:</strong> Rare but deep ruptures. exp(C/Œ©) is broadly uniform‚Äîintegrative memory.</p>
                    <p class="mechanism">Phenomenology: Loose, dream-like, associative. REM-like reorganisation.</p>
                `;
            } else {
                label.className = 'regime-label regime-crit';
                label.textContent = 'E ‚âà I ‚Äî CRITICALITY';
                box.innerHTML = `
                    <h4>Critical Regime (Œ© ‚âà 1, E = I)</h4>
                    <p><strong>Oscillatory:</strong> Theta and gamma/beta meet ‚Üí standing wave resonance.</p>
                    <p><strong>Plasticity:</strong> Resonance plateau lasts ~100-200ms‚Äîoptimal for LTP. This is the write window.</p>
                    <p><strong>CRR:</strong> Coherence reaches threshold cleanly. System is maximally sensitive.</p>
                    <p class="mechanism">Phenomenology: James's "perchings"‚Äîthe felt now, coherently given, then reorganised.</p>
                `;
            }
        }
        
        function drawMapping() {
            if (!mapCtx) return;
            const ctx = mapCtx;
            const w = mapCanvas.width, h = mapCanvas.height;
            ctx.fillStyle = '#fff';
            ctx.fillRect(0, 0, w, h);
            
            const m = { l: 40, r: 15, t: 15, b: 28 };
            const pw = w - m.l - m.r, ph = h - m.t - m.b;
            const omMin = 0.25, omMax = 2.5, valMax = 2.5;
            const toX = om => m.l + ((om - omMin) / (omMax - omMin)) * pw;
            const toY = v => m.t + ph * (1 - Math.min(v, valMax) / valMax);
            
            ctx.fillStyle = 'rgba(100, 180, 100, 0.15)';
            ctx.fillRect(toX(0.7), m.t, toX(1.4) - toX(0.7), ph);
            
            ctx.strokeStyle = '#000';
            ctx.lineWidth = 1;
            ctx.beginPath();
            ctx.moveTo(m.l, m.t);
            ctx.lineTo(m.l, h - m.b);
            ctx.lineTo(w - m.r, h - m.b);
            ctx.stroke();
            
            ctx.strokeStyle = '#cc3333';
            ctx.lineWidth = 2;
            ctx.beginPath();
            for (let i = 0; i <= 100; i++) {
                const om = omMin + (i/100) * (omMax - omMin);
                if (i === 0) ctx.moveTo(toX(om), toY(om));
                else ctx.lineTo(toX(om), toY(om));
            }
            ctx.stroke();
            
            ctx.strokeStyle = '#2266aa';
            ctx.lineWidth = 2;
            ctx.beginPath();
            for (let i = 0; i <= 100; i++) {
                const om = omMin + (i/100) * (omMax - omMin);
                if (i === 0) ctx.moveTo(toX(om), toY(1/om));
                else ctx.lineTo(toX(om), toY(1/om));
            }
            ctx.stroke();
            
            ctx.fillStyle = '#339933';
            ctx.beginPath();
            ctx.arc(toX(1), toY(1), 5, 0, Math.PI * 2);
            ctx.fill();
            
            ctx.fillStyle = '#000';
            ctx.beginPath();
            ctx.moveTo(toX(omega), h - m.b);
            ctx.lineTo(toX(omega) - 5, h - m.b + 8);
            ctx.lineTo(toX(omega) + 5, h - m.b + 8);
            ctx.fill();
            
            ctx.font = '10px sans-serif';
            ctx.fillStyle = '#cc3333';
            ctx.textAlign = 'left';
            ctx.fillText('E ‚àù Œ©', m.l + 5, m.t + 20);
            ctx.fillStyle = '#2266aa';
            ctx.fillText('I ‚àù 1/Œ©', w - m.r - 50, m.t + 20);
            ctx.fillStyle = '#000';
            ctx.textAlign = 'center';
            ctx.fillText('Œ©', w/2, h - 5);
        }
        
        function drawWeighting() {
            if (!weightCtx) return;
            const ctx = weightCtx;
            const w = weightCanvas.width, h = weightCanvas.height;
            ctx.fillStyle = '#fff';
            ctx.fillRect(0, 0, w, h);
            
            const m = { l: 40, r: 15, t: 15, b: 28 };
            const pw = w - m.l - m.r, ph = h - m.t - m.b;
            
            ctx.strokeStyle = '#000';
            ctx.lineWidth = 1;
            ctx.beginPath();
            ctx.moveTo(m.l, m.t);
            ctx.lineTo(m.l, h - m.b);
            ctx.lineTo(w - m.r, h - m.b);
            ctx.stroke();
            
            const cMax = 2.5;
            ctx.strokeStyle = '#339933';
            ctx.lineWidth = 2;
            ctx.beginPath();
            let maxExp = Math.exp(cMax / omega);
            for (let i = 0; i <= 100; i++) {
                const cVal = (i/100) * cMax;
                const expVal = Math.exp(cVal / omega);
                const x = m.l + (i/100) * pw;
                const y = m.t + ph * (1 - expVal / maxExp);
                if (i === 0) ctx.moveTo(x, y);
                else ctx.lineTo(x, y);
            }
            ctx.stroke();
            
            ctx.font = '10px sans-serif';
            ctx.fillStyle = '#339933';
            ctx.textAlign = 'left';
            ctx.fillText('exp(C/Œ©)', m.l + 5, m.t + 15);
            ctx.fillStyle = '#000';
            ctx.textAlign = 'center';
            ctx.fillText('Historical Coherence C', w/2, h - 5);
        }
        
        function updateCRR() {
            C += 0.015 * (0.8 + Math.random() * 0.4);
            if (C >= omega) C = 0;
            cHistory.push(C);
            if (cHistory.length > HIST_LEN) cHistory.shift();
        }
        
        function drawCRR() {
            if (!crrCtx) return;
            const ctx = crrCtx;
            const w = crrCanvas.width, h = crrCanvas.height;
            ctx.fillStyle = '#fff';
            ctx.fillRect(0, 0, w, h);
            
            const m = { l: 40, r: 15, t: 15, b: 28 };
            const pw = w - m.l - m.r, ph = h - m.t - m.b;
            const maxC = 2.5;
            
            ctx.strokeStyle = '#000';
            ctx.lineWidth = 1;
            ctx.beginPath();
            ctx.moveTo(m.l, m.t);
            ctx.lineTo(m.l, h - m.b);
            ctx.lineTo(w - m.r, h - m.b);
            ctx.stroke();
            
            const threshY = m.t + ph * (1 - omega / maxC);
            ctx.strokeStyle = '#cc3333';
            ctx.lineWidth = 1.5;
            ctx.setLineDash([5, 5]);
            ctx.beginPath();
            ctx.moveTo(m.l, threshY);
            ctx.lineTo(w - m.r, threshY);
            ctx.stroke();
            ctx.setLineDash([]);
            
            ctx.fillStyle = '#cc3333';
            ctx.font = '10px sans-serif';
            ctx.textAlign = 'left';
            ctx.fillText('Œ© = ' + omega.toFixed(2), m.l + 5, threshY - 5);
            
            if (cHistory.length > 1) {
                ctx.strokeStyle = '#2266aa';
                ctx.lineWidth = 2;
                ctx.beginPath();
                for (let i = 0; i < cHistory.length; i++) {
                    const x = m.l + (i / HIST_LEN) * pw;
                    const y = m.t + ph * (1 - cHistory[i] / maxC);
                    if (i === 0) ctx.moveTo(x, y);
                    else ctx.lineTo(x, y);
                }
                ctx.stroke();
            }
            
            ctx.fillStyle = '#2266aa';
            ctx.textAlign = 'right';
            ctx.fillText('C(t)', w - m.r, m.t + 15);
            ctx.fillStyle = '#000';
            ctx.textAlign = 'center';
            ctx.fillText('Time', w/2, h - 5);
        }
        
        function drawWindow() {
            if (!windowCtx) return;
            const ctx = windowCtx;
            const w = windowCanvas.width, h = windowCanvas.height;
            ctx.fillStyle = '#fff';
            ctx.fillRect(0, 0, w, h);
            
            const m = { l: 40, r: 15, t: 15, b: 28 };
            const pw = w - m.l - m.r, ph = h - m.t - m.b;
            
            ctx.strokeStyle = '#000';
            ctx.lineWidth = 1;
            ctx.beginPath();
            ctx.moveTo(m.l, m.t);
            ctx.lineTo(m.l, h - m.b);
            ctx.lineTo(w - m.r, h - m.b);
            ctx.stroke();
            
            ctx.strokeStyle = '#339933';
            ctx.lineWidth = 2;
            ctx.beginPath();
            for (let i = 0; i <= pw; i++) {
                const om = 0.25 + (i / pw) * 2.25;
                const balance = 1 - Math.abs(1 - om);
                const duration = Math.max(0, balance * balance);
                const y = m.t + ph * (1 - duration);
                if (i === 0) ctx.moveTo(m.l + i, y);
                else ctx.lineTo(m.l + i, y);
            }
            ctx.stroke();
            
            const ltpY = m.t + ph * 0.5;
            ctx.strokeStyle = '#aa6600';
            ctx.lineWidth = 1;
            ctx.setLineDash([4, 4]);
            ctx.beginPath();
            ctx.moveTo(m.l, ltpY);
            ctx.lineTo(w - m.r, ltpY);
            ctx.stroke();
            ctx.setLineDash([]);
            
            ctx.fillStyle = '#aa6600';
            ctx.font = '9px sans-serif';
            ctx.textAlign = 'left';
            ctx.fillText('LTP threshold', m.l + 5, ltpY - 5);
            
            const currX = m.l + ((omega - 0.25) / 2.25) * pw;
            const currBalance = 1 - Math.abs(1 - omega);
            const currDuration = Math.max(0, currBalance * currBalance);
            const currY = m.t + ph * (1 - currDuration);
            
            ctx.fillStyle = '#339933';
            ctx.beginPath();
            ctx.arc(currX, currY, 5, 0, Math.PI * 2);
            ctx.fill();
            
            ctx.fillStyle = '#000';
            ctx.font = '10px sans-serif';
            ctx.textAlign = 'center';
            ctx.fillText('Œ©', w/2, h - 5);
        }
        
        function drawEI() {
            drawMapping();
            drawWeighting();
            drawCRR();
            drawWindow();
        }
        
        // ================================================================
        // FEP SIMULATION
        // ================================================================
        
        let precision = 1.0;
        let fepTime = 0;
        let evidence = 0;
        let evidenceHistory = [];
        let posteriorHistory = [];
        let rupturesFEP = [];
        const FEP_HIST_LEN = 200;
        
        const evidenceCanvas = document.getElementById('evidenceCanvas');
        const posteriorCanvas = document.getElementById('posteriorCanvas');
        const efeCanvas = document.getElementById('efeCanvas');
        const precisionOmegaCanvas = document.getElementById('precisionOmegaCanvas');
        
        let evidenceCtx, posteriorCtx, efeCtx, precisionOmegaCtx;
        
        function initFEPCanvases() {
            if (evidenceCanvas) evidenceCtx = evidenceCanvas.getContext('2d');
            if (posteriorCanvas) posteriorCtx = posteriorCanvas.getContext('2d');
            if (efeCanvas) efeCtx = efeCanvas.getContext('2d');
            if (precisionOmegaCanvas) precisionOmegaCtx = precisionOmegaCanvas.getContext('2d');
        }
        
        function resizeFEPCanvases() {
            [evidenceCanvas, posteriorCanvas, efeCanvas, precisionOmegaCanvas].forEach(c => {
                if (c) {
                    c.width = c.offsetWidth || 400;
                    c.height = 180;
                }
            });
        }
        
        function updateFEPStateBox() {
            const box = document.getElementById('fepStateBox');
            if (!box) return;
            
            const omegaFEP = 1 / precision;
            
            if (precision > 2.0) {
                box.innerHTML = `
                    <h4>High Precision Regime (œÄ > 2, Œ© < 0.5)</h4>
                    <p><strong>Evidence Accumulation:</strong> Quick threshold crossing; frequent "aha moments".</p>
                    <p><strong>Model Selection:</strong> Risk of premature commitment‚Äîjumping to conclusions.</p>
                    <p><strong>CRR:</strong> Frequent ruptures with shallow regeneration. Rigid, inflexible.</p>
                    <p class="mechanism">Phenomenology: Anxious, hypervigilant, over-certain.</p>
                `;
            } else if (precision < 0.67) {
                box.innerHTML = `
                    <h4>Low Precision Regime (œÄ < 0.67, Œ© > 1.5)</h4>
                    <p><strong>Evidence Accumulation:</strong> Slow threshold crossing; rare model updates.</p>
                    <p><strong>Model Selection:</strong> Risk of paralysis‚Äîunable to commit to hypotheses.</p>
                    <p><strong>CRR:</strong> Rare ruptures with deep integration. Loose, diffuse.</p>
                    <p class="mechanism">Phenomenology: Dream-like, dissociated, uncertain.</p>
                `;
            } else {
                box.innerHTML = `
                    <h4>Balanced Precision (œÄ ‚âà 1, Œ© ‚âà 1)</h4>
                    <p><strong>Evidence Accumulation:</strong> Optimal rate‚Äîneither too quick nor too slow.</p>
                    <p><strong>Model Selection:</strong> Commitment when warranted; appropriate caution.</p>
                    <p><strong>CRR:</strong> Balanced rupture rate with moderate regeneration depth.</p>
                    <p class="mechanism">This is the "aha moment" regime‚Äîinsight emerges when evidence warrants.</p>
                `;
            }
        }
        
        function updateFEP() {
            const omegaFEP = 1 / precision;
            evidence += 0.02 * precision * (0.7 + Math.random() * 0.6);
            
            const posterior = 1 - Math.exp(-evidence * precision);
            
            if (evidence >= omegaFEP) {
                rupturesFEP.push(evidenceHistory.length);
                evidence = 0;
            }
            
            evidenceHistory.push(evidence);
            posteriorHistory.push(posterior);
            
            if (evidenceHistory.length > FEP_HIST_LEN) {
                evidenceHistory.shift();
                posteriorHistory.shift();
                rupturesFEP = rupturesFEP.map(r => r - 1).filter(r => r >= 0);
            }
        }
        
        function drawEvidence() {
            if (!evidenceCtx) return;
            const ctx = evidenceCtx;
            const w = evidenceCanvas.width, h = evidenceCanvas.height;
            ctx.fillStyle = '#fff';
            ctx.fillRect(0, 0, w, h);
            
            const m = { l: 40, r: 15, t: 15, b: 28 };
            const pw = w - m.l - m.r, ph = h - m.t - m.b;
            const omegaFEP = 1 / precision;
            const maxE = 2.5;
            
            ctx.strokeStyle = '#000';
            ctx.lineWidth = 1;
            ctx.beginPath();
            ctx.moveTo(m.l, m.t);
            ctx.lineTo(m.l, h - m.b);
            ctx.lineTo(w - m.r, h - m.b);
            ctx.stroke();
            
            const threshY = m.t + ph * (1 - omegaFEP / maxE);
            ctx.strokeStyle = '#cc3333';
            ctx.lineWidth = 1.5;
            ctx.setLineDash([5, 5]);
            ctx.beginPath();
            ctx.moveTo(m.l, threshY);
            ctx.lineTo(w - m.r, threshY);
            ctx.stroke();
            ctx.setLineDash([]);
            
            ctx.fillStyle = '#cc3333';
            ctx.font = '10px sans-serif';
            ctx.textAlign = 'left';
            ctx.fillText('Œ© = ' + omegaFEP.toFixed(2), m.l + 5, threshY - 5);
            
            if (evidenceHistory.length > 1) {
                ctx.strokeStyle = '#2266aa';
                ctx.lineWidth = 2;
                ctx.beginPath();
                for (let i = 0; i < evidenceHistory.length; i++) {
                    const x = m.l + (i / FEP_HIST_LEN) * pw;
                    const y = m.t + ph * (1 - evidenceHistory[i] / maxE);
                    if (i === 0) ctx.moveTo(x, y);
                    else ctx.lineTo(x, y);
                }
                ctx.stroke();
            }
            
            // Mark ruptures
            ctx.fillStyle = '#ff6600';
            rupturesFEP.forEach(r => {
                const x = m.l + (r / FEP_HIST_LEN) * pw;
                ctx.beginPath();
                ctx.arc(x, m.t + 10, 4, 0, Math.PI * 2);
                ctx.fill();
            });
            
            ctx.fillStyle = '#000';
            ctx.textAlign = 'center';
            ctx.fillText('Time', w/2, h - 5);
        }
        
        function drawPosterior() {
            if (!posteriorCtx) return;
            const ctx = posteriorCtx;
            const w = posteriorCanvas.width, h = posteriorCanvas.height;
            ctx.fillStyle = '#fff';
            ctx.fillRect(0, 0, w, h);
            
            const m = { l: 40, r: 15, t: 15, b: 28 };
            const pw = w - m.l - m.r, ph = h - m.t - m.b;
            
            ctx.strokeStyle = '#000';
            ctx.lineWidth = 1;
            ctx.beginPath();
            ctx.moveTo(m.l, m.t);
            ctx.lineTo(m.l, h - m.b);
            ctx.lineTo(w - m.r, h - m.b);
            ctx.stroke();
            
            // Threshold line at 0.9
            const threshY = m.t + ph * (1 - 0.9);
            ctx.strokeStyle = '#339933';
            ctx.lineWidth = 1;
            ctx.setLineDash([4, 4]);
            ctx.beginPath();
            ctx.moveTo(m.l, threshY);
            ctx.lineTo(w - m.r, threshY);
            ctx.stroke();
            ctx.setLineDash([]);
            
            ctx.fillStyle = '#339933';
            ctx.font = '9px sans-serif';
            ctx.textAlign = 'left';
            ctx.fillText('Œ∏ = 0.9', m.l + 5, threshY - 5);
            
            if (posteriorHistory.length > 1) {
                ctx.strokeStyle = '#663399';
                ctx.lineWidth = 2;
                ctx.beginPath();
                for (let i = 0; i < posteriorHistory.length; i++) {
                    const x = m.l + (i / FEP_HIST_LEN) * pw;
                    const y = m.t + ph * (1 - posteriorHistory[i]);
                    if (i === 0) ctx.moveTo(x, y);
                    else ctx.lineTo(x, y);
                }
                ctx.stroke();
            }
            
            ctx.fillStyle = '#663399';
            ctx.textAlign = 'left';
            ctx.fillText('p(m|D)', m.l + 5, m.t + 15);
            ctx.fillStyle = '#000';
            ctx.textAlign = 'center';
            ctx.fillText('Time', w/2, h - 5);
        }
        
        function drawEFE() {
            if (!efeCtx) return;
            const ctx = efeCtx;
            const w = efeCanvas.width, h = efeCanvas.height;
            ctx.fillStyle = '#fff';
            ctx.fillRect(0, 0, w, h);
            
            const m = { l: 40, r: 15, t: 15, b: 28 };
            const pw = w - m.l - m.r, ph = h - m.t - m.b;
            
            ctx.strokeStyle = '#000';
            ctx.lineWidth = 1;
            ctx.beginPath();
            ctx.moveTo(m.l, m.t);
            ctx.lineTo(m.l, h - m.b);
            ctx.lineTo(w - m.r, h - m.b);
            ctx.stroke();
            
            const piMin = 0.4, piMax = 4.0;
            const maxVal = 3.0;
            
            // Risk (red)
            ctx.strokeStyle = '#cc3333';
            ctx.lineWidth = 2;
            ctx.beginPath();
            for (let i = 0; i <= pw; i++) {
                const pi = piMin + (i / pw) * (piMax - piMin);
                const risk = 1.0 / pi;
                const y = m.t + ph * (1 - risk / maxVal);
                if (i === 0) ctx.moveTo(m.l + i, y);
                else ctx.lineTo(m.l + i, y);
            }
            ctx.stroke();
            
            // Ambiguity (blue)
            ctx.strokeStyle = '#2266aa';
            ctx.lineWidth = 2;
            ctx.beginPath();
            for (let i = 0; i <= pw; i++) {
                const pi = piMin + (i / pw) * (piMax - piMin);
                const ambiguity = 0.5 / pi;
                const y = m.t + ph * (1 - ambiguity / maxVal);
                if (i === 0) ctx.moveTo(m.l + i, y);
                else ctx.lineTo(m.l + i, y);
            }
            ctx.stroke();
            
            // Info gain (green)
            ctx.strokeStyle = '#339933';
            ctx.lineWidth = 2;
            ctx.beginPath();
            for (let i = 0; i <= pw; i++) {
                const pi = piMin + (i / pw) * (piMax - piMin);
                const infoGain = 4 * pi * Math.exp(-pi);
                const y = m.t + ph * (1 - infoGain / maxVal);
                if (i === 0) ctx.moveTo(m.l + i, y);
                else ctx.lineTo(m.l + i, y);
            }
            ctx.stroke();
            
            // Current precision marker
            const currX = m.l + ((precision - piMin) / (piMax - piMin)) * pw;
            ctx.fillStyle = '#000';
            ctx.beginPath();
            ctx.moveTo(currX, h - m.b);
            ctx.lineTo(currX - 5, h - m.b + 8);
            ctx.lineTo(currX + 5, h - m.b + 8);
            ctx.fill();
            
            ctx.font = '9px sans-serif';
            ctx.textAlign = 'left';
            ctx.fillStyle = '#cc3333';
            ctx.fillText('Risk', m.l + 5, m.t + 12);
            ctx.fillStyle = '#2266aa';
            ctx.fillText('Ambiguity', m.l + 5, m.t + 24);
            ctx.fillStyle = '#339933';
            ctx.fillText('Info Gain', m.l + 5, m.t + 36);
            ctx.fillStyle = '#000';
            ctx.textAlign = 'center';
            ctx.fillText('Precision œÄ', w/2, h - 5);
        }
        
        function drawPrecisionOmega() {
            if (!precisionOmegaCtx) return;
            const ctx = precisionOmegaCtx;
            const w = precisionOmegaCanvas.width, h = precisionOmegaCanvas.height;
            ctx.fillStyle = '#fff';
            ctx.fillRect(0, 0, w, h);
            
            const m = { l: 40, r: 15, t: 15, b: 28 };
            const pw = w - m.l - m.r, ph = h - m.t - m.b;
            
            ctx.strokeStyle = '#000';
            ctx.lineWidth = 1;
            ctx.beginPath();
            ctx.moveTo(m.l, m.t);
            ctx.lineTo(m.l, h - m.b);
            ctx.lineTo(w - m.r, h - m.b);
            ctx.stroke();
            
            const piMin = 0.4, piMax = 4.0, omMax = 3.0;
            
            // Œ© = 1/œÄ curve
            ctx.strokeStyle = '#c9a227';
            ctx.lineWidth = 3;
            ctx.beginPath();
            for (let i = 0; i <= pw; i++) {
                const pi = piMin + (i / pw) * (piMax - piMin);
                const om = 1 / pi;
                const y = m.t + ph * (1 - om / omMax);
                if (i === 0) ctx.moveTo(m.l + i, y);
                else ctx.lineTo(m.l + i, y);
            }
            ctx.stroke();
            
            // Current point
            const currX = m.l + ((precision - piMin) / (piMax - piMin)) * pw;
            const currOmega = 1 / precision;
            const currY = m.t + ph * (1 - currOmega / omMax);
            
            ctx.fillStyle = '#c9a227';
            ctx.beginPath();
            ctx.arc(currX, currY, 6, 0, Math.PI * 2);
            ctx.fill();
            
            ctx.font = '11px sans-serif';
            ctx.fillStyle = '#c9a227';
            ctx.textAlign = 'left';
            ctx.fillText('Œ© = 1/œÄ', m.l + 10, m.t + 20);
            ctx.fillStyle = '#000';
            ctx.textAlign = 'center';
            ctx.fillText('Precision œÄ', w/2, h - 5);
            
            ctx.save();
            ctx.translate(12, h/2);
            ctx.rotate(-Math.PI/2);
            ctx.fillText('Threshold Œ©', 0, 0);
            ctx.restore();
        }
        
        function drawFEP() {
            drawEvidence();
            drawPosterior();
            drawEFE();
            drawPrecisionOmega();
        }
        
        // ================================================================
        // ANIMATION LOOP
        // ================================================================
        
        function animate() {
            time++;
            fepTime++;
            updateCRR();
            updateFEP();
            drawEI();
            drawFEP();
            requestAnimationFrame(animate);
        }
        
        // ================================================================
        // INITIALIZATION
        // ================================================================
        
        document.addEventListener('DOMContentLoaded', () => {
            initEICanvases();
            initFEPCanvases();
            
            const omegaSlider = document.getElementById('omegaSlider');
            if (omegaSlider) {
                omegaSlider.addEventListener('input', e => {
                    omega = parseFloat(e.target.value);
                    document.getElementById('omegaVal').textContent = omega.toFixed(2);
                    updateStateBox();
                    cHistory = [];
                });
            }
            
            const precisionSlider = document.getElementById('precisionSlider');
            if (precisionSlider) {
                precisionSlider.addEventListener('input', e => {
                    precision = parseFloat(e.target.value);
                    document.getElementById('precisionVal').textContent = precision.toFixed(2);
                    document.getElementById('omegaFromPrecision').textContent = (1/precision).toFixed(2);
                    updateFEPStateBox();
                    evidenceHistory = [];
                    posteriorHistory = [];
                    rupturesFEP = [];
                    evidence = 0;
                });
            }
            
            window.addEventListener('resize', () => {
                resizeEICanvases();
                resizeFEPCanvases();
                drawEI();
                drawFEP();
            });
            
            setTimeout(() => {
                resizeEICanvases();
                resizeFEPCanvases();
                updateStateBox();
                updateFEPStateBox();
                animate();
            }, 100);
        });
    </script>
</body>
</html>
